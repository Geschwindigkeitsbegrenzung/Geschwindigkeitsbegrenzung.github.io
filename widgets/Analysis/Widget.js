// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/tasks/JobInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./GPMessage"],function(m,d,k,f,c){m=m(null,{declaredClass:"esri.tasks.JobInfo",constructor:function(b){this.messages=[];d.mixin(this,b);b=this.messages;var f,w=b.length;for(f=0;f<w;f++)b[f]=new c(b[f])},jobId:"",jobStatus:""});d.mixin(m,{STATUS_CANCELLED:"esriJobCancelled",STATUS_CANCELLING:"esriJobCancelling",STATUS_DELETED:"esriJobDeleted",STATUS_DELETING:"esriJobDeleting",STATUS_EXECUTING:"esriJobExecuting",
STATUS_FAILED:"esriJobFailed",STATUS_NEW:"esriJobNew",STATUS_SUBMITTED:"esriJobSubmitted",STATUS_SUCCEEDED:"esriJobSucceeded",STATUS_TIMED_OUT:"esriJobTimedOut",STATUS_WAITING:"esriJobWaiting"});return m})},"esri/tasks/GPMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(m,d,k,f){m=m(null,{declaredClass:"esri.tasks.GPMessage",constructor:function(c){d.mixin(this,c)}});d.mixin(m,{TYPE_INFORMATIVE:"esriJobMessageTypeInformative",TYPE_PROCESS_DEFINITION:"esriJobMessageTypeProcessDefinition",
TYPE_PROCESS_START:"esriJobMessageTypeProcessStart",TYPE_PROCESS_STOP:"esriJobMessageTypeProcessStop",TYPE_WARNING:"esriJobMessageTypeWarning",TYPE_ERROR:"esriJobMessageTypeError",TYPE_EMPTY:"esriJobMessageTypeEmpty",TYPE_ABORT:"esriJobMessageTypeAbort"});return m})},"esri/dijit/analysis/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/event dojo/_base/json dojo/dom-attr dojo/has dojo/i18n dojo/io-query dojo/i18n!../../nls/jsapi dojo/json dojo/string dojo/query dojo/date/locale dojo/dom-style dojo/dom-class dojo/dom-construct dojo/Deferred dojo/number dojo/_base/window dojo/when dojo/data/ItemFileWriteStore dijit/registry dijit/Dialog dijit/form/CheckBox ../../kernel ../../lang ../../request ./HelpWindow ../../tasks/query ../../dijit/BrowseItems ../../layers/FeatureLayer ./PluginAnalysisLayers ../../tasks/Geoprocessor ../../dijit/SingleFilter".split(" "),
function(m,d,k,f,c,b,u,w,h,q,v,l,x,p,t,B,g,r,A,D,E,G,a,n,e,z,y,C,H,O,J,I,K,F,L,P){m={};d.mixin(m,{_helpDialog:null,i18n:null,initHelpLinks:function(a,e,b){this._helpDialog||(this._helpDialog=new O);if(a){var g=n.byNode(a),h=g?g.get("helpFileName"):b&&b.helpFileName?b.helpFileName:null,s=g?g.get("isSingleTenant"):b&&b.isSingleTenant?b.isSingleTenant:!1;p("[esriHelpTopic]",a).forEach(function(n,g,z){n&&(B.set(n,"display",!C.isDefined(e)||!0===e?"":"none"),f.connect(n,"onclick",d.hitch(this,function(e){c.stop(e);
this._helpDialog.show(e,{helpId:u.get(n,"esriHelpTopic"),helpFileName:h,analysisGpServer:b&&b.analysisGpServer?b.analysisGpServer:null,helpParentNode:a,isPortal:s})})))},this)}},constructAnalysisFeatColl:function(a){var e={},b;e.featureCollection=a.layerDefinition;for(b in e.featureCollection)e.featureCollection.hasOwnProperty(b)&&"objectIdField"===b&&(e.featureCollection.objectIdFieldName=d.clone(e.featureCollection.objectIdField),delete e.featureCollection.objectIdField);e.featureCollection.features=
a.featureSet.features;return e},constructAnalysisInputLyrObj:function(a){var e={},b,c=a.getMap()||a._map,n;if(a.url&&!a._collection){e={url:a.url};b=this.isHostedService(a.url);n=10.2<=a.version&&a._useStandardizedQueries;a.getDefinitionExpression&&a.getDefinitionExpression()?e.filter=a.getDefinitionExpression():C.isDefined(a.definitionExpression)&&""!==a.definitionExpression&&(e.filter=a.definitionExpression);if(a.useMapTime&&a.timeInfo&&c.timeExtent&&(n||b||10.2<=a.version))n="",a.timeInfo.startTimeField&&
!a.timeInfo.endTimeField?(c.timeExtent.startTime&&(n=a.timeInfo.startTimeField+" \x3e "+(b?"":"timestamp ")+"'"+this.formatDate(c.timeExtent.startTime)+"'"),c.timeExtent.endTime&&(c.timeExtent.startTime&&(n+=" AND "),n+=a.timeInfo.startTimeField+" \x3c "+(b?"":"timestamp ")+"'"+this.formatDate(c.timeExtent.endTime)+"'")):!a.timeInfo.startTimeField&&a.timeInfo.endTimeField?(c.timeExtent.startTime&&(n=a.timeInfo.endTimeField+" \x3e "+(b?"":"timestamp ")+"'"+this.formatDate(c.timeExtent.startTime)+"'"),
c.timeExtent.endTime&&(c.timeExtent.startTime&&(n+=" AND "),n+=a.timeInfo.endTimeField+" \x3c "+(b?"":"timestamp ")+"'"+this.formatDate(c.timeExtent.endTime)+"'")):a.timeInfo.startTimeField&&a.timeInfo.endTimeField&&(c.timeExtent.startTime&&(n=a.timeInfo.startTimeField+" \x3e "+(b?"":"timestamp ")+"'"+this.formatDate(c.timeExtent.startTime)+"'"),c.timeExtent.endTime&&(c.timeExtent.startTime&&(n+=" AND "),n+=a.timeInfo.endTimeField+" \x3c "+(b?"":"timestamp ")+"'"+this.formatDate(c.timeExtent.endTime)+
"'")),e.filter=e.filter?e.filter+(" AND "+n):n;a.credential&&(e.serviceToken=a.credential.token);-1!==e.url.indexOf("?")&&(a=e.url.substring(e.url.indexOf("?")+1,e.url.length),a=q.queryToObject(a),d.mixin(e,a),e.url=e.url.substring(0,e.url.indexOf("?")))}else if(!a.url||a._collection)try{e=a.toJson()}catch(s){a._json=l.parse(a._json),e=a.toJson()}return e},formatDate:function(a){return t.format(a,{datePattern:"yyyy-MM-dd",selector:"date"})+" "+t.format(a,{selector:"time",timePattern:"HH:mm:ss"})},
isHostedService:function(a){if(!a)return!1;var e=-1!==a.indexOf(".arcgis.com/");a=-1!==a.indexOf("//services")||-1!==a.indexOf("//tiles")||-1!==a.indexOf("//features");return e&&a},buildReport:function(a,e){var b="";e||(e={},d.mixin(e,v.analysisMsgCodes));k.forEach(a,function(a,c){var s,n,M;"string"===typeof a.message?(s=C.isDefined(e[a.messageCode])?e[a.messageCode]:a.message,b+=a.style.substring(0,a.style.indexOf("\x3c/"))+(!this._isEmptyObject(a.params)?x.substitute(s,a.params):s)+a.style.substring(a.style.indexOf("\x3c/"))):
d.isArray(a.message)&&(M=[],n=d.clone(a.style),k.forEach(a.message,function(b,c){n=n.replace(/<\//,"${"+c+"}");s=C.isDefined(e[a.messageCode+"_"+c])?e[a.messageCode+"_"+c]:b;s=!this._isEmptyObject(a.params)?x.substitute(s,a.params):s;M.push(s+"\x3c/")},this),n=x.substitute(n,M),b+=n)},this);return b},getLayerFeatureCount:function(a,e){var b=new J;b.geometry=e.geometry||"";b.where=e.where||"1\x3d1";b.geometryType=e.geometryType||"esriGeometryEnvelope";return a.queryCount(b)},createPolygonFeatureCollection:function(a){var e;
e={layerDefinition:null,featureSet:{features:[],geometryType:"esriGeometryPolygon"}};e.layerDefinition={currentVersion:10.2,copyrightText:"",defaultVisibility:!0,relationships:[],isDataVersioned:!1,supportsRollbackOnFailureParameter:!0,supportsStatistics:!0,supportsAdvancedQueries:!0,geometryType:"esriGeometryPolygon",minScale:0,maxScale:0,objectIdField:"OBJECTID",templates:[],type:"Feature Layer",displayField:"TITLE",visibilityField:"VISIBLE",name:a,hasAttachments:!1,typeIdField:"TYPEID",capabilities:"Query",
allowGeometryUpdates:!0,htmlPopupType:"",hasM:!1,hasZ:!1,globalIdField:"",supportedQueryFormats:"JSON",hasStaticData:!1,maxRecordCount:-1,indexes:[],types:[],drawingInfo:{renderer:{type:"simple",symbol:{color:[0,0,0,255],outline:{color:[0,0,0,255],width:3,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSNull"},label:"",description:""},transparency:0,labelingInfo:null,fixedSymbols:!0},fields:[{alias:"OBJECTID",name:"OBJECTID",type:"esriFieldTypeOID",editable:!1},{alias:"Title",name:"TITLE",
length:50,type:"esriFieldTypeString",editable:!0},{alias:"Visible",name:"VISIBLE",type:"esriFieldTypeInteger",editable:!0},{alias:"Description",name:"DESCRIPTION",length:1073741822,type:"esriFieldTypeString",editable:!0},{alias:"Type ID",name:"TYPEID",type:"esriFieldTypeInteger",editable:!0}]};return e},createPointFeatureCollection:function(a){var e;e={layerDefinition:null,featureSet:{features:[],geometryType:"esriGeometryPoint"}};e.layerDefinition={objectIdField:"OBJECTID",templates:[],type:"Feature Layer",
drawingInfo:{renderer:{field1:"TYPEID",type:"simple",symbol:{height:24,xoffset:0,yoffset:12,width:24,contentType:"image/png",type:"esriPMS",url:"http://static.arcgis.com/images/Symbols/Basic/GreenStickpin.png"},description:"",value:"0",label:"Stickpin"}},displayField:"TITLE",visibilityField:"VISIBLE",name:a,hasAttachments:!1,typeIdField:"TYPEID",capabilities:"Query",types:[],geometryType:"esriGeometryPoint",fields:[{alias:"OBJECTID",name:"OBJECTID",type:"esriFieldTypeOID",editable:!1},{alias:"Title",
name:"TITLE",length:50,type:"esriFieldTypeString",editable:!0},{alias:"Visible",name:"VISIBLE",type:"esriFieldTypeInteger",editable:!0},{alias:"Description",name:"DESCRIPTION",length:1073741822,type:"esriFieldTypeString",editable:!0},{alias:"Type ID",name:"TYPEID",type:"esriFieldTypeInteger",editable:!0}]};return e},createFolderStore:function(e,b){var c=new a({data:{identifier:"id",label:"name",items:[]}});c.newItem({name:b,id:""});k.forEach(e,function(a){c.newItem({name:a.title,id:a.id})});return c},
setupFoldersUI:function(a){a.folderSelect.set("store",a.folderStore);a.folderSelect.set("required",!0);a.folderSelect.set("searchAttr","name");C.isDefined(a.folderId)?a.folderStore.get(a.folderId).then(d.hitch(this,function(e){C.isDefined(e)?a.folderSelect.set("item",e):a.folderStore.get("").then(function(e){a.folderSelect.set("item",e)},this)})):a.folderName?a.folderStore.fetch({query:{name:a.folderName},onComplete:d.hitch(this,function(e){C.isDefined(e)&&0<e.length?a.folderSelect.set("item",e[0]):
a.folderStore.get("").then(function(e){a.folderSelect.set("item",e)},this)})}):a.username?a.folderSelect.set("displayedValue",a.username):a.folderStore.get("").then(function(e){a.folderSelect.set("item",e)},this)},_isEmptyObject:function(a){for(var e in a)if(a.hasOwnProperty(e))return!1;return!0},validateServiceName:function(a,e){var b=/(:|&|<|>|%|#|\?|\\|\"|\/|\+)/.test(a),c=!0,n,s;C.isDefined(e)&&e.textInput&&(s=e.textInput);this.initI18n();0===a.length||0===x.trim(a).length?(n=this.i18n.requiredValue,
c=!1):b?(n=this.i18n.invalidServiceName,c=!1):98<a.length?(n=this.i18n.invalidServiceNameLength,c=!1):170<encodeURIComponent(a).length&&(n=this.i18n.invalidEncodedServiceNameLength,c=!1);s&&!c&&s.set("invalidMessage",n);return c},getStepNumber:function(a){p(".esriAnalysisNumberLabel",a).forEach(function(a,e){var b=this._getNumberLabel(e);u.set(a,"innerHTML",b)},this)},_getNumberLabel:function(a){var e="";this.initI18n();switch(a){case 0:e=this.i18n.oneLabel;break;case 1:e=this.i18n.twoLabel;break;
case 2:e=this.i18n.threeLabel;break;case 3:e=this.i18n.fourLabel;break;case 4:e=this.i18n.fiveLabel;break;case 5:e=this.i18n.sixLabel;break;case 6:e=this.i18n.sevenLabel;break;case 7:e=this.i18n.eightLabel;break;case 8:e=this.i18n.nineLabel}return e},populateAnalysisLayers:function(a,e,b,c){if(a){var n=[],s=a.get(e);a._titleRow&&B.set(a._titleRow,"display","none");a._analysisLabelRow&&B.set(a._analysisLabelRow,"display","table-row");a._selectAnalysisRow&&(B.set(a._selectAnalysisRow,"display","table-row"),
g.add(a._analysisSelect.domNode,"esriTrailingMargin3"),B.set(a._analysisSelect.domNode.parentNode,"padding-bottom","1em"));a.domNode&&this.getStepNumber(a.domNode);C.isDefined(c)&&c.chooseLabel&&n.push({value:-1,label:this.i18n.chooseLabel});if(!C.isDefined(c)||!C.isDefined(c.posIncrement))C.isDefined(c)||(c={}),c.posIncrement=0;k.forEach(a.get(b),function(a,e){e+=c.posIncrement;var b={value:C.isDefined(c)&&c.chooseLabel?e+1:e,label:a.name};s&&a.name===s.name&&(b.selected=!0);n.push(b)},this);a._analysisSelect.addOption(n);
a._analysisSelect.set("required",!0)}},isValidAnalysisLayer:function(a){var e,b,c,n,s,d,g,h="",z=!0;e={isValid:z,validationMessage:h};var y,r,f=0,A=0,t=0;if(!C.isDefined(a)||!C.isDefined(a.toolName))return e;this.initI18n();e=a.toolName;b=a.featureLayers;c=a.analysisLayer;n=e.charAt(0).toLowerCase()+e.substring(1);g=this.i18n;a=a.showReadyToUseLayers||!1;k.forEach(b,function(a){"esriGeometryPoint"===a.geometryType&&(d=!0,f++);if("esriGeometryPoint"===a.geometryType||"esriGeometryMultipoint"===a.geometryType)y=
!0;"esriGeometryPolyline"===a.geometryType&&(r=!0,t++);"esriGeometryPolygon"===a.geometryType&&(s=!0,A++)},this);-1!==k.indexOf(["CreateDriveTimeAreas","PlanRoutes","ConnectOriginsToDestinations"],e)&&(!d||c&&"esriGeometryPoint"!==c.geometryType)?(h=x.substitute(this.i18n.selectPointLayer,{toolName:g[n]}),z=!1):("AggregatePoints"===e||"InterpolatePoints"===e)&&(c&&!("esriGeometryPoint"===c.geometryType||"esriGeometryMultipoint"===c.geometryType)||!y)?(h=x.substitute(this.i18n.selectPointLayer,{toolName:g[n]}),
z=!1):"CalculateDensity"===e&&(!y&&!r||c&&!("esriGeometryPoint"===c.geometryType||"esriGeometryMultipoint"===c.geometryType||"esriGeometryPolyline"===c.geometryType))?(h=x.substitute(this.i18n.areaFeatureInvalidMsg,{toolName:g[n]}),z=!1):"FindHotSpots"===e&&(!y&&!s||c&&!("esriGeometryPoint"===c.geometryType||"esriGeometryMultipoint"===c.geometryType||"esriGeometryPolygon"===c.geometryType))?(h=x.substitute(this.i18n.hotspotsLineFeatureMsg,{toolName:g[n]}),z=!1):("OverlayLayers"===e||"AggregatePoints"===
e||"SummarizeWithin"===e||"SummarizeNearby"===e||"FindNearest"===e||"MergeLayers"===e)&&!a&&(0===b.length||1===b.length&&(b[0]===c||!C.isDefined(c)))?(h=x.substitute(this.i18n.overlayValidationMsg,{toolName:g[n]}),z=!1):"ConnectOriginsToDestinations"===e&&!a&&(0===b.length||2>f)?(h=x.substitute(this.i18n.odPointMsg,{toolName:g[n]}),z=!1):"AggregatePoints"===e&&!a&&1<b.length?(s=k.some(b,function(a){return"esriGeometryPolygon"===a.geometryType}),s||(h=x.substitute(this.i18n.aggregatePolyMsg,{toolName:g[n]}),
z=!1)):"MergeLayers"===e&&!a&&1<b.length?1<f||(1<t||1<A)||(h=this.i18n.mergeValidationMsg,z=!1):("SummarizeWithin"===e||"DissolveBoundaries"===e)&&(c&&"esriGeometryPolygon"!==c.geometryType||!s)?(h=x.substitute(this.i18n.selectPolyLayer,{toolName:g[n]}),z=!1):"ExtractData"===e?(z=k.some(b,function(a){return-1!==a.capabilities.indexOf("Extract")}))||(h=x.substitute(this.i18n.extractValidationMsg)):"ConnectOriginsToDestinations"===e&&1<b.length&&(d=k.some(b,function(a){var s=C.isDefined(c)&&c.id===
a.id;return"esriGeometryPoint"===a.geometryType&&!s}),d||(h=x.substitute(this.i18n.odPointMsg,{toolName:g[n]}),z=!1));return e={isValid:z,validationMessage:h}},initI18n:function(){this.i18n||(this.i18n={},d.mixin(this.i18n,v.common),d.mixin(this.i18n,v.analysisTools),d.mixin(this.i18n,v.analysisMsgCodes),d.mixin(this.i18n,v.browseLayersDlg),d.mixin(this.i18n,v.driveTimes))},addBrowseAnalysisDialog:function(a){var b=[];if(a&&a.widget){this.i18n||this.initI18n();b.push({label:this.i18n.categoryAll,
value:"analysis ready"});b.push({label:this.i18n.categoryBoundaries,value:"boundaries OR places"});b.push({label:"\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;"+this.i18n.subCategoryBoundaries,value:"boundaries"});b.push({label:"\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;"+this.i18n.subCategoryPlaces,value:"places"});b.push({label:this.i18n.categoryHexBins,value:"hex"});b.push({label:this.i18n.categoryTransportation,value:"transportation"});var c=E.doc.createDocumentFragment(),c=r.create("div",{style:"width:100%;height:100%;"},
c),n=r.create("div",{style:"width:100%;height:10%;","class":""},c),g=r.create("div",{style:"width:100%"},c),s=new I({portalUrl:a.widget.get("portalUrl"),message:"",plugin:"esri/dijit/analysis/PluginAnalysisLayers",sortDescending:!0,sort:"title",self:a.widget.get("portalSelf"),categories:b,categoryType:"tags",selectedCategory:"boundaries OR places",pagingLinks:3,itemsPerPage:6,"class":"esriBrowseAnalysisLayers itemsGallery esriFloatLeading",closePopupPerRow:!1,extent:a.widget.get("map").extent,useExtent:!0,
fetchTimeout:600,galleryTemplate:'\x3cdiv style\x3d\'opacity:1;\' class\x3d\'grid-item gallery-view galleryNode\'\x3e${item:_formatItemTitle}${item:_formatThumbnail}\x3cdiv class\x3d"linksDiv" style\x3d\'display:none;\'\x3e\x3cdiv class\x3d"esriItemLinks"\x3e\x3cdiv class\x3d"esriFloatLeading"\x3e\x3ca style\x3d"text-decoration: none;"\x3e\x3cspan\x3eAdd layer to analysis\x3c/span\x3e\x3cdiv class\x3d"dijitReset dijitInline esriArrows"\x3e\x3c/div\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
formatThumbnail:function(a){return"\x3cimg class\x3d'grid-item galleryThumbnail' width\x3d'120px' height\x3d'80px' alt\x3d'' src\x3d'"+(a.thumbnailUrl||this._portal.staticImagesUrl+"/desktopapp.png")+"'\x3e"},formatItemTitle:function(a){return'\x3cdiv class\x3d"galleryLabelContainer"\x3e\x3cspan alt\x3d\''+(a.title||a.name||"\x3cNo Title\x3e")+"'\x3e"+(a.title.replace(/_/g," ")||a.name.replace(/_/g," ")||"\x3cNo Title\x3e")+"\x3c/span\x3e\x3c/div\x3e"},style:"width:600px;height:90%;clear:both;"},
g),g=r.toDom('\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"esriFloatTrailing"\x3e');r.place(g,n);n=r.create("tr",null,g);b=r.create("td",null,n);r.create("td",{innerHTML:"\x26nbsp;"},n);var n=r.create("td",null,n),h=r.create("tr",null,g),g=r.create("td",{style:"padding-bottom: 0.5em"},h);r.create("td",{style:"padding-bottom: 0.5em",innerHTML:"\x26nbsp;"},h);h=r.create("td",{style:"padding-bottom: 0.5em"},h);r.create("label",{"for":a.widget.id+"_addlayercheck","class":"",innerHTML:this.i18n.addLayer},
n);b=new z({name:"addlayer",id:a.widget.id+"_addlayercheck","class":"",value:!1,checked:!1},r.create("input",{},b));r.create("label",{"for":a.widget.id+"_addextentcheck","class":"",innerHTML:this.i18n.withinMapArea},h);new z({name:"extentcheck",id:a.widget.id+"_addextentcheck","class":"",value:!0,checked:!0,onChange:d.hitch(this,function(a){s.set("useExtent",a)})},r.create("input",{},g));c=new e({title:this.i18n.browseAnalysisTitle,content:c,doLayout:!0,browseItems:s,addlayerCheckBox:b,style:"padding:.75em 0;background-color: #fff;"});
a.widget.own(a.widget.get("map").on("extent-change",d.hitch(a.widget,function(e){console.log("new extent",a.widget.get("map").extent);s.set("extent",a.widget.get("map").extent)})));return c}},addAnalysisReadyLayer:function(a){if(C.isDefined(a)&&C.isDefined(a.item)&&C.isDefined(a.layersSelect)&&C.isDefined(a.layers)&&C.isDefined(a.browseDialog)){a.browseDialog.browseItems._closePopup();a.browseDialog.hide();var e={url:a.item.url+"/0",itemId:a.item.id,title:a.item.title,analysisReady:!0},b,c=k.some(a.layers,
function(a,s){var c=a.analysisReady&&e.analysisReady&&a.itemId===e.itemId;c&&(b=s);return c}),n,s,g,h=new A,z;c?(a.posIncrement&&(b+=a.posIncrement),a.browseDialog.addlayerCheckBox.get("checked")&&(a.posIncrement||(a.posIncrement=0),z=a.layers[b-a.posIncrement],a.widget.map.getLayer(z.lyr.id)||(this._addLayerHandle&&this._addLayerHandle.remove(),this._addLayerHandle=a.widget.map.on("layer-add",d.hitch(this,function(s){this._addLayerHandle.remove();a.widget.emit("add-ready-to-use-layer",{layer:s.layer,
layerInfo:z.linfo,item:z})})),a.widget.map.addLayer(z.lyr))),a.layersSelect.set("value",b),a.browseDialog.browseItems.clear(),h.resolve()):(h=H({url:e.url,content:{f:"json"}}),h.then(d.hitch(this,function(b){var c=new K(e.url,{outFields:["*"]});d.mixin(e,c);d.mixin(e,b);e.id=e.title+"_"+b.id;e.title=e.title.replace(/_/g," ");e.name=e.title;e.version=e.currentVersion;g=a.layersSelect.getOptions();n=g.splice(g.length-2,2);a.layersSelect.removeOption(n);s=a.layers.length;a.posIncrement&&(s+=a.posIncrement);
n.unshift({value:s,label:e.title,selected:!0});a.layersSelect.addOption(n);a.layersSelect.set("value",s);e.lyr=c;e.linfo=b;a.layers.push(e);c.name=e.name;a.browseDialog.addlayerCheckBox.get("checked")&&(this._addLayerHandle&&this._addLayerHandle.remove(),this._addLayerHandle=a.widget.map.on("layer-add",d.hitch(this,function(s){this._addLayerHandle.remove();a.widget.emit("add-ready-to-use-layer",{layer:s.layer,layerInfo:b,item:e})})),a.widget.map.addLayer(c));a.browseDialog.browseItems.clear()})));
return h.promise}},addReadyToUseLayerOption:function(a,e){a&&a.showReadyToUseLayers&&(e||(e=[]),a.signInPromise.then(d.hitch(this,function(){k.forEach(e,function(e){e.addOption({type:"separator",value:""});e.addOption({value:"browse",label:a.i18n.browseAnalysisTitle})},this);C.isDefined(a._browsedlg)||(a._browsedlg=this.addBrowseAnalysisDialog({widget:a}),a.own(a._browsedlg.browseItems.on("select-change",d.hitch(a,a._handleBrowseItemsSelect)),a._browsedlg.on("hide",d.hitch(a,function(){a._browsedlg.browseItems._closePopup();
k.forEach(e,function(a){"browse"===a.get("value")&&a.reset()})}))))})))},getMaxInputByMode:function(a){var e;if(a&&a.units&&a.type){if("StraightLine"===a.type)"Miles"===a.units?e=1E3:"Yards"===a.units?e=176E4:"Kilometers"===a.units?e=D.format(1609.34,{places:2}):"Meters"===a.units?e=D.format(1609340,{places:2}):"Feet"===a.units&&(e=528E4);else if("DrivingDistance"===a.type||"TruckingDistance"===a.type||"WalkingDistance"===a.type)"Miles"===a.units?e=300:"Yards"===a.units?e=528E3:"Kilometers"===a.units?
e=D.format(482.802,{places:2}):"Meters"===a.units?e=D.format(482802,{places:2}):"Feet"===a.units&&(e=1584E3);else if("DrivingTime"===a.type||"TruckingTime"===a.type||"WalkingTime"===a.type)"Minutes"===a.units?e=300:"Seconds"===a.units?e=18E3:"Hours"===a.units&&(e=5);return e}},updateModeConstraints:function(a){var e;a&&(a.validateWidget&&a.units&&a.type)&&(e=a.validateWidget.get("constraints"),e.max=this.getMaxInputByMode(a),a.validateWidget.set(e))},getTravelModes:function(a){var e=new A,c,n,g,s;
C.isDefined(this.travelModes)&&0<this.travelModes.length?e.resolve(this.travelModes):!a||!a.widget?e.reject(Error("Missing parameter: params.widget required parameter")):a.widget.signInPromise.then(d.hitch(this,function(h){(s=a.widget.get("helperServices"))&&s.routingUtilities?(g=s.routingUtilities.url,c="sync"):c=a.widget._getSelf(a.widget.portalUrl);G(c,d.hitch(this,function(a){var s={};a&&(a.helperServices&&a.helperServices.routingUtilities)&&(g=a.helperServices.routingUtilities.url);C.isDefined(g)?
(n=new L(g+"/GetTravelModes"),n.execute(s).then(d.hitch(this,function(a){this.travelModes=k.map(a[0].value&&a[0].value.features,function(a){return b.fromJson(a.attributes.TravelMode)});a[1]&&(a[1].paramName&&"defaultTravelMode"===a[1].paramName)&&(this.defaultTravelModeId=a[1].value);e.resolve(this.travelModes)}),d.hitch(this,function(a){e.reject(a)}))):e.reject(Error("Missing Routing Utility Service to get Travel Modes"))}),function(a){e.reject(a)})}));return e.promise},populateTravelModes:function(a){if(a&&
a.selectWidget&&a.widget){var e=[],b=a.allowmode||"all";this.initI18n();a.addStraightLine&&e.push({value:"StraightLine",label:'\x3cdiv class\x3d"esriFloatLeading bufferIcon esriStraightLineDistanceIcon"\x3e\x3c/div\x3e\x3cdiv class\x3d"esriLeadingMargin4" style\x3d"height:20px;margin-top:10px;"\x3e'+this.i18n.straightLineDistance+"\x3c/div\x3e"});this.getTravelModes({widget:a.widget}).then(d.hitch(this,function(c){k.forEach(c,function(c,s){var n=c.name,d=n.replace(/\s/g,a.separator||""),g="AUTOMOBILE"===
c.type?"Driving":"TRUCK"===c.type?"Trucking":"WALK"===c.type?"Walking":"Other",h=g.toLowerCase(),z=c.units||n.split(/\s/)[1],y=C.isDefined(a.enableTravelModes)&&!a.enableTravelModes,z=c.impedanceAttributeName===c.timeAttributeName?"Time":c.impedanceAttributeName===c.distanceAttributeName?"Distance":"Other",n={label:'\x3cdiv class\x3d"esriFloatLeading bufferIcon esri'+g+z+'Icon"\x3e\x3c/div\x3e\x3cdiv class\x3d"esriLeadingMargin4" style\x3d"height:20px;margin-top:10px;"\x3e'+n+"\x3c/div\x3e",value:d,
travelMode:c,disabled:y,modei18nKey:h,units:z};if("all"===b||b===z.toLowerCase())"all"!==b&&(n.value=n.value.replace(z,"")),a.selectDefaultMode&&(this.defaultTravelModeId&&this.defaultTravelModeId===c.id)&&(n.selected=!0),e.push(n)},this);a.selectWidget.removeOption();a.selectWidget.addOption(e);a.selectWidget.set("value",a.value);a.widget.emit("travelmodes-added",{travelOptions:e})}),d.hitch(this,function(b){e&&0<e.length&&(a.selectWidget.removeOption(),a.selectWidget.addOption(e),a.selectWidget.set("value",
a.value),a.widget.emit("travelmodes-added",{travelOptions:e}))}))}}});return m})},"esri/dijit/analysis/HelpWindow":function(){define("require dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/_base/kernel dojo/aspect dojo/has dojo/dom-construct dojo/dom-class dojo/dom-attr dojo/dom-style dojo/query dojo/window dojo/dom-geometry dijit/_Widget dijit/TooltipDialog dijit/popup ../../kernel ../../lang ../../request ../_EventedWidget dojo/i18n!../../nls/jsapi".split(" "),
function(m,d,k,f,c,b,u,w,h,q,v,l,x,p,t,B,g,r,A,D,E,G,a,n){return k([g],{declaredClass:"esri.dijit.analysis.HelpWindow",i18n:null,onlineHelpMap:null,showLearnMore:!1,"class":"esriAnalyisHelpWindow",postMixInProperties:function(){this.inherited(arguments);this.i18n={};f.mixin(this.i18n,n.common);f.mixin(this.i18n,n.analysisHelp)},postCreate:function(){this.inherited(arguments);var a=["ar","he"],b,c;this.onlineHelpMap={};for(b=0;b<a.length;b+=1)c=a[b],u.locale&&-1!==u.locale.indexOf(c)&&(-1!==u.locale.indexOf("-")?
-1!==u.locale.indexOf(c+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);a=m.toUrl("./help/helpmap.json");G({url:a}).then(f.hitch(this,function(a){this.onlineHelpMap=a.map}))},_getAbsoluteUrl:function(a){if(/^https?\:/i.test(a))return a;if(/^\/\//i.test(a))return window.location.protocol+a;if(/^\//i.test(a))return window.location.protocol+"//"+window.location.host+a},_computeSize:function(a){var b={w:400,h:200};h("esri-mobile")?b={w:"90%",h:"90%"}:-1!==a.indexOf("Category")?(b.w=400,b.h=320):
-1!==a.indexOf("Tool")?(b.w=400,b.h=320):-1!==a.indexOf("toolDescription")&&(b.w=400,b.h=520);return b},_setHelpTopicAttr:function(a){this.tooltipHelpDlg&&(A.close(this.tooltipHelpDlg),this.tooltipHelpDlg.destroy(),this.tooltipHelpDlg=null);var b,c,n,g,h="";this.showLearnMore=!1;c=this._analysisGpServer&&-1!==this._analysisGpServer.indexOf("dev")?"dev":this._analysisGpServer&&-1!==this._analysisGpServer.indexOf("qa")?"uat":"";h=this.isPortal?"-PortalOnly":"-OnlineOnly";b=f.clone(u.locale);"nb"===
b&&(b="no");n=m.toUrl("esri/dijit/analysis/help/"+this.helpFileName+".html");E.isDefined(this.onlineHelpMap[this.helpFileName])&&E.isDefined(this.onlineHelpMap[this.helpFileName][a])&&(this.showLearnMore=!0,g="http://doc"+c+".arcgis.com/en/arcgis-online/use-maps/"+this.onlineHelpMap[this.helpFileName][a]);-1!==d.indexOf("ar cs da de es el et fi fr it ja ko lt lv ru nl no pl pt-br pt-pt ro sv th tr vi zh-cn zh-hk zh-tw".split(" "),b)&&(-1!==b.indexOf("-")&&(n=b.split("-"),b=n[0]+"-"+n[1].toUpperCase()),
n=m.toUrl("esri/dijit/analysis/help/"+b+"/"+this.helpFileName+".html"));-1!==d.indexOf("ar de es fr it ja ko ru nl pl pt-br pt-pt ro zh-cn zh-hk zh-tw".split(" "),b)&&this.showLearnMore&&(g="http://doc"+c+".arcgis.com/"+b+"/arcgis-online/use-maps/"+this.onlineHelpMap[this.helpFileName][a]);this._size=c=this._computeSize(a);this.tooltipHelpDlg=new r({preload:!0,content:"\x3cdiv class\x3d'' style\x3d'position:relative'\x3cdiv class\x3d'sizer content'\x3e\x3cdiv class\x3d'contentPane'\x3e\x3cdiv class\x3d'esriFloatTrailing' style\x3d'padding:0;'\x3e\x3ca href\x3d'#' class\x3d'esriAnalysisCloseIcon' title\x3d'"+
this.i18n.close+"'\x3e\x3c/a\x3e\x3c/div\x3e\x3ciframe frameborder\x3d'0'  id\x3d'"+a+"' src\x3d'"+n+"#"+a+h+"' width\x3d'"+c.w+"' height\x3d'"+c.h+"' marginheight\x3d'0' marginwidth\x3d'0'\x3e\x3c/iframe\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'sizer'\x3e\x3cdiv class\x3d'actionsPane'\x3e\x3cdiv class\x3d'actionList"+(this.showLearnMore?"'\x3e":" hidden'\x3e")+"\x3ca class\x3d'action zoomTo' href\x3d'"+(this.showLearnMore?g:"#")+"' target\x3d'_help'\x3e"+this.i18n.learnMore+"\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
"class":"esriHelpPopup esriHelpPopupWrapper esriAnalyisHelpWindow"});this.tooltipHelpDlg.startup()},show:function(a,b){this.helpFileName=b.helpFileName;this._analysisGpServer=b.analysisGpServer;this.isPortal=b.isPortal;this.set("helpTopic",b.helpId);var c=w.after(A,"open",f.hitch(this,function(){p(".esriAnalysisCloseIcon",this.tooltipHelpDlg.domNode).on("click",f.hitch(this,this.close));c.remove()})),n=a.pageX,d=t.getBox(),g,h,r;r=!1;b.helpParentNode&&(g=b.helpParentNode);g&&(h=B.position(g));h&&
d.w-a.pageX<h.w?(r=!0,n=h.x-this._size.w-10,this._isRightToLeft&&(n-=10)):this._isRightToLeft&&n-40<this._size.w&&(n=h.w+this._size.w+80);A.open({popup:this.tooltipHelpDlg,x:!0===this._isRightToLeft||r?n-40:n+40,y:a.screenY-a.pageY+10,onCancel:f.hitch(this,function(){this.close()}),onExecute:function(){this.close()}});this.tooltipHelpDlg.domNode.parentNode&&x.set(this.tooltipHelpDlg.domNode.parentNode,"overflowY","hidden")},close:function(a,b){A.close(this.tooltipHelpDlg)}})})},"esri/dijit/BrowseItems":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/dom-class dojo/dom-style dojo/dom-attr dojo/string dojo/on dojo/aspect dojo/has dojo/dom dojo/dom-construct dojo/mouse dojo/query dojo/parser dijit/registry dijit/TooltipDialog dijit/popup dojo/promise/all dojo/Deferred dgrid/Grid dgrid/extensions/Pagination dgrid/extensions/DijitRegistry dgrid/OnDemandGrid dgrid/Selection dgrid/selector dgrid/Keyboard dgrid/util/mouse dgrid/util/touch put-selector/put dojo/store/Observable dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_FocusMixin dijit/form/Select ../arcgis/Portal ../Evented ../PluginTarget dojo/i18n!../nls/jsapi ./_RefreshMixin ../kernel ../lang ../config ../geometry/webMercatorUtils ../tasks/GeometryService ../SpatialReference".split(" "),
function(m,d,k,f,c,b,u,w,h,q,v,l,x,p,t,B,g,r,A,D,E,G,a,n,e,z,y,C,H,O,J,I,K,F,L,P,M,N,U,Q,R,s,Y,S,V,T,W,Z){var X=m(null,{idProperty:"id",constructor:function(a){m.safeMixin(this,a)},get:function(a,e){return N.PortalUtil.request(this.portalUrl+"content/items/"+a,e).then(function(a){return new N.PortalItem(d.mixin(a,{portal:this.portal}))})},getIdentity:function(a){return a[this.idProperty]},query:function(a,e){var s=d.isObject(a)?a:{q:a};if(e&&(s=d.mixin(s,{num:e.count,start:(e.start||0)+1}),e.sort&&
e.sort.length))var b=e.sort[0],s=d.mixin(s,{sortField:encodeURIComponent("created"===b.attribute?"uploaded":b.attribute),sortOrder:b.descending?"desc":"asc"});e.useExtent&&e.extent&&(s.bbox=e.extent);s=this.portal.queryItems(s,!0).then(function(a){a.results.total=a.total;return a.results});return N.PortalResult(s)}});return m([K,F,L,Q,P],{templateString:'\x3cdiv\x3e\x3cp data-dojo-attach-point\x3d"messageNode" class\x3d"hide"\x3e\x3c/p\x3e\x3cdiv style\x3d"width:100%" class\x3d"esriLeadingMargin1"\x3e\x3cselect id\x3d"${id}_categorySelect"class\x3d"categorySelect"\x3e\x3c/select\x3e\x3cdiv id\x3d"${id}_search"class\x3d"esriTrailingMargin2 esriFloatTrailing searchBar"\x3e\x3cinput class\x3d"esriSearchBox dijitTextBox" type\x3d"text" placeholder:\'${i18n.searchFor}\'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"${id}_grid"class\x3d"dgrid-autoheight"\x3e\x3c/div\x3e\x3cbr /\x3e\x3c/div\x3e',
_galleryTemplate:"\x3cdiv style\x3d'opacity:1;' class\x3d'grid-item gallery-view'\x3e${item:_formatItemTitle}${item:_formatThumbnail}\x3c/div\x3e",_popupTemplate:'\x3cdiv class\x3d"esriBrowsePopup quiet-scroll"\x3e\x3cp\x3e{summary}\x3c/p\x3e\x3c/div\x3e',baseClass:"esriBrowseItemsCtr",closePopupPerRow:!0,postMixInProperties:function(){this.inherited(arguments);this.i18n={};d.mixin(this.i18n,R.gallery)},postCreate:function(){this.inherited(arguments);this.self?(this._portal=new N.Portal({url:this.portalUrl,
self:this.self}),this._portal.on("load",d.hitch(this,this._fetchData))):(this._portal=new N.Portal(this.portalUrl),this._portal.signIn().then(d.hitch(this,this._fetchData)))},destroy:function(){this.inherited(arguments);this._grid&&this._grid.destroy();this._img_connect.remove();this._img_connect_error.remove();this._queryTimer&&clearTimeout(this._queryTimer);this._grid=this._portal=null},_setPortalUrlAttr:function(a){this.portalUrl=a},_setSelfAttr:function(a){this.self=a},_setPluginAttr:function(a){this.addPlugin(a)},
_setMessageAttr:function(a){u.set(this.messageNode,"innerHTML",a);c.remove(this.messageNode,"hide")},_setCategoriesAttr:function(a){this.categories=a},_setDisabledAttr:function(a){var e=g.findWidgets(this.domNode).concat(g.findWidgets(this._content));k.forEach(e,function(e){e.set("disabled",a)});c[a?"add":"remove"](this._interval.domNode,"dijitTextBoxDisabled")},_setSortAttr:function(a){this.sortAttribute=a},_setSortDescendingAttr:function(a){this.sortDescending=a},_getSelectionAttr:function(){var a=
this._grid.selection,e;for(e in a)if(a.hasOwnProperty(e))break;return e&&this._grid.row(e).data},_setGalleryTemplateAttr:function(a){S.isDefined(a)&&(this._galleryTemplate=a)},_setFormatThumbnailAttr:function(a){S.isDefined(a)&&"function"===typeof a&&(this._formatThumbnail=a)},_setFormatItemTitleAttr:function(a){S.isDefined(a)&&"function"===typeof a&&(this._formatItemTitle=a)},_setItemsPerPageAttr:function(a){this._set("itemsPerPage",a)},_setPagingLinksAttr:function(a){this._set("pagingLinks",a)},
_setCategoryTypeAttr:function(a){this._set("categoryType",a)},_getQueryAttr:function(){return this._grid&&this._grid.get("query")},_setQueryAttr:function(a){this._grid&&(this._grid.set("query",a),this.reset())},_setSelectedCategoryAttr:function(a){this._set("selectedCategory",a)},_setClosePopupPerRowAttr:function(a){this._set("closePopupPerRow",a)},_setExtentAttr:function(a){a&&this._set("extent",this._extentToString(a))},_setUseExtentAttr:function(a){this._set("useExtent",a)},_setFetchTimeoutAttr:function(a){this._set("fetchTimeout",
a)},_validate:function(){return!!this.get("selection")},reset:function(){this._grid&&(this._categorySelect&&(this._categorySelect.reset(),this.get("selectedCategory")?(this._origQuery=null,this._categorySelect.set("value",this.get("selectedCategory"))):(this._origQuery=null,this._categorySelect.set("value",this.categories[0].value))),t(".esriSearchBox",l.byId(this.id+"_search")).forEach(function(a){u.set(a,"value","")}))},_showPopup:function(a){if(!this._isInsideTooltipDialog){this._closePopup();
var e=this._grid.row(a),s=t("img",e.element)[0];if((e={summary:e.data.snippet})&&e.summary)this._tooltip=new r({content:d.replace(this._popupTemplate,e),onMouseEnter:d.hitch(this,function(){this._isInsideTooltipDialog=!0}),onMouseLeave:d.hitch(this,function(){this._isInsideTooltipDialog=!1;this._closePopup(a)})}),A.open({className:"esriBrowsePopupCtr",popup:this._tooltip,around:s,orient:["after-centered","before-centered"]}),this._onCloseConnect=t(".dijitDialogCloseIcon",this._tooltip.domNode).on("click",
d.hitch(this,function(a){a.preventDefault();this._closePopup()}))}},_closePopup:function(){this._tooltip&&(this._onCloseConnect.remove(),A.close(this._tooltip),this._tooltip.destroyRecursive(),this._tooltip=this._onCloseConnect=void 0)},_clearQueryTimeout:function(){clearTimeout(this._queryTimer)},_createGrid:function(){var e=m([G,a,z,s,n]),b=new I(new X({portal:this._portal})),c=this._currentFilter,g=d.hitch(this,function(a){a.snippet=a.snippet||"";var e=J("div");a=w.substitute(this._galleryTemplate,
{item:a,i18n:this.i18n},null,this);x.place(a,e);return e}),r={};this.get("useExtent")&&(r.extent=this.get("extent"),r.useExtent=this.get("useExtent"));this._grid=new e({store:b,className:"dgrid-autoheight",query:c,selectionMode:"single",pagingLinks:this.get("pagingLinks")||2,rowsPerPage:this.get("itemsPerPage")||6,loadingMessage:"Loading items...",showLoadingMessage:!1,renderRow:g,noDataMessage:this.i18n.noItemsToDisplay,sort:[{attribute:"title"}],queryOptions:r},this.id+"_grid");this._grid.startup();
this.categories&&0<this.categories.length&&(this._categorySelect=new M({options:this.categories,sortByLabel:!1,"class":"categorySelect"},this.id+"_categorySelect"),this.own(this._categorySelect.on("change",d.hitch(this,function(a){var e;this._closePopup();this._origQuery||(this._origQuery=this._grid.get("query"));e=this._origQuery;a&&(e+=" AND ("+this.get("categoryType")+":"+a+")");this._fetchItems(e)}))));this.own(this._grid.on(H.enterRow,d.hitch(this,function(a){this._showPopup(a)})),this._grid.on(H.leaveRow,
d.hitch(this,function(a){this.get("closePopupPerRow")&&this._closePopup(a)})),h(t(".dgrid-footer,.dgrid-header",this._grid.domNode),p.leave,d.hitch(this,function(a){this._closePopup(a)})),this._grid.on("dgrid-refresh-complete",d.hitch(this,function(a){this._closePopup(a);t(".dgrid-footer",this.domNode)[this._grid._total<=this._grid.rowsPerPage?"addClass":"removeClass"]("hide")})),this._grid.on("refresh",d.hitch(this,function(){this._img_connect&&(this._img_connect.remove(),this._img_connect_error.remove(),
this._img_connect_error=this._img_connect=null);this._img_connect=t(".grid-item-thumb",this._grid.domNode).on("load",d.hitch(this,function(a){(a=this._grid.row(a))&&a.element&&t(".grid-item",a.element).addClass("fadeIn").style("opacity","1")}));this._img_connect_error=t(".grid-item-thumb",this._grid.domNode).on("error",d.hitch(this,function(a){u.set(a.target,"src",this._portal.staticImagesUrl+"/desktopapp.png")}))})),this._grid.on("dgrid-select,dgrid-deselect",d.hitch(this,function(){var a={selection:this.get("selection")};
this.emit("select-change",a)})),h(l.byId(this.id+"_search"),"keyup",d.hitch(this,function(a){a.preventDefault();this._closePopup();this._clearQueryTimeout();this._queryTimer=setTimeout(d.hitch(this,function(){this._fetchItems(this._currentFilter,u.get(a.target,"value"))}),this.searchKeypressDelay||250)})),this.watch("extent",d.hitch(this,function(a,e,s){this._grid.queryOptions.extent=this.get("extent");this._grid.queryOptions.useExtent=this.get("useExtent");this._grid.refresh()})),this.watch("useExtent",
d.hitch(this,function(a,e,s){this._grid.queryOptions.extent=this.get("extent");this._grid.queryOptions.useExtent=s;this._grid.refresh()})))},_fetchData:function(){this._user=this._portal.getPortalUser();return this.plugIn.fetchData()},_fetchItems:function(a,e){var s={sort:[{attribute:this.sortAttribute||"title",descending:this.sortDescending||!1}]},b=e?" title:"+e+"* ":"",c=new E;this.get("extent")&&(s.extent=this.extent);s.useExtent=this.get("useExtent");setTimeout(d.hitch(this,function(){this._currentFilter=
a;this._grid?this._grid.set("query",this._currentFilter+b,s):this._createGrid();c.resolve(this._grid)}),this.fetchTimeout||60);return c},_formatThumbnail:function(a){return"\x3cimg class\x3d'grid-item-thumb' width\x3d'187px' height\x3d'125px' alt\x3d'' src\x3d'"+(a.thumbnailUrl||this._portal.staticImagesUrl+"/desktopapp.png")+"'\x3e"},_formatItemTitle:function(a){return"\x3ch5\x3e"+(a.title||a.name||"\x3cNo Title\x3e")+"\x3c/h5\x3e"},clear:function(){this._grid.clearSelection()},doProject:function(a,
e){var s=[102113,102100,3857],b=new E,c,n,d;c=function(a,e){a&&0<a.length&&a[0]&&"extent"==a[0].type&&!isNaN(a[0].xmin)&&!isNaN(a[0].ymin)&&!isNaN(a[0].xmax)&&!isNaN(a[0].ymax)?b.resolve(a,e):a&&(0<a.length&&a[0]&&"point"==a[0].type&&!isNaN(a[0].x)&&!isNaN(a[0].y))&&b.resolve(a,e)};if(null!=a.spatialReference.wkid&&4326==a.spatialReference.wkid&&null!=e.wkid&&this.contains(s,e.wkid)){a.ymin=Math.max(a.ymin,-89.99);a.ymax=Math.min(a.ymax,89.99);s=T.geographicToWebMercator(a);if((c=s.spatialReference._getInfo())&&
s.xmin>s.xmax)n=c.valid[1]-s.xmin,d=s.xmax-c.valid[0],n>d?s.xmax=c.valid[1]+d:s.xmin=c.valid[0]-n;s.spatialReference.wkid=e.wkid;b.resolve([s])}else if(null!=a.spatialReference.wkid&&this.contains(s,a.spatialReference.wkid)&&null!=e.wkid&&4326==e.wkid){s=T.webMercatorToGeographic(a);if((c=s.spatialReference._getInfo())&&s.xmin>s.xmax)n=c.valid[1]-s.xmin,d=s.xmax-c.valid[0],n>d?s.xmax=c.valid[1]+d:s.xmin=c.valid[0]-n;b.resolve([s])}else this.geometryService||(this.geometryService=new W(V.defaults.geometryService)),
this.geometryService.project([a],e,c);return b},contains:function(a,e){for(var s=a.length;s--;)if(a[s]===e)return!0;return!1},_extentToGCS:function(a){a=a.shiftCentralMeridian(!0);return T.webMercatorToGeographic(a)},_extentToString:function(a){var e="";null!=a&&(a=this._extentToGCS(a),e=this._roundValue(a.xmin,1E4)+","+this._roundValue(a.ymin,1E4)+","+this._roundValue(a.xmax,1E4)+","+this._roundValue(a.ymax,1E4));return e},_roundValue:function(a,e){return Math.round(a*e)/e}})})},"dgrid/extensions/Pagination":function(){define("../_StoreMixin dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/Deferred dojo/on dojo/query dojo/string dojo/has put-selector/put ../util/misc dojo/i18n!./nls/pagination dojo/_base/sniff xstyle/css!../css/extensions/Pagination.css".split(" "),
function(m,d,k,f,c,b,u,w,h,q,v,l){function x(b){b.noDataNode?(q(b.noDataNode,"!"),delete b.noDataNode):b.cleanup();b.contentNode.innerHTML=""}function p(b){if(b.loadingNode)q(b.loadingNode,"!"),delete b.loadingNode;else if(b._oldPageNodes){for(var c in b._oldPageNodes)b.removeRow(b._oldPageNodes[c]);delete b._oldPageNodes;b._oldPageObserver&&(b._oldPageObserver.cancel(),b._numObservers--,delete b._oldPageObserver)}delete b._isLoading}return d("dgrid.extensions.Pagination",m,{rowsPerPage:10,pagingTextBox:!1,
previousNextArrows:!0,firstLastArrows:!1,pagingLinks:2,pageSizeOptions:null,showLoadingMessage:!0,i18nPagination:l,showFooter:!0,_currentPage:1,_total:0,buildRendering:function(){this.inherited(arguments);var c=this,d=this.paginationNode=q(this.footerNode,"div.dgrid-pagination"),g=this.paginationStatusNode=q(d,"div.dgrid-status"),h=this.i18nPagination;g.tabIndex=0;this._updatePaginationSizeSelect();this._updateRowsPerPageOption();g.innerHTML=w.substitute(h.status,{start:1,end:1,total:0});d=this.paginationNavigationNode=
q(d,"div.dgrid-navigation");this.firstLastArrows&&(g=this.paginationFirstNode=q(d,"span.dgrid-first.dgrid-page-link","\u00ab"),g.setAttribute("aria-label",h.gotoFirst),g.tabIndex=0);this.previousNextArrows&&(g=this.paginationPreviousNode=q(d,"span.dgrid-previous.dgrid-page-link","\u2039"),g.setAttribute("aria-label",h.gotoPrev),g.tabIndex=0);this.paginationLinksNode=q(d,"span.dgrid-pagination-links");this.previousNextArrows&&(g=this.paginationNextNode=q(d,"span.dgrid-next.dgrid-page-link","\u203a"),
g.setAttribute("aria-label",h.gotoNext),g.tabIndex=0);this.firstLastArrows&&(g=this.paginationLastNode=q(d,"span.dgrid-last.dgrid-page-link","\u00bb"),g.setAttribute("aria-label",h.gotoLast),g.tabIndex=0);this._listeners.push(b(d,".dgrid-page-link:click,.dgrid-page-link:keydown",function(b){if(!("keydown"===b.type&&13!==b.keyCode)){b=this.className;var d,g;c._isLoading||-1<b.indexOf("dgrid-page-disabled")||(d=c._currentPage,g=Math.ceil(c._total/c.rowsPerPage),this===c.paginationPreviousNode?c.gotoPage(d-
1):this===c.paginationNextNode?c.gotoPage(d+1):this===c.paginationFirstNode?c.gotoPage(1):this===c.paginationLastNode?c.gotoPage(g):"dgrid-page-link"===b&&c.gotoPage(+this.innerHTML))}}))},destroy:function(){this.inherited(arguments);this._pagingTextBoxHandle&&this._pagingTextBoxHandle.remove()},_updatePaginationSizeSelect:function(){var c=this.pageSizeOptions,d=this.paginationSizeSelect,g;if(c&&c.length){d||(d=this.paginationSizeSelect=q(this.paginationNode,"select.dgrid-page-size[aria-label\x3d"+
this.i18nPagination.rowsPerPage+"]"),g=this._paginationSizeChangeHandle=b(d,"change",f.hitch(this,function(){this.set("rowsPerPage",+this.paginationSizeSelect.value)})),this._listeners.push(g));for(g=d.options.length=0;g<c.length;g++)q(d,"option",c[g],{value:c[g],selected:this.rowsPerPage===c[g]});this._updateRowsPerPageOption()}else if((!c||!c.length)&&d)q(d,"!"),this.paginationSizeSelect=null,this._paginationSizeChangeHandle.remove()},_setPageSizeOptions:function(b){this.pageSizeOptions=b&&b.sort(function(b,
c){return b-c});this._updatePaginationSizeSelect()},_updateRowsPerPageOption:function(){var b=this.rowsPerPage,c=this.pageSizeOptions,d=this.paginationSizeSelect;d&&(0>k.indexOf(c,b)?this._setPageSizeOptions(c.concat([b])):d.value=""+b)},_setRowsPerPage:function(b){this.rowsPerPage=b;this._updateRowsPerPageOption();this.gotoPage(1)},_updateNavigation:function(){function c(n,d){var l,k;g.pagingTextBox&&n==w&&1<a?(l=q(f,"input.dgrid-page-input[type\x3dtext][value\x3d$]",w),l.setAttribute("aria-label",
h.jumpPage),g._pagingTextBoxHandle=b(l,"change",function(){var e=+this.value;!isNaN(e)&&(0<e&&e<=a)&&g.gotoPage(+this.value)}),e&&"INPUT"===e.tagName&&l.focus()):(k=n===w,l=q(f,"span"+(k?".dgrid-page-disabled":"")+".dgrid-page-link",n+(d?" ":"")),l.setAttribute("aria-label",h.gotoPage),l.tabIndex=k?-1:0,z===n&&(k?n<a?z++:y.focus():l.focus()),k||(y=l))}function d(a,e){q(a,(e?".":"!")+"dgrid-page-disabled");a.tabIndex=e?-1:0}var g=this,h=this.i18nPagination,f=this.paginationLinksNode,w=this._currentPage,
l=this.pagingLinks,k=this.paginationNavigationNode,a=Math.ceil(this._total/this.rowsPerPage),n=this._pagingTextBoxHandle,e=document.activeElement,z,y;!e||!v.contains(this.paginationNavigationNode,e)?e=null:"dgrid-page-link"===e.className&&(z=+e.innerHTML);n&&n.remove();f.innerHTML="";u(".dgrid-first, .dgrid-previous",k).forEach(function(a){d(a,1===w)});u(".dgrid-last, .dgrid-next",k).forEach(function(e){d(e,w>=a)});if(l&&0<a){c(1,!0);k=w-l;for(2<k?q(f,"span.dgrid-page-skip","..."):k=2;k<Math.min(w+
l+1,a);k++)c(k,!0);w+l+1<a&&q(f,"span.dgrid-page-skip","...");1<a&&c(a)}else g.pagingTextBox&&c(w);e&&-1===e.tabIndex&&(l=u("[tabindex\x3d'0']",this.paginationNavigationNode),e===this.paginationPreviousNode||e===this.paginationFirstNode?e=l[0]:l.length&&(e=l[l.length-1]),e&&e.focus())},refresh:function(){var c=this;this.inherited(arguments);if(this.store)return this.gotoPage(1).then(function(d){setTimeout(function(){b.emit(c.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:c,results:d})},
0);return d});console.warn("Pagination requires a store to operate.")},_onNotification:function(b){b.length!==this._rowsOnPage&&this.gotoPage(this._currentPage)},renderArray:function(b,d){var g=this,h=this.inherited(arguments);this._lastCollection=null;d||(this._topLevelRequest&&this._topLevelRequest!==b&&(this._topLevelRequest.cancel(),delete this._topLevelRequest),"function"===typeof b.cancel&&(this._topLevelRequest=b),c.when(b,function(){g._topLevelRequest&&delete g._topLevelRequest}));return h},
insertRow:function(){var b=this._oldPageNodes,c=this.inherited(arguments);b&&c===b[c.id]&&delete b[c.id];return c},gotoPage:function(b){var d=this,g=new c;this._trackError(function(){var r=d.rowsPerPage,l=(b-1)*r,k=f.mixin(d.get("queryOptions"),{start:l,count:r}),u,v=d.contentNode,a,n,e;if(d.showLoadingMessage)x(d),a=d.loadingNode=q(v,"div.dgrid-loading"),a.innerHTML=d.loadingMessage;else{d._oldPageNodes=a={};v=v.children;n=0;for(e=v.length;n<e;n++)a[v[n].id]=v[n];d._oldPageObserver=d.observers.pop()}d._isLoading=
!0;u=d.store.query(d.query,k);c.when(d.renderArray(u,null,k),function(a){p(d);d.scrollTo({y:0});c.when(u.total,function(e){e||(d.noDataNode&&(q(d.noDataNode,"!"),delete d.noDataNode),d.noDataNode=q(d.contentNode,"div.dgrid-no-data"),d.noDataNode.innerHTML=d.noDataMessage);d.paginationStatusNode.innerHTML=w.substitute(d.i18nPagination.status,{start:Math.min(l+1,e),end:Math.min(e,l+r),total:e});d._total=e;d._currentPage=b;d._rowsOnPage=a.length;d._updateNavigation()});(7>h("ie")||h("ie")&&h("quirks"))&&
d.resize();g.resolve(u)},function(a){p(d);g.reject(a)});return g.promise})||g.reject();return g.promise}})})},"dgrid/extensions/DijitRegistry":function(){define(["dojo/_base/declare","dojo/dom-geometry","dijit/registry"],function(m,d,k){return m("dgrid.extensions.DijitRegistry",null,{minSize:0,maxSize:Infinity,layoutPriority:0,showTitle:!0,buildRendering:function(){k.add(this);this.inherited(arguments);this.domNode.setAttribute("widgetId",this.id)},startup:function(){if(!this._started){this.inherited(arguments);
var d=k.getEnclosingWidget(this.domNode.parentNode);d&&d.isLayoutContainer&&this._resizeHandle.remove()}},destroyRecursive:function(){this.destroy()},destroy:function(){this.inherited(arguments);k.remove(this.id)},getChildren:function(){return[]},isLeftToRight:function(){return!this.isRTL},resize:function(f){f&&d.setMarginBox(this.domNode,f);this.inherited(arguments)},_set:function(d,c){this[d]=c},watch:function(){},getParent:function(){return k.getEnclosingWidget(this.domNode.parentNode)}})})},"dgrid/selector":function(){define("dojo/_base/kernel dojo/_base/array dojo/_base/lang dojo/on dojo/aspect dojo/_base/sniff put-selector/put".split(" "),
function(m,d,k,f,c,b,u){k.getObject("dgrid.selector",!0);return dgrid.selector=function(f,h){function q(b){return!t.allowSelect(t.row(b))}function k(b){return function(c){var d=c.rows,g=d.length;c="false";var h;for(h=0;h<g;h++){var a=t.cell(d[h],f.id).element;if(a&&(a=(a.contents||a).input)&&!a.disabled)a.checked=b,a.setAttribute("aria-checked",b)}if("checkbox"==B.type){d=t.selection;g=!1;for(h in d)if(d[h]!=t.allSelected){g=!0;break}B.indeterminate=g;B.checked=t.allSelected;g?c="mixed":t.allSelected&&
(c="true");B.setAttribute("aria-checked",c)}}}function l(c){if("click"==c.type||32==c.keyCode||!b("opera")&&13==c.keyCode||0===c.keyCode){var d=t.row(c);t._selectionTriggerEvent=c;if(d){if(t.allowSelect(d)){var g=t._lastSelected&&t.row(t._lastSelected);if("radio"==h){if(!g||g.id!=d.id)t.clearSelection(),t.select(d,null,!0),t._lastSelected=d.element}else d&&(c.shiftKey?k(!0)({rows:[d]}):g=null,g=c.shiftKey?g:null,t.select(g||d,d,g?void 0:null),t._lastSelected=d.element)}}else u(this,(t.allSelected?
"!":".")+"dgrid-select-all"),t[t.allSelected?"clearSelection":"selectAll"]();t._selectionTriggerEvent=null}}function x(){t._hasSelectorInputListener=!0;p.push(t.on(".dgrid-selector:click,.dgrid-selector:keydown",l));var b=t._handleSelect;t._handleSelect=function(c){this.cell(c).column!=f&&b.apply(this,arguments)};if("function"==typeof f.disabled){var c=t.allowSelect,d=f.disabled;t.allowSelect=function(b){var g=c.call(this,b);return d===q?g:g&&!d.call(f,b.data)}}f.disabled=q;p.push(t.on("dgrid-select",
k(!0)));p.push(t.on("dgrid-deselect",k(!1)))}var p=[],t,B;f||(f={});f.type&&(f.selectorType=f.type,m.deprecated("columndef.type","use columndef.selectorType instead","dgrid 0.4"));f.selectorType=h=h||f.selectorType||"checkbox";f.sortable=!1;var g="function"==typeof h?h:function(b,c,d){var g=c.parentNode,l;t._hasSelectorInputListener||x();l=f.disabled;u(g&&g.contents?g:c,".dgrid-selector");c=c.input||(c.input=u(c,"input[type\x3d"+h+"]",{tabIndex:isNaN(f.tabIndex)?-1:f.tabIndex,disabled:l&&("function"==
typeof l?l.call(f,d):l),checked:b}));c.setAttribute("aria-checked",!!b);return c};c.after(f,"init",function(){t=f.grid});c.after(f,"destroy",function(){d.forEach(p,function(b){b.remove()});t._hasSelectorInputListener=!1});f.renderCell=function(b,c,d,h,f){c=(c=b&&t.row(b))&&t.selection[c.id];g(c,d,b)};f.renderHeaderCell=function(b){var c="label"in f?f.label:f.field||"";"radio"==h||!t.allowSelectAll?(b.appendChild(document.createTextNode(c)),t._hasSelectorInputListener||x()):g(!1,b,{});B=b.lastChild};
return f}})},"dgrid/Keyboard":function(){define("dojo/_base/declare dojo/aspect dojo/on dojo/_base/lang dojo/has put-selector/put ./util/misc dojo/_base/Deferred dojo/_base/sniff".split(" "),function(m,d,k,f,c,b,u,w){function h(a){a.preventDefault()}var q={checkbox:1,radio:1,button:1},v=/\bdgrid-cell\b/,l=/\bdgrid-row\b/,x=m("dgrid.Keyboard",null,{pageSkip:10,tabIndex:0,keyMap:null,headerKeyMap:null,postMixInProperties:function(){this.inherited(arguments);this.keyMap||(this.keyMap=f.mixin({},x.defaultKeyMap));
this.headerKeyMap||(this.headerKeyMap=f.mixin({},x.defaultHeaderKeyMap))},postCreate:function(){function a(e){var b=e.target;return b.type&&(!q[b.type]||32==e.keyCode)}function b(n){function g(){c._focusedHeaderNode&&(c._focusedHeaderNode.tabIndex=-1);if(c.showHeader){if(h)for(var a=0,e,b=c.headerNode.getElementsByTagName("th");e=b[a];++a){if(f.test(e.className)){c._focusedHeaderNode=r=e;break}}else c._focusedHeaderNode=r=c.headerNode;r&&(r.tabIndex=c.tabIndex)}}var h=c.cellNavigation,f=h?v:l,z=n===
c.headerNode,r=n;z?(g(),d.after(c,"renderHeader",g,!0)):d.after(c,"renderArray",function(a){return w.when(a,function(a){var e=c._focusedNode||r;if(f.test(e.className)&&u.contains(n,e))return a;for(var b=0,d=n.getElementsByTagName("*"),g;g=d[b];++b)if(f.test(g.className)){e=c._focusedNode=g;break}e.tabIndex=c.tabIndex;return a})});c._listeners.push(k(n,"mousedown",function(b){a(b)||c._focusOnNode(b.target,z,b)}));c._listeners.push(k(n,"keydown",function(b){if(!b.metaKey&&!b.altKey){var d=c[z?"headerKeyMap":
"keyMap"][b.keyCode];d&&!a(b)&&d.call(c,b)}}))}this.inherited(arguments);var c=this;this.tabableHeader&&(b(this.headerNode),k(this.headerNode,"dgrid-cellfocusin",function(){c.scrollTo({x:this.scrollLeft})}));b(this.contentNode);this._debouncedEnsureRowScroll=u.debounce(this._ensureRowScroll,this)},removeRow:function(a){if(!this._focusedNode)return this.inherited(arguments);var b=this,c=document.activeElement===this._focusedNode,d=this[this.cellNavigation?"cell":"row"](this._focusedNode),n=d.row||
d,g;a=a.element||a;if(a===n.element){g=this.down(n,!0);if(!g||g.element===a)g=this.up(n,!0);this._removedFocus={active:c,rowId:n.id,columnId:d.column&&d.column.id,siblingId:!g||g.element===a?void 0:g.id};setTimeout(function(){b._removedFocus&&b._restoreFocus(n.id)},0);this._focusedNode=null}this.inherited(arguments)},insertRow:function(a){var b=this.inherited(arguments);this._removedFocus&&!this._removedFocus.wait&&this._restoreFocus(b);return b},_restoreFocus:function(a){var c=this._removedFocus,
d;if((a=(a=a&&this.row(a))&&a.element&&a.id===c.rowId?a:"undefined"!==typeof c.siblingId&&this.row(c.siblingId))&&a.element){if(!a.element.parentNode.parentNode){c.wait=!0;return}"undefined"!==typeof c.columnId&&(d=this.cell(a,c.columnId))&&d.element&&(a=d);c.active&&0!==a.element.offsetHeight?this._focusOnNode(a,!1,null):(b(a.element,".dgrid-focus"),a.element.tabIndex=this.tabIndex,this._focusedNode=a.element)}delete this._removedFocus},addKeyHandler:function(a,b,c){return d.after(this[c?"headerKeyMap":
"keyMap"],a,b,!0)},_ensureRowScroll:function(a){var b=this.getScrollPosition().y;b>a.offsetTop?this.scrollTo({y:a.offsetTop}):b+this.contentNode.offsetHeight<a.offsetTop+a.offsetHeight&&this.scrollTo({y:a.offsetTop-this.contentNode.offsetHeight+a.offsetHeight})},_focusOnNode:function(a,d,n){var g="_focused"+(d?"Header":"")+"Node",h=this[g],r=this.cellNavigation?"cell":"row",q=this[r](a),u,w,A,p,m;if(a=q&&q.element){if(this.cellNavigation){u=a.getElementsByTagName("input");m=0;for(A=u.length;m<A;m++)if(w=
u[m],(-1!=w.tabIndex||"_dgridLastValue"in w)&&!w.disabled){8>c("ie")&&(w.style.position="relative");w.focus();8>c("ie")&&(w.style.position="");p=!0;break}}null!==n&&(n=f.mixin({grid:this},n),n.type&&(n.parentType=n.type),n.bubbles||(n.bubbles=!0));h&&(b(h,"!dgrid-focus[!tabIndex]"),8>c("ie")&&(h.style.position=""),n&&(n[r]=this[r](h),k.emit(h,"dgrid-cellfocusout",n)));h=this[g]=a;n&&(n[r]=q);g=this.cellNavigation?v:l;!p&&g.test(a.className)&&(8>c("ie")&&(a.style.position="relative"),a.tabIndex=this.tabIndex,
a.focus());b(a,".dgrid-focus");n&&k.emit(h,"dgrid-cellfocusin",n);this.cellNavigation&&((this.columnSets||1<this.subRows.length)&&!d)&&this._debouncedEnsureRowScroll(q.row.element)}},focusHeader:function(a){this._focusOnNode(a||this._focusedHeaderNode,!0)},focus:function(a){(a=a||this._focusedNode)?this._focusOnNode(a,!1):this.contentNode.focus()}}),p=x.moveFocusVertical=function(a,b){var c=this.cellNavigation,d=this[c?"cell":"row"](a),d=c&&d.column.id,n=this.down(this._focusedNode,b,!0);c&&(n=this.cell(n,
d));this._focusOnNode(n,!1,a);a.preventDefault()};m=x.moveFocusUp=function(a){p.call(this,a,-1)};var t=x.moveFocusDown=function(a){p.call(this,a,1)},B=x.moveFocusPageUp=function(a){p.call(this,a,-this.pageSkip)},g=x.moveFocusPageDown=function(a){p.call(this,a,this.pageSkip)},r=x.moveFocusHorizontal=function(a,b){if(this.cellNavigation){var c=!this.row(a);this._focusOnNode(this.right(this["_focused"+(c?"Header":"")+"Node"],b),c,a);a.preventDefault()}},A=x.moveFocusLeft=function(a){r.call(this,a,-1)},
D=x.moveFocusRight=function(a){r.call(this,a,1)},E=x.moveHeaderFocusEnd=function(a,b){var c;this.cellNavigation&&(c=this.headerNode.getElementsByTagName("th"),this._focusOnNode(c[b?0:c.length-1],!0,a));a.preventDefault()},G=x.moveHeaderFocusHome=function(a){E.call(this,a,!0)},a=x.moveFocusEnd=function(a,b){var n=this,g=this.cellNavigation,h=this.contentNode,l=h.scrollTop+(b?0:h.scrollHeight),h=h[b?"firstChild":"lastChild"],r=-1<h.className.indexOf("dgrid-preload"),q=r?h[(b?"next":"previous")+"Sibling"]:
h,k=q.offsetTop+(b?0:q.offsetHeight),u;if(r){for(;q&&0>q.className.indexOf("dgrid-row");)q=q[(b?"next":"previous")+"Sibling"];if(!q)return}!r||1>h.offsetHeight?(g&&(q=this.cell(q,this.cell(a).column.id)),this._focusOnNode(q,!1,a)):(c("dom-addeventlistener")||(a=f.mixin({},a)),u=d.after(this,"renderArray",function(c){u.remove();return w.when(c,function(c){c=c[b?0:c.length-1];g&&(c=n.cell(c,n.cell(a).column.id));n._focusOnNode(c,!1,a)})}));l===k&&a.preventDefault()},n=x.moveFocusHome=function(b){a.call(this,
b,!0)};x.defaultKeyMap={32:h,33:B,34:g,35:a,36:n,37:A,38:m,39:D,40:t};x.defaultHeaderKeyMap={32:h,35:E,36:G,37:A,39:D};return x})},"dgrid/util/mouse":function(){define(["dojo/_base/lang","dojo/on","dojo/dom","dojo/query"],function(m,d,k){function f(b,c){return function(f,h){return d(f,b+":"+c,function(b){if(!k.isDescendant(b.relatedTarget,this))return h.call(this,b)})}}var c={enterRow:f(".dgrid-content .dgrid-row","mouseover"),enterCell:f(".dgrid-content .dgrid-cell","mouseover"),enterHeaderCell:f(".dgrid-header .dgrid-cell",
"mouseover"),leaveRow:f(".dgrid-content .dgrid-row","mouseout"),leaveCell:f(".dgrid-content .dgrid-cell","mouseout"),leaveHeaderCell:f(".dgrid-header .dgrid-cell","mouseout"),createDelegatingHandler:f};m.getObject("dgrid.util.mouse",!0);m.mixin(dgrid.util.mouse,c);return c})},"dgrid/util/touch":function(){define(["dojo/on","dojo/query"],function(m,d){function k(c,b,d,k){if(!(1<d.targetTouches.length)){var h=d.changedTouches[0],q=h.screenX,v=h.screenY;k&&d.preventDefault();var l=m(c,"touchend",function(c){var d=
c.changedTouches[0];c.targetTouches.length||(Math.abs(d.screenX-q)<f.tapRadius&&Math.abs(d.screenY-v)<f.tapRadius&&(k&&c.preventDefault(),b.call(this,c)),l.remove())})}}var f={tapRadius:10,dbltapTime:250,selector:function(c,b,f){return function(k,h){var q=b.bubble;q?b=q:!1!==f&&(f=!0);return m(k,b,function(b){var l=b.target;3==l.nodeType&&(l=l.parentNode);for(;!d.matches(l,c,k);)if(l==k||!f||!(l=l.parentNode))return;return h.call(l,b)})}},countCurrentTouches:function(c,b){if(!("touches"in c))return-1;
var d,f,h;for(f=d=0;h=c.touches[d];++d)b.contains(h.target)&&++f;return f},tap:function(c,b){return m(c,"touchstart",function(d){k(c,b,d)})},dbltap:function(c,b){var d,w;return m(c,"touchstart",function(h){d?k(c,function(c){if(d){var h=c.changedTouches[0];Math.abs(h.screenX-d.screenX)<f.tapRadius&&Math.abs(h.screenY-d.screenY)<f.tapRadius&&(w&&clearTimeout(w),d=w=null,b.call(this,c))}},h,!0):k(c,function(b){d=b.changedTouches[0];w=setTimeout(function(){d=w=null},f.dbltapTime)},h)})}};return f})},
"dojo/store/Observable":function(){define(["../_base/kernel","../_base/lang","../when","../_base/array"],function(m,d,k,f){m=function(c){function b(b,d){var h=c[b];h&&(c[b]=function(f){var m;"put"===b&&(m=c.getIdentity(f));if(q)return h.apply(this,arguments);q=!0;try{var w=h.apply(this,arguments);k(w,function(b){d("object"==typeof b&&b||f,m)});return w}finally{q=!1}})}var m=[],w=0;c=d.delegate(c);c.notify=function(b,c){w++;for(var d=m.slice(),h=0,f=d.length;h<f;h++)d[h](b,c)};var h=c.query;c.query=
function(b,l){l=l||{};var q=h.apply(this,arguments);if(q&&q.forEach){var p=d.mixin({},l);delete p.start;delete p.count;var t=c.queryEngine&&c.queryEngine(b,p),B=w,g=[],r;q.observe=function(b,d){1==g.push(b)&&m.push(r=function(b,a){k(q,function(n){var e=n.length!=l.count,h,r;if(++B!=w)throw Error("Query is out of date, you must observe() the query prior to any data modifications");var q,k=-1,m=-1;if(void 0!==a){h=0;for(r=n.length;h<r;h++){var A=n[h];if(c.getIdentity(A)==a){q=A;k=h;(t||!b)&&n.splice(h,
1);break}}}if(t){if(b&&(t.matches?t.matches(b):t([b]).length))h=-1<k?k:n.length,n.splice(h,0,b),m=f.indexOf(t(n),b),n.splice(h,1),l.start&&0==m||!e&&m==n.length?m=-1:n.splice(m,0,b)}else b&&(void 0!==a?m=k:l.start||(m=c.defaultIndex||0,n.splice(m,0,b)));if((-1<k||-1<m)&&(d||!t||k!=m)){e=g.slice();for(h=0;n=e[h];h++)n(b||q,k,m)}})});var h={};h.remove=h.cancel=function(){var c=f.indexOf(g,b);-1<c&&(g.splice(c,1),g.length||m.splice(f.indexOf(m,r),1))};return h}}return q};var q;b("put",function(b,d){c.notify(b,
d)});b("add",function(b){c.notify(b)});b("remove",function(b){c.notify(void 0,b)});return c};d.setObject("dojo.store.Observable",m);return m})},"esri/arcgis/Portal":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/_base/array dojo/_base/sniff require ../kernel ../lang ../request ../Evented ../IdentityManager".split(" "),function(m,d,k,f,c,b,u,w,h,q,v){var l={options:{disableIdentityLookup:!0},requestParams:{f:"json"}},x=function(a){function b(e){a[e]||
(a[e]=function(){var b=arguments;return f.when(a,function(a){Array.prototype.unshift.call(b,a.results||a);return x(c[e].apply(c,b))})})}if(!a)return a;a.then&&(a=d.delegate(a));a.total||(a.total=f.when(a,function(a){return h.isDefined(a.total)?a.total:a.length||0}));b("forEach");b("filter");b("map");b("some");b("every");return a},p={useSSL:function(a,b){var c=l&&l.self||{};if(c&&!c.isPortal)return-1!==a.indexOf("https:")||c.allSSL?b.replace("http:","https:"):b;var d=p.getLocation(b);if(-1<c.portalHostname.toLowerCase().indexOf(d.hostname.toLowerCase())&&
d.port&&"80"!==d.port&&"443"!==d.port){var g=d.pathname,g=0===g.indexOf("/")?g:"/"+g;return c.allSSL||-1<a.indexOf("https:")?"https://"+d.hostname+(c.httpsPort&&"443"!==c.httpsPort?":"+c.httpsPort:"")+g+d.search:"http://"+d.hostname+(c.httpPort&&"80"!==c.httpPort?":"+c.httpPort:"")+g+d.search}return-1!==a.indexOf("https:")||c.allSSL?b.replace("http:","https:"):b},formatUrl:function(a){var b=l.currentToken;return-1!==a.indexOf("null")?null:p.useSSL(window.location.protocol,b?a+(-1!==a.indexOf("?")?
"\x26":"?")+("token\x3d"+b):a)},getLocation:function(a){var b=document.createElement("a");b.href=a;return{protocol:b.protocol,hostname:b.hostname,port:b.port,pathname:b.pathname,search:b.search,hash:b.hash,host:b.host}},resultsToTypedArray:function(a,b,e){e=e?e.listings||e.notifications||e.userInvitations||e.tags||e.items||e.groups||e.comments||e.provisions||e.results||e:[];return c.map(e,function(c){c=d.mixin(c,b||{});return a?new a(c):c})},clearFieldsFromObject:function(a,b){var c,g=a.length;if(d.isArray(a))for(c=
0;c<g;c++)delete b[a[c]];else for(c in a)delete b[c];return b},requestToTypedArray:function(a,b,c,g,h){return x(p.request(a,b,c).then(d.partial(p.resultsToTypedArray,g,h)))},request:function(a,b,c){var g;b&&b.portal&&delete b.portal;b&&b.form&&(g=b.form,delete b.form);b=d.mixin(d.mixin({},b||{}),l.requestParams);c=d.mixin(c||{},l.options);return q({url:p.useSSL(window.location.protocol,a.url||a),content:b,callbackParamName:"callback",timeout:c&&c.timeout||0,form:g},c)},formatQueryParams:function(a,
b,c){a=d.mixin(d.mixin({},a),d.isString(b)?{q:b}:b||{});a.q=!c&&l.extraQuery?"("+a.q+")"+l.extraQuery:a.q;return a}},t=m([],{declaredClass:"esri.arcgis.PortalComment",constructor:function(a){d.mixin(this,a);this.url=this.item.itemUrl+"/comments/"+this.id;this.created=this.created?new Date(this.created):null}}),B=m([],{declaredClass:"esri.arcgis.PortalRating",constructor:function(a){d.mixin(this,a);this.url=this.item.itemUrl+"/rating";this.created=this.created?new Date(this.created):null}}),g=m([],
{declaredClass:"esri.arcgis.PortalItem",constructor:function(a){d.mixin(this,a);this.folderId=this.ownerFolder||this.folderId;this.itemUrl=(this.portal&&this.portal.portalUrl)+"content/items/"+this.id;this.userItemUrl=this.hasOwnProperty("ownerFolder")?this.itemUrl.replace("content","content/users/"+this.owner+(this.folderId?"/"+this.folderId:"")):null;this.itemDataUrl=p.formatUrl(this.itemUrl+"/data");this.thumbnailUrl=p.formatUrl(this.itemUrl+"/info/"+this.thumbnail);this.displayName=this._getDisplayName();
this.iconUrl=this._getIconUrl();this.isPremiumContent=this._getIsPremiumContent();this.created=this.created?new Date(this.created):null;this.uploaded=this.uploaded?new Date(this.uploaded):null;this.modified=this.modified?new Date(this.modified):null},getTypeInfo:function(){var a=this.type;return{source:-1<c.indexOf(this.typeKeywords||[],"ArcGIS Server")||"Feature Collection"===a?a:null,displayName:this.displayName,iconUrl:this.iconUrl,isPremiumContent:this.isPremiumContent,premiumIconUrl:this._getPremiumIconUrl()}},
addComment:function(a){var b=d.isString(a)?{comment:a}:a;return p.request(this.itemUrl+"/addComment",b,{usePost:!0}).then(d.hitch(this,function(a){return new t(d.mixin(b,{id:a.commentId,item:this}))}))},updateComment:function(a){if(a&&a.url&&a.comment)return p.request(a.url+"/update",{comment:a.comment},{usePost:!0}).then(function(b){a.id=b.commentId;return a});throw Error();},getComments:function(){return p.requestToTypedArray(this.itemUrl+"/comments",null,null,t,{item:this})},deleteComment:function(a){if(a&&
a.url)return p.request(a.url+"/delete",null,{usePost:!0});throw Error();},addRating:function(a){var b=d.isObject(a)?a:{rating:parseFloat(a)};return p.request(this.itemUrl+"/addRating",b,{usePost:!0}).then(d.hitch(this,function(a){return new B(d.mixin(b,{id:a.ratingId,item:this}))}))},getRating:function(){return p.request(this.itemUrl+"/rating").then(d.hitch(this,function(a){return new B(d.mixin(a,{item:this}))}))},deleteRating:function(){return p.request(this.itemUrl+"/deleteRating",null,{usePost:!0})},
_getDisplayName:function(){var a=this.type,b=this.typeKeywords||[],e=a;"Feature Service"===a||"Feature Collection"===a?e=-1<c.indexOf(b,"Table")?"Table":"Feature Layer":"Image Service"===a?e=-1<c.indexOf(b,"Elevation 3D Layer")?"Elevation Layer":"Imagery Layer":"Scene Service"===a?e="Scene Layer":"Stream Service"===a?e="Feature Layer":"Microsoft Powerpoint"===a?e="Microsoft PowerPoint":"GeoJson"===a?this.type=e="GeoJSON":"Globe Service"===a?e="Globe Layer":"Vector Tile Service"===a?e="Tile Layer":
"Map Service"===a&&(e=-1<c.indexOf(b,"Hosted Service")||-1<c.indexOf(b,"Tiled")?"Tile Layer":"Map Image Layer");return e},_getIconUrl:function(){var a=this.type&&this.type.toLowerCase()||"",b=this.typeKeywords||[],e=!1,d=!1;0<a.indexOf("service")||"feature collection"===a||"kml"===a||"wms"===a||"wmts"===a?(e=-1<c.indexOf(b,"Hosted Service"),a="feature service"===a||"feature collection"===a||"kml"===a?(d=-1<c.indexOf(b,"Table"))?"table":e?"featureshosted":"features":"map service"===a||"wms"===a||"wmts"===
a?e||-1<c.indexOf(b,"Tiled")?"maptiles":"mapimages":"scene service"===a?"sceneweblayer":"image service"===a?-1<c.indexOf(b,"Elevation 3D Layer")?"elevationlayer":"imagery":"stream service"===a?"streamlayer":"vector tile service"===a?"vectortile":"layers"):a="web map"===a||"cityengine web scene"===a?"maps":"web scene"===a?-1<c.indexOf(b,"ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===a||"mobile application"===a||"application"===a||"operation view"===a||"desktop application"===
a?"apps":"map document"===a||"map package"===a||"published map"===a||"scene document"===a||"globe document"===a||"basemap package"===a||"mobile basemap package"===a||"mobile map package"===a||"project package"===a||"project template"===a||"pro map"===a||"layout"===a||"layer"===a&&-1<c.indexOf(b,"ArcGIS Pro")||"explorer map"===a&&c.indexOf(b,"Explorer Document")?"mapsgray":"service definition"===a||"csv"===a||"shapefile"===a||"cad drawing"===a||"geojson"===a?"datafiles":"explorer add in"===a||"desktop add in"===
a||"windows viewer add in"===a||"windows viewer configuration"===a?"appsgray":"rule package"===a||"file geodatabase"===a||"csv collection"===a||"kml collection"===a||"windows mobile package"===a||"map template"===a||"desktop application template"===a||"arcpad package"===a||"code sample"===a||"form"===a||"document link"===a||"tile package"===a||"vector tile package"===a||"scene package"===a||"operations dashboard add in"===a||"rules package"===a||"image"===a||"workflow manager package"===a||"desktop style"===
a||"explorer map"===a&&-1<c.indexOf(b,"Explorer Mapping Application")||-1<c.indexOf(b,"Document")?"datafilesgray":"geocoding service"===a||"network analysis service"===a||"geoprocessing service"===a||"geodata service"===a||"geometry service"===a||"geoprocessing package"===a||"locator package"===a||"geoprocessing sample"===a||"workflow manager service"===a||"raster function template"===a?"toolsgray":"layer"===a||"layer package"===a||"explorer layer"===a?"layersgray":"task file"===a?"taskfile":"maps";
return a?u.toUrl("../css/images/item_type_icons/"+a+"16.png"):null},_getIsPremiumContent:function(){var a=this.typeKeywords,b=!1;if(-1<c.indexOf(a,"Service")&&(-1<c.indexOf(a,"Requires Subscription")||-1<c.indexOf(this.typeKeywords,"Requires Credits")))b=!0;return b},_getPremiumIconUrl:function(){var a=this.typeKeywords,b;this.isPremiumContent&&(b=-1<c.indexOf(a,"Requires Credits")?"premiumcredits":"premiumitem");return b?u.toUrl("../css/images/item_type_icons/"+b+"16.png"):null}}),r=m([],{declaredClass:"esri.arcgis.PortalListing",
constructor:function(a){d.mixin(this,a);this.id=this.itemId;this.url=(this.portal&&this.portal.portalUrl)+"content/"+(this.userItemUrl?"items/":"listings/")+this.itemId;this.commentsUrl=this.url+"/comments";this.created=this.created?new Date(this.created):null;this.banner=this.banner?p.formatUrl(this.url+"/info/"+this.banner):"";this.thumbnail=this.thumbnail?p.formatUrl(this.url+"/info/"+this.thumbnail):"";this.largeThumbnail=this.largeThumbnail?p.formatUrl(this.url+"/info/"+this.largeThumbnail):
"";this.avgRating=this.avgRating||0;this.numRatings=this.numRatings||0;this.numComments=this.numComments||0;this.listingProperties=this.listingProperties||{priceDesc:"",creditsPerTransaction:0,licenseType:"free",trialSupported:!1,trialDuration:0,listingAccess:"private"};for(var b in this.listingProperties)this[b]&&(this.listingProperties[b]=this[b]);this.properties=this.properties||{systemRequirements:"",termsAndConditions:"",version:"1.0"};this.screenshots=c.map(this.screenshots,d.hitch(this,function(a){return p.formatUrl(this.url+
"/info/"+a)}));this.vendorName=this.vendor.name;this.vendor.thumbnail=this.vendor.thumbnail?this.userItemUrl?p.formatUrl(this.portal.portalUrl+"/accounts/self/resources/"+this.vendor.thumbnail):p.formatUrl(this.url+"/vendorinfo/"+this.vendor.thumbnail):""},getComments:function(){return p.requestToTypedArray(this.commentsUrl,null,null,t,{item:this})},getVendor:function(){return this.vendor}}),A=m([],{declaredClass:"esri.arcgis.PortalProvision",constructor:function(a){d.mixin(this,a);this.created=this.created?
new Date(this.created):null;this.startDate=this.startDate?new Date(this.startDate):null;this.endDate=this.endDate&&-1!==this.endDate?new Date(this.endDate):null;this.listing=a.listing?new r(d.mixin(a.listing,{portal:this.portal})):null}}),D=m([],{declaredClass:"esri.arcgis.PortalGroup",constructor:function(a){d.mixin(this,a);this.url=(this.portal&&this.portal.portalUrl)+"community/groups/"+this.id;this.thumbnailUrl=p.formatUrl(this.url+"/info/"+this.thumbnail);this.modified=this.modified?new Date(this.modified):
null;this.created=this.created?new Date(this.created):null},getMembers:function(){return p.request(this.url+"/users")},queryItems:function(a,b){a=p.formatQueryParams({},a,b);a.q="group:"+this.id+(a.q?" "+a.q:"");return this.portal.queryItems(a)}}),E=m([],{declaredClass:"esri.arcgis.PortalFolder",constructor:function(a){d.mixin(this,a);this.url=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username+"/"+this.id;this.created=this.created?new Date(this.created):null},getItems:function(){return p.requestToTypedArray(this.url,
null,null,g,{portal:this.portal,folderId:this.id})}}),G=m([],{declaredClass:"esri.arcgis.PortalUser",constructor:function(a){d.mixin(this,a);this.url=(this.portal&&this.portal.portalUrl)+"community/users/"+this.username;this.userContentUrl=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username;this.thumbnailUrl=p.formatUrl(this.url+"/info/"+this.thumbnail);this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null},getGroups:function(){return x(p.request(this.url).then(d.hitch(this,
function(a){return p.resultsToTypedArray(D,{portal:this.portal},a.groups)})))},getNotifications:function(){return p.requestToTypedArray(this.url+"/notifications",null,null,null,{portal:this.portal})},getGroupInvitations:function(){return p.requestToTypedArray(this.url+"/invitations",null,null,null,{portal:this.portal})},getTags:function(){return p.requestToTypedArray(this.url+"/tags",null,null,null,{portal:this.portal})},getFolders:function(){return x(this.getContent().then(function(a){return a.folders}))},
getItems:function(a){return x(this.getContent(a).then(function(a){return a.items}))},getItem:function(a){return p.request(this.portal.portalUrl+"content/items/"+a).then(d.hitch(this,function(a){return new g(d.mixin(a,{portal:this.portal}))}))},getContent:function(a){var b=this.url.replace("community","content")+(a?"/"+a:"");return p.request(b).then(d.hitch(this,function(b){b.folders=p.resultsToTypedArray(E,{portal:this.portal},b.folders);b.items=p.resultsToTypedArray(g,{portal:this.portal,folderId:a},
b.items);return b}))}});return{Portal:m([v],{declaredClass:"esri.arcgis.Portal",onLoad:function(){},onError:function(){},constructor:function(a){a=d.isObject(a)?a:{url:a};this.registerConnectEvents();l={options:{disableIdentityLookup:!0},requestParams:{f:"json"}};a.self?(l.self=a.self,d.mixin(this,{url:a.url||window.location.protocol+"//"+(a.self.urlKey?a.self.urlKey+"."+a.self.customBaseUrl:a.self.portalHostname)}),this.portalUrl=-1!==this.url.indexOf("/sharing")?this.url+"/":this.url+"/sharing/rest/",
a=a.self.user?this.signIn():this.init(this.url)):(a.url&&d.mixin(this,{url:a.url}),a=this.init(this.url));a.then(d.hitch(this,function(){this.emit("ready",this);this.onLoad(this)}))},init:function(a,b){a=(a||this.portalUrl).replace(/\/+$/,"");this.portalUrl=-1!==a.indexOf("/sharing")?a+"/":a+"/sharing/rest/";return this._getSelf(this.portalUrl).then(d.hitch(this,function(a){l.self=d.mixin({},a);if((a=a.user)&&b)l.currentToken=b&&b.token,l.loggedInUser=new G(d.mixin(a,{portal:this,credential:b}));
l.self.id&&!1===l.self.canSearchPublic&&(l.extraQuery=" AND orgid:"+l.self.id);d.mixin(this,l.self);this.thumbnailUrl=p.formatUrl(this.portalUrl+"accounts/self/resources/"+this.thumbnail);this.isOrganization=this.access&&this.access.length||!1;this.created=this.created?new Date(this.created):null;this.modified=this.modified?new Date(this.modified):null;return this}),d.hitch(this,function(a){this.onError(a);throw a;}))},signIn:function(){var a=new f,b=d.hitch(this,function(){this._onSignIn().then(d.hitch(this,
function(){a.resolve(l.loggedInUser)}),d.hitch(this,function(b){a.reject(b)}))});if(!l||!l.self)this.on("load",d.hitch(this,function(){b()}));else l&&l.loggedInUser?setTimeout(function(){a.resolve(l.loggedInUser)},0):b();return a},signOut:function(){l.loggedInUser.credential&&l.loggedInUser.credential.destroy();l.loggedInUser=null;l.options.disableIdentityLookup=!0;p.clearFieldsFromObject(l.self,this);l.self=null;return this.init(this.url)},getPortalUser:function(){return l.loggedInUser},addResource:function(a,
b){return p.request(this.portalUrl+"portals/self/addResource",{key:a,text:b},{usePost:!0})},update:function(a){return p.request(this.portalUrl+"portals/self/update",a,{usePost:!0})},queryGroups:function(a,b){return this._queryPortal(this.portalUrl+"community/groups",p.formatQueryParams({},a,b),D)},queryItems:function(a,b){return this._queryPortal(this.portalUrl+"search",p.formatQueryParams({},a,b),g)},queryListings:function(a){a=p.formatQueryParams({},a,!0);var b="";a.q&&-1<a.q.toLowerCase().indexOf("mylistings:true")?
(a.q=a.q.toLowerCase().replace("mylistings:true",""),b="?mylistings\x3dtrue"):a.q||(a.q='""');return this._queryPortal(this.portalUrl+"content/listings"+b,a,r)},queryCustomerList:function(a,b){var c=p.formatQueryParams({},a,!0);return this._queryPortal(this.portalUrl+"portals/self/customersList",c)},getProvisions:function(){return this.getCustomers().then(d.hitch(this,function(a){return a.purchases}))},getInterests:function(){return this.getCustomers().then(d.hitch(this,function(a){return a.interests}))},
getTrials:function(){return this.getCustomers().then(d.hitch(this,function(a){return a.trials}))},getCustomers:function(a){return p.request(this.portalUrl+"portals/self/customers",{status:a||"all"})},getMyPurchases:function(){return this.getPurchases().then(function(a){return a.purchases})},getMyInterests:function(){return this.getPurchases().then(function(a){return a.interests})},getPurchases:function(){return p.request(this.portalUrl+"portals/self/purchases").then(d.hitch(this,function(a){a.interests=
c.map(a.interests,function(a){return d.mixin(a.provision,{listing:a.listing})});a.purchases=c.map(a.purchases,function(a){return d.mixin(a.provision,{listing:a.listing})});a.trials=c.map(a.trials,function(a){return d.mixin(a.provision,{listing:a.listing})});a.interests=p.resultsToTypedArray(A,{portal:this},a.interests);a.trials=p.resultsToTypedArray(A,{portal:this},a.trials);a.purchases=p.resultsToTypedArray(A,{portal:this},a.purchases);return a}))},queryUsers:function(a,b){return this._queryPortal(this.portalUrl+
"community/users",p.formatQueryParams({sortField:"username"},a,b),G)},_onSignIn:function(){l.options.disableIdentityLookup=!1;if(!l.self||!l.self.user)l.self=null;return w.id.getCredential(this.portalUrl).then(d.hitch(this,"init",this.url)).then(function(){return l.loggedInUser},d.hitch(this,function(a){l.options.disableIdentityLookup=!0;this.onError(a);throw a;}))},_getSelf:function(a){var b;a=a+"accounts/self?culture\x3d"+k.locale;l.self?(b=new f,setTimeout(function(){b.resolve(l.self)},0)):b=p.request(a);
return b},_queryPortal:function(a,b,c){var g=d.mixin({num:10,start:0,sortField:"title",sortOrder:"asc"},b),h=["start","query","num","nextStart"];a=p.request(a,g).then(d.hitch(this,function(a){a.results=p.resultsToTypedArray(c,{portal:this},a);a.queryParams=d.mixin({},g);a.nextQueryParams=d.mixin(g,{start:a.nextStart});return p.clearFieldsFromObject(h,a)}));a=d.delegate(a);a.queryParams=d.mixin({},g);a.nextQueryParams=f.when(a,function(a){return a.nextQueryParams});return x(a)}}),PortalFolder:E,PortalGroup:D,
PortalItem:g,PortalComment:t,PortalRating:B,PortalUtil:p,PortalResult:x,PortalListing:r}})},"esri/dijit/_RefreshMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/on dojo/has ../kernel".split(" "),function(m,d,k,f,c,b){function u(b){"object"!==typeof b&&(b=Error(b));b.grid=this;f.emit(this.domNode,"dgrid-error",{grid:this,error:b,cancelable:!0,bubbles:!0})&&console.error(b)}return m(null,{_trackError:function(b){var c;"string"===typeof b&&(b=d.hitch(this,b));try{c=
b()}catch(q){u.call(this,q)}return k.when(c,d.hitch(this,function(){f.emit(this.domNode,"refresh",{cancelable:!0,bubbles:!0})}),d.hitch(this,u))}})})},"esri/dijit/analysis/PluginAnalysisLayers":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/promise/all dojo/has ../../kernel".split(" "),function(m,d,k,f,c,b){var u=m(null,{constructor:function(b){d.mixin(this,b)},fetchData:function(){this._portal=this.parent._portal;var b;return this._fetchGroups().then(d.hitch(this,function(c){b=
k.map(c||[],function(b){if(b)return'group:"'+b.id+'"'}).join(" OR ");return this._fetchGroupItems(b)}))},_fetchGroup:function(b,c){this._groups=this._groups||[];return this._groups[b]||this._portal.queryGroups(c,!0).then(d.hitch(this,function(c){0<c.total&&c.results&&(this._groups[b]=c.results);return this._groups[b]||[]}))},_fetchGroupItems:function(b,c){var d='(type:"Map Service" OR type:"Feature Service") typekeywords:"Analysis Ready" ('+b+")"+(c?" "+c:"");this._portal.user.demographics||(d+=' -typekeywords:"Requires Credits"');
return this.parent._fetchItems(d)},_fetchGroups:function(){return this._fetchEsriAnalysisLayers()},_fetchEsriAnalysisLayers:function(){var b;this._portal&&this._portal.livingAtlasGroupQuery&&(b=this._portal.livingAtlasGroupQuery.replace('title:"Featured Maps And Apps"','title:"Living Atlas Analysis Layers"'));return this._fetchGroup("esriAnalysisLayers",{q:b,num:100,start:0}).then(d.hitch(this,function(b){return b}))}});d.mixin(u,{add:function(b,c){if(!b.plugIn){var d=c||{};d.parent=b;b.plugIn=new u(d)}},
remove:function(b){b.plugIn&&(b.plugIn.destroy(),delete b.plugIn)}});return u})},"esri/tasks/Geoprocessor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has dojo/io-query ../kernel ../request ../deferredUtils ../geometry/normalizeUtils ./Task ./FeatureSet ./JobInfo ./GPMessage ./LinearUnit ./DataFile ./RasterData ./Date ./ParameterValue ./GPResultImageLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/MapImage".split(" "),function(m,
d,k,f,c,b,u,w,h,q,v,l,x,p,t,B,g,r,A,D,E,G,a){m=m(l,{declaredClass:"esri.tasks.Geoprocessor",_eventMap:{"execute-complete":["results","messages"],"get-result-data-complete":["result"],"get-result-image-complete":["mapImage"],"get-result-image-layer-complete":["layer"],"job-cancel":["jobInfo"],"job-complete":["jobInfo"],"status-update":["jobInfo"]},constructor:function(a){this._jobUpdateHandler=d.hitch(this,this._jobUpdateHandler);this._getJobStatus=d.hitch(this,this._getJobStatus);this._getResultDataHandler=
d.hitch(this,this._getResultDataHandler);this._getResultImageHandler=d.hitch(this,this._getResultImageHandler);this._executeHandler=d.hitch(this,this._executeHandler);this._updateTimers=[];this.registerConnectEvents()},updateDelay:1E3,processSpatialReference:null,outputSpatialReference:null,outSpatialReference:null,setUpdateDelay:function(a){this.updateDelay=a},setProcessSpatialReference:function(a){this.processSpatialReference=a},setOutputSpatialReference:function(a){this._setOutSR(a)},setOutSpatialReference:function(a){this._setOutSR(a)},
__msigns:[{n:"execute",c:3,a:[{i:0,p:["*"]}],e:2,f:1},{n:"submitJob",c:4,a:[{i:0,p:["*"]}],e:3}],_setOutSR:function(a){this.outSpatialReference=this.outputSpatialReference=a},_getOutSR:function(){return this.outSpatialReference||this.outputSpatialReference},_gpEncode:function(a,b,g){for(var h in a){var f=a[h];d.isArray(f)?a[h]=c.toJson(k.map(f,function(a){return this._gpEncode({item:a},!0).item},this)):f instanceof Date&&(a[h]=f.getTime())}return this._encode(a,b,g)},_decode:function(b){var c=b.dataType,
h=new D(b);if(-1!==k.indexOf(["GPBoolean","GPDouble","GPLong","GPString"],c))return h;if("GPLinearUnit"===c)h.value=new B(h.value);else if("GPFeatureRecordSetLayer"===c||"GPRecordSet"===c)h.value=new x(h.value);else if("GPDataFile"===c)h.value=new g(h.value);else if("GPDate"===c)b=h.value,d.isString(b)?h.value=new A({date:b}):h.value=new Date(b);else if("GPRasterData"===c||"GPRasterDataLayer"===c)b=b.value.mapImage,h.value=b?new a(b):new r(h.value);else if(-1!==c.indexOf("GPMultiValue:")){var f=c.split(":")[1];
b=h.value;h.value=k.map(b,function(a){return this._decode({paramName:"_name",dataType:f,value:a}).value},this)}else console.log(this.declaredClass+" : GP Data type not handled. : "+h.dataType),h=null;return h},submitJob:function(a,b,g,f,l){var r=this._getOutSR(),k=l.assembly;a=this._gpEncode(d.mixin({},this._url.query,{f:"json","env:outSR":r?r.wkid||c.toJson(r.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||c.toJson(this.processSpatialReference.toJson()):
null},a),null,k&&k[0]);var q=this._jobUpdateHandler,m=this._errorHandler;return h({url:this._url.path+"/submitJob",content:a,callbackParamName:"callback",load:function(a,c){q(a,c,!1,b,g,l.dfd)},error:function(a){m(a,f,l.dfd)}})},_jobUpdateHandler:function(a,b,c,d,g,h){var f=a.jobId;b=new p(a);this._successHandler([b],"onStatusUpdate",g,c&&h);if(!c)switch(clearTimeout(this._updateTimers[f]),this._updateTimers[f]=null,h&&h.progress(b),a.jobStatus){case p.STATUS_SUBMITTED:case p.STATUS_EXECUTING:case p.STATUS_WAITING:case p.STATUS_NEW:var l=
this._getJobStatus;this._updateTimers[f]=setTimeout(function(){l(f,c,d,g,h)},this.updateDelay);break;default:this._successHandler([b],"onJobComplete",d,h)}},_getJobStatus:function(a,b,c,g,f){var l=this._jobUpdateHandler;h({url:this._url.path+"/jobs/"+a,content:d.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(a,d){l(a,d,b,c,g,f)},error:this._errorHandler})},_getResultDataHandler:function(a,b,c,d,g){try{var h=this._decode(a);this._successHandler([h],"onGetResultDataComplete",
c,g)}catch(f){this._errorHandler(f,d,g)}},getResultData:function(a,b,c,g){var l=this._getResultDataHandler,r=this._errorHandler,k=new f(q._dfdCanceller);k._pendingDfd=h({url:this._url.path+"/jobs/"+a+"/results/"+b,content:d.mixin({},this._url.query,{f:"json",returnType:"data"}),callbackParamName:"callback",load:function(a,b){l(a,b,c,g,k)},error:function(a){r(a,g,k)}});return k},checkJobStatus:function(a,b,c){var g=this._jobUpdateHandler,l=this._errorHandler,r=new f(q._dfdCanceller);r._pendingDfd=
h({url:this._url.path+"/jobs/"+a,content:d.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(a,c){g(a,c,!0,null,b,r)},error:function(a){l(a,c,r)}});return r},cancelJob:function(a,b,c){var g=this._errorHandler,l=new f(q._dfdCanceller);l._pendingDfd=h({url:this._url.path+"/jobs/"+a+"/cancel",content:d.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:d.hitch(this,function(a,c){this._successHandler([a],"onJobCancel",b,l)}),error:function(a){g(a,c,l)}});
return l},execute:function(a,b,g,f){var l=this._getOutSR(),r=f.assembly;a=this._gpEncode(d.mixin({},this._url.query,{f:"json","env:outSR":l?l.wkid||c.toJson(l.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||c.toJson(this.processSpatialReference.toJson()):null},a),null,r&&r[0]);var k=this._executeHandler,q=this._errorHandler;return h({url:this._url.path+"/execute",content:a,callbackParamName:"callback",load:function(a,c){k(a,c,b,g,f.dfd)},error:function(a){q(a,
g,f.dfd)}})},_executeHandler:function(a,b,c,d,g){try{var h=a.results,f,l,r=a.messages;f=0;for(l=h.length;f<l;f++)h[f]=this._decode(h[f]);f=0;for(l=r.length;f<l;f++)r[f]=new t(r[f]);this._successHandler([h,r],"onExecuteComplete",c,g)}catch(k){this._errorHandler(k,d,g)}},_getResultImageHandler:function(a,b,c,d,g){try{var h=this._decode(a);this._successHandler([h],"onGetResultImageComplete",c,g)}catch(f){this._errorHandler(f,d,g)}},getResultImage:function(a,b,c,g,l){var r=this._getResultImageHandler,
k=this._errorHandler;c=this._gpEncode(d.mixin({},this._url.query,{f:"json"},c.toJson()));var m=new f(q._dfdCanceller);m._pendingDfd=h({url:this._url.path+"/jobs/"+a+"/results/"+b,content:c,callbackParamName:"callback",load:function(a,b){r(a,b,g,l,m)},error:function(a){k(a,l,m)}});return m},cancelJobStatusUpdates:function(a){clearTimeout(this._updateTimers[a]);this._updateTimers[a]=null},getResultImageLayer:function(a,b,c,d){if(null==b){var g=this._url.path.indexOf("/GPServer/");a=this._url.path.substring(0,
g)+"/MapServer/jobs/"+a}else a=this._url.path+"/jobs/"+a+"/results/"+b;this._url.query&&(a+="?"+u.objectToQuery(this._url.query));b=null==b?new G(a,{imageParameters:c}):new E(a,{imageParameters:c},!0);this.onGetResultImageLayerComplete(b);d&&d(b);return b},onStatusUpdate:function(){},onJobComplete:function(){},onExecuteComplete:function(){},onGetResultDataComplete:function(){},onGetResultImageComplete:function(){},onGetResultImageLayerComplete:function(){},onJobCancel:function(){}});v._createWrappers(m);
return m})},"esri/tasks/LinearUnit":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(m,d,k,f){return m(null,{declaredClass:"esri.tasks.LinearUnit",constructor:function(c){c&&d.mixin(this,c)},distance:0,units:null,toJson:function(){var c={};this.distance&&(c.distance=this.distance);this.units&&(c.units=this.units);return c}})})},"esri/tasks/DataFile":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(m,d,k,f){return m(null,
{declaredClass:"esri.tasks.DataFile",constructor:function(c){c&&d.mixin(this,c)},url:null,itemID:null,toJson:function(){var c={};this.url&&(c.url=this.url);this.itemID&&(c.itemID=this.itemID);return c}})})},"esri/tasks/RasterData":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(m,d,k,f){return m(null,{declaredClass:"esri.tasks.RasterData",constructor:function(c){c&&d.mixin(this,c)},url:null,format:null,itemID:null,toJson:function(){var c={};this.url&&(c.url=
this.url);this.format&&(c.format=this.format);this.itemID&&(c.itemID=this.itemID);return c}})})},"esri/tasks/Date":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/date/locale","dojo/has","../kernel"],function(m,d,k,f,c){return m(null,{declaredClass:"esri.tasks.Date",constructor:function(b){b&&(b.format&&(this.format=b.format),this.date=k.parse(b.date,{selector:"date",datePattern:this.format}))},date:new Date,format:"EEE MMM dd HH:mm:ss zzz yyyy",toJson:function(){return{date:k.format(this.date,
{selector:"date",datePattern:this.format}),format:this.format}}})})},"esri/tasks/ParameterValue":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(m,d,k,f){return m(null,{declaredClass:"esri.tasks.ParameterValue",constructor:function(c){d.mixin(this,c)}})})},"esri/tasks/GPResultImageLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has dojo/io-query ../kernel ../layers/ArcGISDynamicMapServiceLayer".split(" "),function(m,d,k,
f,c,b,u){return m(u,{declaredClass:"esri.tasks._GPResultImageLayer",constructor:function(b,c){c&&(c.imageParameters&&c.imageParameters.extent)&&(this.initialExtent=this.fullExtent=c.imageParameters.extent,this.spatialReference=this.initialExtent.spatialReference);this.getImageUrl=d.hitch(this,this.getImageUrl);this.loaded=!0;this.onLoad(this)},getImageUrl:function(b,h,f,m){var l=b.spatialReference.wkid;m(this._url.path+"?"+c.objectToQuery(d.mixin(this._params,{f:"image",bbox:k.toJson(b.toJson()),
bboxSR:l,imageSR:l,size:h+","+f})))}})})},"esri/dijit/SingleFilter":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/has dojo/json dojo/string dojo/number dojo/dom dojo/dom-style dojo/dom-attr dojo/dom-construct dojo/query dojo/dom-class dojo/_base/event dojo/Evented dojo/data/ItemFileWriteStore dojo/date/locale dojo/parser dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_OnDijitClickMixin dijit/_FocusMixin dijit/registry dijit/form/TextBox dijit/form/FilteringSelect dijit/form/RadioButton dijit/form/DateTextBox dijit/form/NumberTextBox ../kernel ../lang ../tasks/GenerateRendererTask ../tasks/UniqueValueDefinition ../tasks/GenerateRendererParameters ../layers/FeatureLayer ../layers/GeoRSSLayer dojo/i18n!../nls/jsapi dojo/text!./templates/SingleFilter.html".split(" "),
function(m,d,k,f,c,b,u,w,h,q,v,l,x,p,t,B,g,r,A,D,E,G,a,n,e,z,y,C,H,O,J,I,K,F,L,P,M,N,U,Q,R){return d([G,a,n,e,z,r],{declaredClass:"esri.dijit.SingleFilter",widgetsInTemplate:!0,templateString:R,valueHandlers:[],onFieldChangeEnabled:!0,onOperatorChangeEnabled:!0,onPromptChangeHandler:null,onHintChangeHandler:null,fieldDomains:{},fieldsStore:null,fieldsInfo:{stringFieldsCount:0,numberFieldsCount:0,dateFieldsCount:0},stringOperatorStore:null,dateOperatorStore:null,numberOperatorStore:null,uniqueValuesStore:null,
isEnableInteractiveFilter:!0,uniqueValuesResults:{},partsObj:null,dayInMS:86399E3,allowAllDateTypes:!1,postMixInProperties:function(){this.inherited(arguments);this.i18n={};this.i18n=k.mixin(this.i18n,Q.filterDlg)},parseExpressionTemplate:function(){var a=function(a,s){v.byId(s).className="attributeValueContainer";"field_dropdown"===a?v.byId(s).innerHTML=b:"operator_dropdown"===a?v.byId(s).innerHTML=c:"values_input"===a?v.byId(s).innerHTML=d+e:console.error("problem with expressionTemplate from localization file")},
b='\x3cselect id\x3d"'+this.id+'.fieldsList" class\x3d"attributeField" data-dojo-type\x3d"dijit/form/FilteringSelect" maxHeight\x3d"150" sortByLabel\x3d"true"\x3e\x3c/select\x3e',c='\x3cselect id\x3d"'+this.id+'.operatorList" class\x3d"operator" data-dojo-type\x3d"dijit/form/FilteringSelect" maxHeight\x3d"150" sortByLabel\x3d"false"\x3e\x3c/select\x3e',d='\x3cdiv id\x3d"'+this.id+'.attributeValueContainer"\x3e\x3c/div\x3e',e='\x3cdiv class\x3d"attributeValueOptions"\x3e\x3ctable cellpadding\x3d"0" cellspacing\x3d"0"\x3e  \x3ctbody\x3e    \x3ctr\x3e      \x3ctd nowrap\x3d"nowrap"\x3e        \x3cinput id\x3d"'+
this.id+'.radioValue" class\x3d"radioValue attributeValueRadio" checked\x3d"checked" name\x3d"'+this.id+'.inputOption" data-dojo-type\x3d"dijit/form/RadioButton" title\x3d"'+this.i18n.valueTooltip+'"/\x3e        \x3clabel class\x3d"labels" title\x3d"'+this.i18n.valueTooltip+'"\x3e'+this.i18n.value+'        \x3c/label\x3e      \x3c/td\x3e      \x3ctd nowrap\x3d"nowrap" class\x3d"esriLeadingPadding05"\x3e        \x3cinput id\x3d"'+this.id+'.radioFields" class\x3d"radioFields attributeValueRadio" name\x3d"'+
this.id+'.inputOption" data-dojo-type\x3d"dijit/form/RadioButton" title\x3d"'+this.i18n.fieldTooltip+'"/\x3e        \x3clabel class\x3d"labels" title\x3d"'+this.i18n.fieldTooltip+'"\x3e'+this.i18n.field+'        \x3c/label\x3e      \x3c/td\x3e      \x3ctd id\x3d"'+this.id+'.radioUniqueColumn" nowrap\x3d"nowrap" class\x3d"esriLeadingPadding05"\x3e        \x3cinput id\x3d"'+this.id+'.radioUnique" class\x3d"radioUnique attributeValueRadio" name\x3d"'+this.id+'.inputOption" data-dojo-type\x3d"dijit/form/RadioButton" title\x3d"'+
this.i18n.uniqueValueTooltip+'"/\x3e        \x3clabel class\x3d"labels" title\x3d"'+this.i18n.uniqueValueTooltip+'"\x3e'+this.i18n.uniqueValues+"        \x3c/label\x3e      \x3c/td\x3e    \x3c/tr\x3e  \x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e",g=this.i18n.expressionTemplate,h=g.indexOf("${"),f=g.substring(0,h).trim();v.byId(this.id+".column1").innerHTML=f.length?"\x3cdiv class\x3d'attributeText'\x3e"+f+"\x3c/div\x3e":"";var f=g.indexOf("}",h+1),l=g.substring(h+2,f);a(l,this.id+".column2");h=g.indexOf("${",
h+1);f=g.substring(f+1,h).trim();v.byId(this.id+".column3").innerHTML=f.length?"\x3cdiv class\x3d'attributeText'\x3e"+f+"\x3c/div\x3e":"";f=g.indexOf("}",h+1);l=g.substring(h+2,f);a(l,this.id+".column4");h=g.indexOf("${",h+1);f=g.substring(f+1,h).trim();v.byId(this.id+".column5").innerHTML=f.length?"\x3cdiv class\x3d'attributeText'\x3e"+f+"\x3c/div\x3e":"";f=g.indexOf("}",h+1);l=g.substring(h+2,f);a(l,this.id+".column6");f=g.substring(f+1,g.length).trim();v.byId(this.id+".column7").innerHTML=f.length?
"\x3cdiv class\x3d'attributeText'\x3e"+f+"\x3c/div\x3e":""},postCreate:function(){this.inherited(arguments);this.parseExpressionTemplate();this.createOperatorStores();this.createFieldsStore(this.fields);this.readCodedValues();E.parse(v.byId(this.id+".exprTable")).then(k.hitch(this,function(a){c.connect(this.getFieldsList(),"onChange",this,"onChangeField");c.connect(this.getOperatorList(),"onChange",this,"onChangeOperator");c.connect(y.byId(this.id+".radioValue"),"onClick",this,"showValueInput");c.connect(y.byId(this.id+
".radioFields"),"onClick",this,"showFields");c.connect(y.byId(this.id+".radioUnique"),"onClick",this,"showUniqueList");this.version&&10.1>this.version&&l.set(v.byId(this.id+".radioUniqueColumn"),"display","none");c.connect(v.byId(this.id+".deleteExpression"),"onclick",this,"onClickDeleteExpression");c.connect(this.interactiveCheck,"onclick",this,"onInteractiveClick");c.connect(this.interactiveArrow,"onclick",this,"onClickShowHideInteractive");this.enableInteractiveHandlers();this.isEnableInteractiveFilter||
l.set(this._interactiveFilterRow,"display","none")}))},constructor:function(a,b){this.id=a.id||"";this.owner=a.owner;this.version=a.version;this.part=a.part;this.fields=a.fields;this.mapLayer=a.mapLayer;!1===a.enableEvents&&(this.onOperatorChangeEnabled=this.onFieldChangeEnabled=!1)},init:function(a){a.part||(this.clearAttributeValueDijits(),this.mapLayer=a.mapLayer,this.version=a.version,this.fields=a.fields,this.createOperatorStores(),this.createFieldsStore(this.fields),this.readCodedValues(),this.fillFieldsList(this.fieldsStore),
this.onChangeField());a.part&&(this.part=a.part,this.buildEditUIField(this.part,this))},destroy:function(){this.clearAttributeValueDijits();f.forEach(y.findWidgets(v.byId(this.id)),function(a){a.destroyRecursive()});this.inherited(arguments)},toJson:function(){var a=null;this.isInteractiveChecked()&&(a={prompt:this.promptText.attr("value"),hint:this.hintText.attr("value")});return{fieldObj:this.getField(),operator:this.getOperator(),valueObj:this.getValue(),interactiveObj:a}},buildFriendlyTextExpr:function(a){var b=
this.i18n.expressionTemplate,c=function(a,c,d){return h.substitute(b,{field_dropdown:a,operator_dropdown:c,values_input:d})};if(!1===a.valueObj.isValid)return"\x26lt;expression is missing value\x26gt;";var d="";if("string"===a.fieldObj.shortType)a.operator===this.i18n.stringOperatorIsBlank||a.operator===this.i18n.stringOperatorIsNotBlank?d=c(a.fieldObj.label,a.operator,""):"field"===a.valueObj.type?d=c(a.fieldObj.label,a.operator,a.valueObj.label):(d=this.getDecodedValue(a.interactiveObj?a.interactiveObj.value:
a.valueObj.value,a.fieldObj.name),d=c(a.fieldObj.label,a.operator,"'"+d+"'"));else if("number"===a.fieldObj.shortType)if(a.operator===this.i18n.numberOperatorIsBetween||a.operator===this.i18n.numberOperatorIsNotBetween)d=a.interactiveObj?a.interactiveObj.value2:a.valueObj.value2,d=c(a.fieldObj.label,a.operator,q.format(a.interactiveObj?a.interactiveObj.value1:a.valueObj.value1,{pattern:"#####0.##########"})+" "+this.i18n.andBetweenValues+" "+q.format(d,{pattern:"#####0.##########"}));else if(a.operator===
this.i18n.numberOperatorIsBlank||a.operator===this.i18n.numberOperatorIsNotBlank)d=c(a.fieldObj.label,a.operator,"");else if("field"===a.valueObj.type)d=c(a.fieldObj.label,a.operator,a.valueObj.label);else var d=a.interactiveObj?a.interactiveObj.value:a.valueObj.value,e=this.getDecodedValue(d,a.fieldObj.name),d=c(a.fieldObj.label,a.operator,d!==e?"'"+e+"'":q.format(d,{pattern:"#####0.##########"}));else F.isDefined(a.valueObj.value)&&("field"!==a.valueObj.type&&"string"===typeof a.valueObj.value)&&
(a.valueObj.value=new Date(a.valueObj.value)),d=a.operator===this.i18n.dateOperatorIsBetween||a.operator===this.i18n.dateOperatorIsNotBetween?c(a.fieldObj.label,a.operator,(a.interactiveObj?this.formatFriendlyDate(a.interactiveObj.value1):this.formatFriendlyDate(a.valueObj.value1))+" "+this.i18n.andBetweenValues+" "+(a.interactiveObj?this.formatFriendlyDate(a.interactiveObj.value2):this.formatFriendlyDate(this.addDay(a.valueObj.value2)))):a.operator===this.i18n.dateOperatorIsBlank||a.operator===this.i18n.dateOperatorIsNotBlank?
c(a.fieldObj.label,a.operator,""):"field"===a.valueObj.type?c(a.fieldObj.label,a.operator,a.valueObj.label):c(a.fieldObj.label,a.operator,a.interactiveObj?this.formatFriendlyDate(a.interactiveObj.value):this.formatFriendlyDate(a.valueObj.value));return d},builtSingleFilterString:function(a,b){if(F.isDefined(a.valueObj.isValid)&&!a.valueObj.isValid)return{whereClause:null};var c=a.valueObj.value,d=a.valueObj.value1,e=a.valueObj.value2,g=!1;if(a.interactiveObj){if(!a.interactiveObj.prompt||!a.interactiveObj.hint)return{whereClause:null};
F.isDefined(b)&&(g=!0,F.isDefined(a.valueObj.value)&&(c="{"+b+"}"),F.isDefined(a.valueObj.value1)&&(d="{"+b+"}"),F.isDefined(a.valueObj.value2)&&(e="{"+(b+1)+"}"))}var h="";if("string"===a.fieldObj.shortType)switch(d="",c&&"field"!==a.valueObj.type&&this.isHostedService(this.mapLayer.url)&&this.containsNonLatinCharacter(c)&&(d="N"),a.operator){case this.i18n.stringOperatorIs:h="field"===a.valueObj.type?a.fieldObj.name+" \x3d "+c:a.fieldObj.name+" \x3d "+d+"'"+c.replace(/\'/g,"''")+"'";break;case this.i18n.stringOperatorIsNot:h=
"field"===a.valueObj.type?a.fieldObj.name+" \x3c\x3e "+c:a.fieldObj.name+" \x3c\x3e "+d+"'"+c.replace(/\'/g,"''")+"'";break;case this.i18n.stringOperatorStartsWith:h=a.fieldObj.name+" LIKE "+d+"'"+c.replace(/\'/g,"''")+"%'";break;case this.i18n.stringOperatorEndsWith:h=a.fieldObj.name+" LIKE "+d+"'%"+c.replace(/\'/g,"''")+"'";break;case this.i18n.stringOperatorContains:h=a.fieldObj.name+" LIKE "+d+"'%"+c.replace(/\'/g,"''")+"%'";break;case this.i18n.stringOperatorDoesNotContain:h=a.fieldObj.name+
" NOT LIKE "+d+"'%"+c.replace(/\'/g,"''")+"%'";break;case this.i18n.stringOperatorIsBlank:h=a.fieldObj.name+" IS NULL";break;case this.i18n.stringOperatorIsNotBlank:h=a.fieldObj.name+" IS NOT NULL"}else if("number"===a.fieldObj.shortType)switch(a.operator){case this.i18n.numberOperatorIs:h=a.fieldObj.name+" \x3d "+c;break;case this.i18n.numberOperatorIsNot:h=a.fieldObj.name+" \x3c\x3e "+c;break;case this.i18n.numberOperatorIsAtLeast:h=a.fieldObj.name+" \x3e\x3d "+c;break;case this.i18n.numberOperatorIsLessThan:h=
a.fieldObj.name+" \x3c "+c;break;case this.i18n.numberOperatorIsAtMost:h=a.fieldObj.name+" \x3c\x3d "+c;break;case this.i18n.numberOperatorIsGreaterThan:h=a.fieldObj.name+" \x3e "+c;break;case this.i18n.numberOperatorIsBetween:h=a.fieldObj.name+" BETWEEN "+d+" AND "+e;break;case this.i18n.numberOperatorIsNotBetween:h=a.fieldObj.name+" NOT BETWEEN "+d+" AND "+e;break;case this.i18n.numberOperatorIsBlank:h=a.fieldObj.name+" IS NULL";break;case this.i18n.numberOperatorIsNotBlank:h=a.fieldObj.name+" IS NOT NULL"}else switch(F.isDefined(c)&&
("field"!==a.valueObj.type&&"string"===typeof c)&&(c=this.parseFriendlyDate(c)),a.operator){case this.i18n.dateOperatorIsOn:h="field"===a.valueObj.type?a.fieldObj.name+" \x3d "+c:g?a.fieldObj.name+" BETWEEN '{"+b+"}' AND '{"+(b+1)+"}'":a.fieldObj.name+" BETWEEN '"+this.formatDate(c)+"' AND '"+this.formatDate(this.addDay(c))+"'";break;case this.i18n.dateOperatorIsNotOn:h="field"===a.valueObj.type?a.fieldObj.name+" \x3c\x3e "+c:g?a.fieldObj.name+" NOT BETWEEN '{"+b+"}' AND '{"+(b+1)+"}'":a.fieldObj.name+
" NOT BETWEEN '"+this.formatDate(c)+"' AND '"+this.formatDate(this.addDay(c))+"'";break;case this.i18n.dateOperatorIsBefore:h="field"===a.valueObj.type?a.fieldObj.name+" \x3c "+c:a.fieldObj.name+" \x3c '"+this.formatDate(c)+"'";break;case this.i18n.dateOperatorIsAfter:h="field"===a.valueObj.type?a.fieldObj.name+" \x3e "+c:a.fieldObj.name+" \x3e '"+this.formatDate(this.addDay(c))+"'";break;case this.i18n.dateOperatorIsBetween:h=g?a.fieldObj.name+" BETWEEN '"+d+"' AND '"+e+"'":a.fieldObj.name+" BETWEEN '"+
this.formatDate(d)+"' AND '"+this.formatDate(this.addDay(e))+"'";break;case this.i18n.dateOperatorIsNotBetween:h=g?a.fieldObj.name+" NOT BETWEEN '"+d+"' AND '"+e+"'":a.fieldObj.name+" NOT BETWEEN '"+this.formatDate(d)+"' AND '"+this.formatDate(this.addDay(e))+"'";break;case this.i18n.dateOperatorIsBlank:h=a.fieldObj.name+" IS NULL";break;case this.i18n.dateOperatorIsNotBlank:h=a.fieldObj.name+" IS NOT NULL"}return{whereClause:h}},showDeleteIcon:function(){l.set(v.byId(this.id+".deleteExpression"),
"display","block")},hideDeleteIcon:function(){l.set(v.byId(this.id+".deleteExpression"),"display","none")},createFieldsStore:function(a){if(a&&a.length){a=k.clone(a);a=a.sort(function(a,b){a.label=a.alias||a.name;b.label=b.alias||b.name;return a.label<b.label?-1:a.label>b.label?1:0});var b=this.isHostedService(this.mapLayer.url),c=10.2<=this.version;a=f.filter(a,function(a,d){return"esriFieldTypeString"===a.type||"esriFieldTypeDouble"===a.type||"esriFieldTypeSingle"===a.type||"esriFieldTypeInteger"===
a.type||"esriFieldTypeSmallInteger"===a.type||"esriFieldTypeDate"===a.type&&(this.allowAllDateTypes||b||c)?!0:!1},this);a=f.map(a,function(a,b){var c;switch(a.type){case "esriFieldTypeString":c="string";this.fieldsInfo.stringFieldsCount++;break;case "esriFieldTypeDate":c="date";this.fieldsInfo.dateFieldsCount++;break;default:c="number",this.fieldsInfo.numberFieldsCount++}return{id:b,label:a.label,shortType:c,alias:a.alias,editable:a.editable,name:a.name,nullable:a.nullable,type:a.type}},this);a.length&&
(this.fieldsStore=new A({data:{identifier:"id",label:"label",items:a}}))}},createOperatorStores:function(){var a=[];a.push({name:this.i18n.stringOperatorIs,name_:this.i18n.stringOperatorIs,id:0});a.push({name:this.i18n.stringOperatorIsNot,name_:this.i18n.stringOperatorIsNot,id:1});a.push({name:this.i18n.stringOperatorStartsWith,name_:this.i18n.stringOperatorStartsWith,id:2});a.push({name:this.i18n.stringOperatorEndsWith,name_:this.i18n.stringOperatorEndsWith,id:3});a.push({name:this.i18n.stringOperatorContains,
name_:this.i18n.stringOperatorContains,id:4});a.push({name:this.i18n.stringOperatorDoesNotContain,name_:this.i18n.stringOperatorDoesNotContain,id:5});a.push({name:this.i18n.stringOperatorIsBlank,name_:this.i18n.stringOperatorIsBlank,id:6});a.push({name:this.i18n.stringOperatorIsNotBlank,name_:this.i18n.stringOperatorIsNotBlank,id:7});this.stringOperatorStore=new A({data:{label:"name",identifier:"id",items:a}});a=[];a.push({name:this.i18n.dateOperatorIsOn,id:0});a.push({name:this.i18n.dateOperatorIsNotOn,
id:1});a.push({name:this.i18n.dateOperatorIsBefore,id:2});a.push({name:this.i18n.dateOperatorIsAfter,id:3});a.push({name:this.i18n.dateOperatorIsBetween,id:6});a.push({name:this.i18n.dateOperatorIsNotBetween,id:7});a.push({name:this.i18n.dateOperatorIsBlank,id:8});a.push({name:this.i18n.dateOperatorIsNotBlank,id:9});this.dateOperatorStore=new A({data:{label:"name",identifier:"id",items:a}});a=[];a.push({name:this.i18n.numberOperatorIs,name_:this.i18n.numberOperatorIs,id:0});a.push({name:this.i18n.numberOperatorIsNot,
name_:this.i18n.numberOperatorIsNot,id:1});a.push({name:this.i18n.numberOperatorIsAtLeast,name_:this.i18n.numberOperatorIsAtLeast,id:2});a.push({name:this.i18n.numberOperatorIsLessThan,name_:this.i18n.numberOperatorIsLessThan,id:3});a.push({name:this.i18n.numberOperatorIsAtMost,name_:this.i18n.numberOperatorIsAtMost,id:4});a.push({name:this.i18n.numberOperatorIsGreaterThan,name_:this.i18n.numberOperatorIsGreaterThan,id:5});a.push({name:this.i18n.numberOperatorIsBetween,name_:this.i18n.numberOperatorIsBetween,
id:6});a.push({name:this.i18n.numberOperatorIsNotBetween,name_:this.i18n.numberOperatorIsNotBetween,id:7});a.push({name:this.i18n.numberOperatorIsBlank,name_:this.i18n.numberOperatorIsBlank,id:8});a.push({name:this.i18n.numberOperatorIsNotBlank,name_:this.i18n.numberOperatorIsNotBlank,id:9});this.numberOperatorStore=new A({data:{label:"name",identifier:"id",items:a}})},readCodedValues:function(){f.forEach(this.mapLayer.fields,function(a){a.domain&&a.domain.codedValues&&(this.fieldDomains[a.name]=
a.domain.codedValues)},this)},getDecodedValue:function(a,b){var c=this.getCodedValues(b),d,e;if(c)for(d=0;d<c.length;d+=1)if(e=c[d],e.code===a)return e.name;return a},getCodedValues:function(a){return this.fieldDomains[a]},getFieldsList:function(){return y.byId(this.id+".fieldsList")},getOperatorList:function(){return y.byId(this.id+".operatorList")},getValueFieldsList:function(){return y.byId(this.id+".valueFields")},getAttrValContNode:function(){return v.byId(this.id+".attributeValueContainer")},
getField:function(){var a=this.getFieldsList();return{name:a.store.getValue(a.item,"name"),label:a.store.getValue(a.item,"label"),shortType:a.store.getValue(a.item,"shortType"),type:a.store.getValue(a.item,"type")}},getOperator:function(){var a=this.getOperatorList();return!a.item?"":a.store.getValue(a.item,"name")},getValue:function(){return{}},isInteractiveChecked:function(){return this.interactiveCheck.checked},setInteractiveSection:function(a,b,c){this.disableInteractiveHandlers();this.interactiveCheck.checked=
a;this.promptText.attr("value",b);this.hintText.attr("value",c);l.set(this.interactiveSpace,"display","block");this.interactiveArrow.innerHTML="\x26nbsp;\x26#9650;";this.enableInteractiveHandlers()},enableInteractiveHandlers:function(){this.onPromptChangeHandler=c.connect(this.promptText,"onChange",this,"onChangeInteractive");this.onHintchangeHandler=c.connect(this.hintText,"onChange",this,"onChangeInteractive")},disableInteractiveHandlers:function(){c.disconnect(this.onPromptChangeHandler);c.disconnect(this.onHintChangeHandler)},
fillFieldsList:function(a){var b=this.getFieldsList();b.set("labelAttr","label");b.set("searchAttr","label");b.set("store",a);b.set("value",0)},fillOperatorList:function(a,b,c){var d=this.getOperatorList();d.set("labelAttr","name");d.set("searchAttr","name");d.set("query",c?c:{});d.set("store",a);if(b){var e=!1;for(c=0;20>c&&!(a.fetchItemByIdentity({identity:c,onItem:k.hitch(this,function(a){a&&a.name[0]===b&&(d.set("value",a.id[0]),e=!0)})}),e);c++);}else d.set("value",0)},createValueString:function(a){var b=
this.getAttrValContNode();this.clearAttributeValueDijits();p.empty(b);if(a){var b=new H({id:this.id+".value","class":"attributeValue",maxHeight:150,sortByLabel:!0},p.create("div",{},b)),d=this.buildCodedValuesStore(a);b.set("store",d);b.set("value",0)}else b=new C({id:this.id+".value","class":"attributeValue",required:!0,placeHolder:"",intermediateChanges:!0},p.create("div",{},b));this.valueHandlers.push(c.connect(b,"onChange",this,"onValueChange"));this.checkDefaultOption();this.getValue=function(){var b=
y.byId(this.id+".value"),c=!0;a?b.item?b=b.item.code[0]:(b="",c=!1):c=b=b.get("value");return{value:b,isValid:c}}},createValueDate:function(){var a=this.getAttrValContNode();this.clearAttributeValueDijits();p.empty(a);a=new J({id:this.id+".value","class":"attributeValue",trim:!0,required:!0,placeHolder:"",constraints:{formatLength:"short"}},p.create("div",{},a));this.checkDefaultOption();this.valueHandlers.push(c.connect(a,"onChange",this,"onValueChange"));this.getValue=function(){var a=y.byId(this.id+
".value").get("value");return{value:a,isValid:F.isDefined(a)}}},createValueNumber:function(a){var b=this.getAttrValContNode();this.clearAttributeValueDijits();p.empty(b);if(a){var b=new H({id:this.id+".value","class":"attributeValue",maxHeight:150,sortByLabel:!0},p.create("div",{},b)),d=this.buildCodedValuesStore(a);b.set("store",d);b.set("value",0)}else b=new I({id:this.id+".value","class":"attributeValue",required:!0,placeHolder:"",intermediateChanges:!0,constraints:{pattern:"#####0.##########"}},
p.create("div",{},b));this.valueHandlers.push(c.connect(b,"onChange",this,"onValueChange"));this.checkDefaultOption();this.getValue=function(){var b=y.byId(this.id+".value"),c=!0;a?b.item?b=b.item.code[0]:(b="",c=!1):(b=b.get("value"),c=F.isDefined(b)&&!isNaN(b));return{value:b,isValid:c}}},createValueBetweenDate:function(){var a=this.getAttrValContNode();this.clearAttributeValueDijits();p.empty(a);var b=new J({id:this.id+".value1","class":"attributeValue1",trim:!0,required:!0,placeHolder:"",constraints:{formatLength:"short"}},
p.create("div",{},a));p.create("span",{innerHTML:this.i18n.andBetweenValues,"class":"attributeBetweenValues"},a);a=new J({id:this.id+".value2","class":"attributeValue2",trim:!0,required:!0,placeHolder:"",constraints:{formatLength:"short"}},p.create("div",{},a));this.checkDefaultOption();this.valueHandlers.push(c.connect(b,"onChange",this,"onValueChange"));this.valueHandlers.push(c.connect(a,"onChange",this,"onValueChange"));this.getValue=function(){var a=y.byId(this.id+".value1").get("value"),b=y.byId(this.id+
".value2").get("value");return{value1:a,value2:b,isValid:F.isDefined(a)&&F.isDefined(b)}}},createValueBetweenNumber:function(){var a=this.getAttrValContNode();this.clearAttributeValueDijits();p.empty(a);var b=new I({id:this.id+".value1","class":"attributeValue1",required:!0,placeHolder:"",intermediateChanges:!0,constraints:{pattern:"#####0.##########"}},p.create("div",{},a));p.create("span",{innerHTML:this.i18n.andBetweenValues,"class":"attributeBetweenValues"},a);a=new I({id:this.id+".value2","class":"attributeValue2",
required:!0,placeHolder:"",intermediateChanges:!0,constraints:{pattern:"#####0.##########"}},p.create("div",{},a));this.checkDefaultOption();this.valueHandlers.push(c.connect(b,"onChange",this,"onValueChange"));this.valueHandlers.push(c.connect(a,"onChange",this,"onValueChange"));this.getValue=function(){var a=y.byId(this.id+".value1").get("value"),b=y.byId(this.id+".value2").get("value");return{value1:a,value2:b,isValid:F.isDefined(a)&&F.isDefined(b)&&!isNaN(a)&&!isNaN(b)&&a<=b}}},createValueInTheLastDate:function(){},
createValueIsBlank:function(){var a=this.getAttrValContNode();this.clearAttributeValueDijits();p.empty(a);a.innerHTML="\x3cinput id\x3d'"+this.id+".value' class\x3d'attributeValue' type\x3d'text' disabled\x3d'true'/\x3e";this.checkDefaultOption();this.getValue=function(){return{value:null,isValid:!0}}},createValueFields:function(a,b,d){var e=this.getAttrValContNode();this.clearAttributeValueDijits();p.empty(e);var g=new H({id:this.id+".valueFields","class":"attributeValue",maxHeight:150,labelAttr:"label",
searchAttr:"label",store:a,query:b},p.create("div",{},e));if(d)for(var h=!1,e=0;100>e&&!(a.fetchItemByIdentity({identity:e,onItem:k.hitch(this,function(a){a&&(a.shortType[0]===b.shortType&&a.name[0]!==d)&&(g.set("value",a.id),h=!0)})}),h);e++);this.valueHandlers.push(c.connect(g,"onChange",this,"onValueChange"));this.getValue=function(){var a=y.byId(this.id+".valueFields");return{value:a.store.getValue(a.item,"name"),label:a.store.getValue(a.item,"label"),type:"field",isValid:!0}}},createValueUnique:function(a){var b=
this.getAttrValContNode();this.clearAttributeValueDijits();p.empty(b);a=new H({id:this.id+".valueUnique","class":"attributeValue",maxHeight:150,store:a},p.create("div",{},b));a.set("value",0);this.valueHandlers.push(c.connect(a,"onChange",this,"onValueChange"));this.getValue=function(){var a=y.byId(this.id+".valueUnique");return{value:a.store.getValue(a.item,"value"),isValid:!0}}},setValue:function(a,b){if(b)for(var c=0;c<b.length;c++){if(a===b[c].code){y.byId(this.id+".value").set("value",c);break}}else"date"===
this.part.fieldObj.shortType?y.byId(this.id+".value").set("value",new Date(a)):("number"===this.part.fieldObj.shortType&&(a=Number(a)),y.byId(this.id+".value").set("value",a))},setValue1:function(a){"date"===this.part.fieldObj.shortType?a=new Date(a):"number"===this.part.fieldObj.shortType&&(a=Number(a));y.byId(this.id+".value1").set("value",a)},setValue2:function(a){"date"===this.part.fieldObj.shortType?a=new Date(a):"number"===this.part.fieldObj.shortType&&(a=Number(a));y.byId(this.id+".value2").set("value",
a)},setValueFieldById:function(a){this.getValueFieldsList().set("value",a)},enableOnFieldChange:function(){this.onFieldChangeEnabled=!0},enableOnOperatorChange:function(){this.onOperatorChangeEnabled=!0},onChangeField:function(a){this.onFieldChangeEnabled&&this._onChangeField(this.getFieldsList(),this)},onChangeOperator:function(a){this.onOperatorChangeEnabled&&this._onChangeOperator(this.getOperatorList(),this)},onClickDeleteExpression:function(a){this._deleteExpression(this)},_onChangeField:function(a,
b,d){var e=b.getOperatorList();switch(this.fieldsStore.getValue(a.item,"type")){case "esriFieldTypeString":var g=null;a=this.fieldsStore.getValue(a.item,"name");this.getCodedValues(a)&&(g=this.i18n.stringOperatorStartsWith,g+="|"+this.i18n.stringOperatorEndsWith,g+="|"+this.i18n.stringOperatorContains,g+="|"+this.i18n.stringOperatorDoesNotContain,g={name_:RegExp("^(?!("+g+")$)")});e.attr("value")===this.i18n.stringOperatorIs?(b.fillOperatorList(this.stringOperatorStore,this.i18n.stringOperatorIs,
g),this.onChangeOperator(e,b,d)):b.fillOperatorList(this.stringOperatorStore,this.i18n.stringOperatorIs,g);b.createValueString(this.getCodedValues(a));break;case "esriFieldTypeDate":b.fillOperatorList(this.dateOperatorStore,this.i18n.dateOperatorIsOn);b.createValueDate();break;default:g=null,a=this.fieldsStore.getValue(a.item,"name"),this.getCodedValues(a)&&(g=this.i18n.numberOperatorIsBetween,g+="|"+this.i18n.numberOperatorIsNotBetween,g+="|"+this.i18n.numberOperatorIsAtLeast,g+="|"+this.i18n.numberOperatorIsLessThan,
g+="|"+this.i18n.numberOperatorIsAtMost,g+="|"+this.i18n.numberOperatorIsGreaterThan,g={name_:RegExp("^(?!("+g+")$)")}),e.attr("value")===this.i18n.numberOperatorIs?(b.fillOperatorList(this.numberOperatorStore,this.i18n.numberOperatorIs,g),this.onChangeOperator(e,b,d)):b.fillOperatorList(this.numberOperatorStore,this.i18n.numberOperatorIs,g),b.createValueNumber(this.getCodedValues(a))}"date"===this.fieldsStore.getValue(b.getFieldsList().item,"shortType")?b.disableInteractiveCheck():b.enableInteractiveCheck();
c.publish("filter-expression-change",this)},_onChangeOperator:function(a,b,d){a=a.item?a.item.name[0]:a.value;d=this.fieldsStore.getValue(b.getFieldsList().item,"shortType");var g=this.fieldsStore.getValue(b.getFieldsList().item,"name");b.enableOptions();if(("date"===d||"number"===d)&&(a===this.i18n.dateOperatorIsBetween||a===this.i18n.numberOperatorIsBetween||a===this.i18n.dateOperatorIsNotBetween||a===this.i18n.numberOperatorIsNotBetween))"date"===d?b.createValueBetweenDate():b.createValueBetweenNumber();
else if("date"===d&&(a===this.i18n.dateOperatorInTheLast||a===this.i18n.dateOperatorNotInTheLast))b.createValueInTheLastDate();else if(a===this.i18n.stringOperatorIsBlank||a===this.i18n.dateOperatorIsBlank||a===this.i18n.numberOperatorIsBlank||a===this.i18n.stringOperatorIsNotBlank||a===this.i18n.dateOperatorIsNotBlank||a===this.i18n.numberOperatorIsNotBlank)b.createValueIsBlank(),b.disableOptions();else switch(d){case "string":b.createValueString(this.getCodedValues(g));break;case "date":b.createValueDate();
break;default:b.createValueNumber(this.getCodedValues(g))}c.publish("filter-expression-change",this)},onInteractiveClick:function(a){this.isInteractiveChecked()?(l.set(this.interactiveSpace,"display","block"),this.interactiveArrow.innerHTML="\x26nbsp;\x26#9650;"):(l.set(this.interactiveSpace,"display","none"),this.interactiveArrow.innerHTML="\x26nbsp;\x26#9660;");c.publish("filter-expression-change",this)},onClickShowHideInteractive:function(a){this.interactiveCheck.disabled||("none"===l.set(this.interactiveSpace,
"display")?(l.set(this.interactiveSpace,"display","block"),this.interactiveArrow.innerHTML="\x26nbsp;\x26#9650;"):(l.set(this.interactiveSpace,"display","none"),this.interactiveArrow.innerHTML="\x26nbsp;\x26#9660;"))},onChangeInteractive:function(){c.publish("filter-expression-change",this)},showValueInput:function(a){this._showValueInput(y.byNode(a.target),this)},showFields:function(a){this._showFields(y.byNode(a.target),this)},showUniqueList:function(a){this._showUniqueList(y.byNode(a.target),this)},
onValueChange:function(){this.onValueChangeHandler&&clearTimeout(this.onValueChangeHandler);this.onValueChangeHandler=setTimeout(k.hitch(this,function(){this.onValueChangeHandler=null;c.publish("filter-expression-change",this)}),800)},_showValueInput:function(a,b,c){b.onChangeOperator(a,b,c);b.enableInteractiveCheck()},_showFields:function(a,b,c){c=b.getFieldsList().item;a=this.fieldsStore.getValue(c,"shortType");c=this.fieldsStore.getValue(c,"name");b.createValueFields(this.fieldsStore,{shortType:a,
name:RegExp("^(?!"+c+"$)")},c);b.disableInteractiveCheck()},_showUniqueList:function(a,b,c){this.uniqueValuesStore&&delete this.uniqueValuesStore;c=this.fieldsStore.getValue(b.getFieldsList().item,"name");if(10.1<=this.version){var d=null;this.mapLayer.queryServiceUrl?d=this.mapLayer.queryServiceUrl:this.mapLayer.itemLayers&&f.forEach(this.mapLayer.itemLayers,function(a){a.id===this.layerInfo.id&&a.layerUrl&&(d=a.layerUrl)},this);d||(d=this.mapLayer.url);if(this.uniqueValuesResults[this.mapLayer.id+
"_"+c])this.onGenerateRendererResults(b,a,this.uniqueValuesResults[this.mapLayer.id+"_"+c]);else this.generateRendererUniqueValues(c,d,k.hitch(this,"onGenerateRendererResults",b,a),k.hitch(this,function(){this.showValueInput(a,b)}))}else a&&this.showValueInput(a,b)},onGenerateRendererResults:function(a,b,c){var d=this.fieldsStore.getValue(a.getFieldsList().item,"name"),g=this.fieldsStore.getValue(a.getFieldsList().item,"shortType"),e=this.fieldsStore.getValue(a.getFieldsList().item,"type");this.uniqueValuesResults[this.mapLayer.id+
"_"+d]=c;var h=null;f.forEach(this.mapLayer.fields,function(a){a.name===d&&a.domain&&(h=a.domain)});c=f.filter(c,function(a,b){return"string"===g?"\x3cNull\x3e"!==a&&""!==a.trim():"\x3cNull\x3e"!==a&&""!==a});c.length?("date"===g?(c=f.map(c,function(a){return new Date(a)}),c=c.sort(function(a,b){var c=a.getTime(),d=b.getTime();return c<d?-1:c>d?1:0}),c=f.map(c,function(a){return this.formatFriendlyDate(a)},this)):"number"===g?(c=f.map(c,function(a){return"esriFieldTypeDouble"===e||"esriFieldTypeSingle"===
e?parseFloat(a):parseInt(a,10)}),c=c.sort(function(a,b){return a<b?-1:a>b?1:0})):c=c.sort(function(a,b){return a<b?-1:a>b?1:0}),b=f.map(c,function(a,b){var c=a;"string"===g&&(c=""===a?"\x3c"+this.i18n.emptyString+"\x3e":a);if(h&&h.codedValues){for(var d=0;d<h.codedValues.length;d++){var f=h.codedValues[d];if(a===f.code)return{id:b,name:f.name||c,value:a}}return{id:b,name:""+c,value:a}}if("esriFieldTypeDouble"===e||"esriFieldTypeSingle"===e)c=q.format(a,{pattern:"#####0.##########"});return{id:b,name:""+
c,value:a}},this),this.uniqueValuesStore=new A({data:{label:"name",identifier:"id",items:b}}),a.createValueUnique(this.uniqueValuesStore)):this.showValueInput(b,a)},generateRendererUniqueValues:function(a,b,c,d){a instanceof Array&&(a=a.toString());var g=new P;g.attributeField=a;a=new M;a.classificationDefinition=g;this.mapLayer instanceof U?b=new L(this.mapLayer):this.mapLayer instanceof N&&!this.mapLayer.url?b=new L(this.mapLayer):this.hasDynamicLayers(this.mapLayer)?(g=this.mapLayer.layerDefinitions&&
this.mapLayer.layerDefinitions[this.mapLayer.id]?this.mapLayer.layerDefinitions[this.mapLayer.id]:null,a.where=g?g:null,b=new L(this.mapLayer.url+"/dynamicLayer",{source:this.layerInfo.source})):(g=this.mapLayer.getDefinitionExpression(),a.where=g?g:null,b=new L(b));K.config.defaults.io.timeout=1E4;b.execute(a,function(a){K.config.defaults.io.timeout=6E4;a=f.map(a.infos,function(a){return a.value});c(a)},k.hitch(this,function(a){K.config.defaults.io.timeout=6E4;d()}))},hasDynamicLayers:function(a){return a&&
a.supportsDynamicLayers?!0:!1},formatDate:function(a){return D.format(a,{datePattern:"yyyy-MM-dd",selector:"date"})+" "+D.format(a,{selector:"time",timePattern:"HH:mm:ss"})},formatFriendlyDate:function(a){return D.format(a,{formatLength:"short",selector:"date"})},parseFriendlyDate:function(a){return D.parse(a,{formatLength:"short",selector:"date"})},parseDate:function(a){var b=D.parse(a,{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"});b||(b=D.parse(a.replace(" ",", "),{datePattern:"yyyy-MM-dd",
timePattern:"HH:mm:ss"}))||(b=D.parse(a.replace(" "," - "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}));return b},addDay:function(a){return new Date(a.getTime()+this.dayInMS)},subtractDay:function(a){return new Date(a.getTime()-this.dayInMS)},containsNonLatinCharacter:function(a){for(var b=0;b<a.length;b++)if(255<a.charCodeAt(b))return!0;return!1},buildCodedValuesStore:function(a){a=f.map(a,function(a,b){return{name:a.name,code:a.code,id:b}});return new A({data:{label:"name",identifier:"id",
items:a}})},clearAttributeValueDijits:function(){this.valueHandlers&&0!==this.valueHandlers.length&&(f.forEach(this.valueHandlers,k.hitch(this,function(a){c.disconnect(a)})),this.valueHandlers=[],y.byId(this.id+".value")?y.byId(this.id+".value").destroy():v.byId(this.id+".value")&&this.getAttrValContNode().removeChild(v.byId(this.id+".value")),y.byId(this.id+".value1")?y.byId(this.id+".value1").destroy():v.byId(this.id+".value1")&&this.getAttrValContNode().removeChild(v.byId(this.id+".value1")),y.byId(this.id+
".value2")?y.byId(this.id+".value2").destroy():v.byId(this.id+".value2")&&this.getAttrValContNode().removeChild(v.byId(this.id+".value2")),y.byId(this.id+".valueFields")&&y.byId(this.id+".valueFields").destroy(),y.byId(this.id+".valueUnique")&&y.byId(this.id+".valueUnique").destroy())},checkDefaultOption:function(){t(".attributeValueOptions .attributeValueRadio",this.domNode).forEach(function(a){y.byNode(a).set("checked",-1<a.className.indexOf("radioValue"))})},disableOptions:function(){t(".attributeValueOptions .attributeValueRadio",
this.domNode).forEach(function(a){y.byNode(a).set("disabled",!0)})},enableOptions:function(){t(".attributeValueOptions .attributeValueRadio",this.domNode).forEach(function(a){y.byNode(a).set("disabled",!1)})},checkFieldOption:function(){y.byId(this.id+".radioFields").set("checked",!0)},disableFieldOption:function(){y.byId(this.id+".radioFields").set("disabled",!0)},disableUniqueOption:function(){y.byId(this.id+".radioUnique").set("disabled",!0)},enableInteractiveCheck:function(){this.interactiveCheck.disabled=
!1},disableInteractiveCheck:function(){this.interactiveCheck.checked=!1;this.interactiveCheck.disabled=!0},isHostedService:function(a){if(!a)return!1;var b=-1!==a.indexOf(".arcgis.com/");a=-1!==a.indexOf("//services")||-1!==a.indexOf("//tiles")||-1!==a.indexOf("//features");return b&&a},buildEditUIField:function(a,b,c){this.getFieldItemByName({name:a.fieldObj.name},k.hitch(this,function(d){b.getFieldsList().set("value",d.id[0]);this.buildEditUIOperator(a,b,c)}),k.hitch(this,function(){b.getFieldsList().set("value",
0);this.buildEditUIOperator(a,b,c)}))},buildEditUIOperator:function(a,b,c){switch(a.fieldObj.shortType){case "string":b.fillOperatorList(this.stringOperatorStore,a.operator);break;case "date":b.fillOperatorList(this.dateOperatorStore,a.operator);break;default:b.fillOperatorList(this.numberOperatorStore,a.operator)}this.getOperatorItemByName(b.getOperatorList().store,{name:a.operator},k.hitch(this,function(d){b.getOperatorList().set("value",d.id[0]);this.buildEditUIValue(a,b,c)}),k.hitch(this,function(){b.getOperatorList().set("value",
0);this.buildEditUIValue(a,b,c)}))},buildEditUIValue:function(a,b,c){c=a.operator;this.onChangeOperator(b.getOperatorList(),b);b.enableOptions();c===this.i18n.stringOperatorIsBlank||c===this.i18n.dateOperatorIsBlank||c===this.i18n.numberOperatorIsBlank||c===this.i18n.stringOperatorIsNotBlank||c===this.i18n.dateOperatorIsNotBlank||c===this.i18n.numberOperatorIsNotBlank?(b.createValueIsBlank(),b.disableOptions()):"field"===a.valueObj.type?(b.createValueFields(this.fieldsStore,{shortType:a.fieldObj.shortType,
name:RegExp("^(?!"+a.fieldObj.name+"$)")}),b.checkFieldOption(),this.getFieldItemByName({name:a.valueObj.value},k.hitch(this,function(a){b.setValueFieldById(a.id[0])}),k.hitch(this,function(){b.setValueFieldById(0)}))):F.isDefined(a.valueObj.value1)?(b.setValue1(a.valueObj.value1),b.setValue2(a.valueObj.value2)):b.setValue(a.valueObj.value,this.getCodedValues(a.fieldObj.name))},getFieldItemByName:function(a,b,c){this.fieldsStore.fetch({query:a,onComplete:k.hitch(this,function(a){a&&a.length?b(a[0]):
c()})})},getOperatorItemByName:function(a,b,c,d){a.fetch({query:b,onComplete:k.hitch(this,function(a){a&&a.length?c(a[0]):d()})})}})})},"dijit/form/FilteringSelect":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","./MappedTextBox","./ComboBoxMixin"],function(m,d,k,f,c){return m("dijit.form.FilteringSelect",[f,c],{required:!0,_lastDisplayedValue:"",_isValidSubset:function(){return this._opened},isValid:function(){return!!this.item||!this.required&&""==this.get("displayedValue")},
_refreshState:function(){this.searchTimer||this.inherited(arguments)},_callbackSetLabel:function(b,c,d,h){c&&c[this.searchAttr]!==this._lastQuery||!c&&b.length&&this.store.getIdentity(b[0])!=this._lastQuery||(b.length?this.set("item",b[0],h):this.set("value","",h||void 0===h&&!this.focused,this.textbox.value,null))},_openResultList:function(b,c,d){c[this.searchAttr]===this._lastQuery&&(this.inherited(arguments),void 0===this.item&&this.validate(!0))},_getValueAttr:function(){return this.valueNode.value},
_getValueField:function(){return"value"},_setValueAttr:function(b,c,f,h){this._onChangeActive||(c=null);if(void 0===h){if(null===b||""===b)if(b="",!d.isString(f)){this._setDisplayedValueAttr(f||"",c);return}var m=this;this._lastQuery=b;k(this.store.get(b),function(b){m._callbackSetLabel(b?[b]:[],void 0,void 0,c)})}else this.valueNode.value=b,this.inherited(arguments,[b,c,f,h])},_setItemAttr:function(b,c,d){this.inherited(arguments);this._lastDisplayedValue=this.textbox.value},_getDisplayQueryString:function(b){return b.replace(/([\\\*\?])/g,
"\\$1")},_setDisplayedValueAttr:function(b,c){null==b&&(b="");if(!this._created){if(!("displayedValue"in this.params))return;c=!1}if(this.store){this.closeDropDown();var f=d.clone(this.query),h=this._getDisplayQueryString(b),m;this.store._oldAPI?m=h:(m=this._patternToRegExp(h),m.toString=function(){return h});this._lastQuery=f[this.searchAttr]=m;this._lastDisplayedValue=this.textbox.value=b;this._set("displayedValue",b);var v=this,l={queryOptions:{ignoreCase:this.ignoreCase,deep:!0}};d.mixin(l,this.fetchProperties);
this._fetchHandle=this.store.query(f,l);k(this._fetchHandle,function(b){v._fetchHandle=null;v._callbackSetLabel(b||[],f,l,c)},function(b){v._fetchHandle=null;v._cancelingQuery||console.error("dijit.form.FilteringSelect: "+b.toString())})}},undo:function(){this.set("displayedValue",this._lastDisplayedValue)}})})},"dijit/form/RadioButton":function(){define(["dojo/_base/declare","./CheckBox","./_RadioButtonMixin"],function(m,d,k){return m("dijit.form.RadioButton",[d,k],{baseClass:"dijitRadio"})})},"dijit/form/_RadioButtonMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/lang dojo/query!css2 ../registry".split(" "),
function(m,d,k,f,c,b){return d("dijit.form._RadioButtonMixin",null,{type:"radio",_getRelatedWidgets:function(){var d=[];c("input[type\x3dradio]",this.focusNode.form||this.ownerDocument).forEach(f.hitch(this,function(c){c.name==this.name&&c.form==this.focusNode.form&&(c=b.getEnclosingWidget(c))&&d.push(c)}));return d},_setCheckedAttr:function(b){this.inherited(arguments);this._created&&b&&m.forEach(this._getRelatedWidgets(),f.hitch(this,function(b){b!=this&&b.checked&&b.set("checked",!1)}))},_getSubmitValue:function(b){return null==
b?"on":b},_onClick:function(b){return this.checked||this.disabled?(b.stopPropagation(),b.preventDefault(),!1):this.readOnly?(b.stopPropagation(),b.preventDefault(),m.forEach(this._getRelatedWidgets(),f.hitch(this,function(b){k.set(this.focusNode||this.domNode,"checked",b.checked)})),!1):this.inherited(arguments)}})})},"dijit/form/DateTextBox":function(){define(["dojo/_base/declare","../Calendar","./_DateTimeTextBox"],function(m,d,k){return m("dijit.form.DateTextBox",k,{baseClass:"dijitTextBox dijitComboBox dijitDateTextBox",
popupClass:d,_selector:"date",maxHeight:Infinity,value:new Date("")})})},"dijit/Calendar":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/sniff ./CalendarLite ./_Widget ./_CssStateMixin ./_TemplatedMixin ./form/DropDownButton".split(" "),function(m,d,k,f,c,b,u,w,h,q,v,l,x,p,t,B,g){var r=f("dijit.Calendar",[x,p,t],{baseClass:"dijitCalendar",cssStateNodes:{decrementMonth:"dijitCalendarArrow",
incrementMonth:"dijitCalendarArrow",previousYearLabelNode:"dijitCalendarPreviousYear",nextYearLabelNode:"dijitCalendarNextYear"},setValue:function(b){w.deprecated("dijit.Calendar:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");this.set("value",b)},_createMonthWidget:function(){return new r._MonthDropDownButton({id:this.id+"_mddb",tabIndex:-1,onMonthSelect:q.hitch(this,"_onMonthSelect"),lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},postCreate:function(){this.inherited(arguments);
this.own(v(this.domNode,"keydown",q.hitch(this,"_onKeyDown")),v(this.dateRowsNode,"mouseover",q.hitch(this,"_onDayMouseOver")),v(this.dateRowsNode,"mouseout",q.hitch(this,"_onDayMouseOut")),v(this.dateRowsNode,"mousedown",q.hitch(this,"_onDayMouseDown")),v(this.dateRowsNode,"mouseup",q.hitch(this,"_onDayMouseUp")))},_onMonthSelect:function(b){var c=new this.dateClassObj(this.currentFocus);c.setDate(1);c.setMonth(b);b=this.dateModule.getDaysInMonth(c);var d=this.currentFocus.getDate();c.setDate(Math.min(d,
b));this._setCurrentFocusAttr(c)},_onDayMouseOver:function(c){if((c=b.contains(c.target,"dijitCalendarDateLabel")?c.target.parentNode:c.target)&&(c.dijitDateValue&&!b.contains(c,"dijitCalendarDisabledDate")||c==this.previousYearLabelNode||c==this.nextYearLabelNode))b.add(c,"dijitCalendarHoveredDate"),this._currentNode=c},_onDayMouseOut:function(c){this._currentNode&&!(c.relatedTarget&&c.relatedTarget.parentNode==this._currentNode)&&(c="dijitCalendarHoveredDate",b.contains(this._currentNode,"dijitCalendarActiveDate")&&
(c+=" dijitCalendarActiveDate"),b.remove(this._currentNode,c),this._currentNode=null)},_onDayMouseDown:function(c){if((c=c.target.parentNode)&&c.dijitDateValue&&!b.contains(c,"dijitCalendarDisabledDate"))b.add(c,"dijitCalendarActiveDate"),this._currentNode=c},_onDayMouseUp:function(c){(c=c.target.parentNode)&&c.dijitDateValue&&b.remove(c,"dijitCalendarActiveDate")},handleKey:function(b){var c=-1,d,g=this.currentFocus;switch(b.keyCode){case h.RIGHT_ARROW:c=1;case h.LEFT_ARROW:d="day";this.isLeftToRight()||
(c*=-1);break;case h.DOWN_ARROW:c=1;case h.UP_ARROW:d="week";break;case h.PAGE_DOWN:c=1;case h.PAGE_UP:d=b.ctrlKey||b.altKey?"year":"month";break;case h.END:g=this.dateModule.add(g,"month",1),d="day";case h.HOME:g=new this.dateClassObj(g);g.setDate(1);break;default:return!0}d&&(g=this.dateModule.add(g,d,c));this._setCurrentFocusAttr(g);return!1},_onKeyDown:function(b){this.handleKey(b)||(b.stopPropagation(),b.preventDefault())},onValueSelected:function(){},onChange:function(b){this.onValueSelected(b)},
getClassForDate:function(){}});r._MonthDropDownButton=f("dijit.Calendar._MonthDropDownButton",g,{onMonthSelect:function(){},postCreate:function(){this.inherited(arguments);this.dropDown=new r._MonthDropDown({id:this.id+"_mdd",onChange:this.onMonthSelect})},_setMonthAttr:function(b){var c=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,b);this.dropDown.set("months",c);this.containerNode.innerHTML=(6==l("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+this.dropDown.domNode.innerHTML+
"\x3c/div\x3e")+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+c[b.getMonth()]+"\x3c/div\x3e"}});r._MonthDropDown=f("dijit.Calendar._MonthDropDown",[p,B,t],{months:[],baseClass:"dijitCalendarMonthMenu dijitMenu",templateString:"\x3cdiv data-dojo-attach-event\x3d'ondijitclick:_onClick'\x3e\x3c/div\x3e",_setMonthsAttr:function(b){this.domNode.innerHTML="";m.forEach(b,function(b,c){u.create("div",{className:"dijitCalendarMonthLabel",month:c,innerHTML:b},this.domNode)._cssState=
"dijitCalendarMonthLabel"},this)},_onClick:function(b){this.onChange(c.get(b.target,"month"))},onChange:function(){}});return r})},"dijit/CalendarLite":function(){define("dojo/_base/array dojo/_base/declare dojo/cldr/supplemental dojo/date dojo/date/locale dojo/date/stamp dojo/dom dojo/dom-class dojo/_base/lang dojo/on dojo/sniff dojo/string ./_WidgetBase ./_TemplatedMixin dojo/text!./templates/Calendar.html ./a11yclick ./hccss".split(" "),function(m,d,k,f,c,b,u,w,h,q,v,l,x,p,t){var B=d("dijit.CalendarLite",
[x,p],{templateString:t,dowTemplateString:'\x3cth class\x3d"dijitReset dijitCalendarDayLabelTemplate" role\x3d"columnheader" scope\x3d"col"\x3e\x3cspan class\x3d"dijitCalendarDayLabel"\x3e${d}\x3c/span\x3e\x3c/th\x3e',dateTemplateString:'\x3ctd class\x3d"dijitReset" role\x3d"gridcell" data-dojo-attach-point\x3d"dateCells"\x3e\x3cspan class\x3d"dijitCalendarDateLabel" data-dojo-attach-point\x3d"dateLabels"\x3e\x3c/span\x3e\x3c/td\x3e',weekTemplateString:'\x3ctr class\x3d"dijitReset dijitCalendarWeekTemplate" role\x3d"row"\x3e${d}${d}${d}${d}${d}${d}${d}\x3c/tr\x3e',
value:new Date(""),datePackage:"",dayWidth:"narrow",tabIndex:"0",currentFocus:new Date,_setSummaryAttr:"gridNode",baseClass:"dijitCalendar dijitCalendarLite",_isValidDate:function(b){return b&&!isNaN(b)&&"object"==typeof b&&b.toString()!=this.constructor.prototype.value.toString()},_getValueAttr:function(){var b=this._get("value");if(b&&!isNaN(b)){var c=new this.dateClassObj(b);c.setHours(0,0,0,0);c.getDate()<b.getDate()&&(c=this.dateModule.add(c,"hour",1));return c}return null},_setValueAttr:function(c,
d){"string"==typeof c&&(c=b.fromISOString(c));c=this._patchDate(c);if(this._isValidDate(c)&&!this.isDisabledDate(c,this.lang)){if(this._set("value",c),this.set("currentFocus",c),this._markSelectedDates([c]),this._created&&(d||"undefined"==typeof d))this.onChange(this.get("value"))}else this._set("value",null),this._markSelectedDates([])},_patchDate:function(b){b&&(b=new this.dateClassObj(b),b.setHours(1,0,0,0));return b},_setText:function(b,c){for(;b.firstChild;)b.removeChild(b.firstChild);b.appendChild(b.ownerDocument.createTextNode(c))},
_populateGrid:function(){var b=new this.dateClassObj(this.currentFocus);b.setDate(1);var b=this._patchDate(b),c=b.getDay(),d=this.dateModule.getDaysInMonth(b),h=this.dateModule.getDaysInMonth(this.dateModule.add(b,"month",-1)),f=new this.dateClassObj,l=k.getFirstDayOfWeek(this.lang);l>c&&(l-=7);if(!this.summary){var a=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,b);this.gridNode.setAttribute("summary",a[b.getMonth()])}this._date2cell={};m.forEach(this.dateCells,function(a,
e){var k=e+l,m=new this.dateClassObj(b),q="dijitCalendar",p=0;k<c?(k=h-c+k+1,p=-1,q+="Previous"):k>=c+d?(k=k-c-d+1,p=1,q+="Next"):(k=k-c+1,q+="Current");p&&(m=this.dateModule.add(m,"month",p));m.setDate(k);this.dateModule.compare(m,f,"date")||(q="dijitCalendarCurrentDate "+q);this.isDisabledDate(m,this.lang)?(q="dijitCalendarDisabledDate "+q,a.setAttribute("aria-disabled","true")):(q="dijitCalendarEnabledDate "+q,a.removeAttribute("aria-disabled"),a.setAttribute("aria-selected","false"));(p=this.getClassForDate(m,
this.lang))&&(q=p+" "+q);a.className=q+"Month dijitCalendarDateTemplate";q=m.valueOf();this._date2cell[q]=a;a.dijitDateValue=q;this._setText(this.dateLabels[e],m.getDateLocalized?m.getDateLocalized(this.lang):m.getDate())},this)},_populateControls:function(){var b=new this.dateClassObj(this.currentFocus);b.setDate(1);this.monthWidget.set("month",b);var c=b.getFullYear()-1,d=new this.dateClassObj;m.forEach(["previous","current","next"],function(b){d.setFullYear(c++);this._setText(this[b+"YearLabelNode"],
this.dateLocaleModule.format(d,{selector:"year",locale:this.lang}))},this)},goToToday:function(){this.set("value",new this.dateClassObj)},constructor:function(b){this.dateModule=b.datePackage?h.getObject(b.datePackage,!1):f;this.dateClassObj=this.dateModule.Date||Date;this.dateLocaleModule=b.datePackage?h.getObject(b.datePackage+".locale",!1):c},_createMonthWidget:function(){return B._MonthWidget({id:this.id+"_mddb",lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},buildRendering:function(){var b=
this.dowTemplateString,c=this.dateLocaleModule.getNames("days",this.dayWidth,"standAlone",this.lang),d=k.getFirstDayOfWeek(this.lang);this.dayCellsHtml=l.substitute([b,b,b,b,b,b,b].join(""),{d:""},function(){return c[d++%7]});b=l.substitute(this.weekTemplateString,{d:this.dateTemplateString});this.dateRowsHtml=[b,b,b,b,b,b].join("");this.dateCells=[];this.dateLabels=[];this.inherited(arguments);u.setSelectable(this.domNode,!1);b=new this.dateClassObj(this.currentFocus);this.monthWidget=this._createMonthWidget();
this.set("currentFocus",b,!1)},postCreate:function(){this.inherited(arguments);this._connectControls()},_connectControls:function(){var b=h.hitch(this,function(b,c,d){this[b].dojoClick=!0;return q(this[b],"click",h.hitch(this,function(){this._setCurrentFocusAttr(this.dateModule.add(this.currentFocus,c,d))}))});this.own(b("incrementMonth","month",1),b("decrementMonth","month",-1),b("nextYearLabelNode","year",1),b("previousYearLabelNode","year",-1))},_setCurrentFocusAttr:function(b,c){var d=this.currentFocus,
h=this._getNodeByDate(d);b=this._patchDate(b);this._set("currentFocus",b);if(!this._date2cell||0!=this.dateModule.difference(d,b,"month"))this._populateGrid(),this._populateControls(),this._markSelectedDates([this.value]);d=this._getNodeByDate(b);d.setAttribute("tabIndex",this.tabIndex);(this.focused||c)&&d.focus();h&&h!=d&&(v("webkit")?h.setAttribute("tabIndex","-1"):h.removeAttribute("tabIndex"))},focus:function(){this._setCurrentFocusAttr(this.currentFocus,!0)},_onDayClick:function(b){b.stopPropagation();
b.preventDefault();for(b=b.target;b&&!b.dijitDateValue;b=b.parentNode);b&&!w.contains(b,"dijitCalendarDisabledDate")&&this.set("value",b.dijitDateValue)},_getNodeByDate:function(b){return(b=this._patchDate(b))&&this._date2cell?this._date2cell[b.valueOf()]:null},_markSelectedDates:function(b){function c(b,d){w.toggle(d,"dijitCalendarSelectedDate",b);d.setAttribute("aria-selected",b?"true":"false")}m.forEach(this._selectedCells||[],h.partial(c,!1));this._selectedCells=m.filter(m.map(b,this._getNodeByDate,
this),function(b){return b});m.forEach(this._selectedCells,h.partial(c,!0))},onChange:function(){},isDisabledDate:function(){},getClassForDate:function(){}});B._MonthWidget=d("dijit.CalendarLite._MonthWidget",x,{_setMonthAttr:function(b){var c=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,b),d=6==v("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+m.map(c,function(b){return"\x3cdiv\x3e"+b+"\x3c/div\x3e"}).join("")+"\x3c/div\x3e";this.domNode.innerHTML=d+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+
c[b.getMonth()]+"\x3c/div\x3e"}});return B})},"dijit/form/_DateTimeTextBox":function(){define("dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/_base/lang ./RangeBoundTextBox ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),function(m,d,k,f,c,b,u,w){new Date("X");return f("dijit.form._DateTimeTextBox",[b,u],{templateString:w,hasDownArrow:!0,cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_unboundedConstraints:{},pattern:d.regexp,datePackage:"",postMixInProperties:function(){this.inherited(arguments);
this._set("type","text")},compare:function(b,c){var d=this._isInvalidDate(b),f=this._isInvalidDate(c);if(d||f)return d&&f?0:!d?1:-1;var d=this.format(b,this._unboundedConstraints),f=this.format(c,this._unboundedConstraints),k=this.parse(d,this._unboundedConstraints),p=this.parse(f,this._unboundedConstraints);return d==f?0:m.compare(k,p,this._selector)},autoWidth:!0,format:function(b,c){return!b?"":this.dateLocaleModule.format(b,c)},parse:function(b,c){return this.dateLocaleModule.parse(b,c)||(this._isEmpty(b)?
null:void 0)},serialize:function(b,c){b.toGregorian&&(b=b.toGregorian());return k.toISOString(b,c)},dropDownDefaultValue:new Date,value:new Date(""),_blankValue:null,popupClass:"",_selector:"",constructor:function(b){b=b||{};this.dateModule=b.datePackage?c.getObject(b.datePackage,!1):m;this.dateClassObj=this.dateModule.Date||Date;this.dateClassObj instanceof Date||(this.value=new this.dateClassObj(this.value));this.dateLocaleModule=b.datePackage?c.getObject(b.datePackage+".locale",!1):d;this._set("pattern",
this.dateLocaleModule.regexp);this._invalidDate=this.constructor.prototype.value.toString()},buildRendering:function(){this.inherited(arguments);this.hasDownArrow||(this._buttonNode.style.display="none");this.hasDownArrow||(this._buttonNode=this.domNode,this.baseClass+=" dijitComboBoxOpenOnClick")},_setConstraintsAttr:function(b){b.selector=this._selector;b.fullYear=!0;var d=k.fromISOString;"string"==typeof b.min&&(b.min=d(b.min),this.dateClassObj instanceof Date||(b.min=new this.dateClassObj(b.min)));
"string"==typeof b.max&&(b.max=d(b.max),this.dateClassObj instanceof Date||(b.max=new this.dateClassObj(b.max)));this.inherited(arguments);this._unboundedConstraints=c.mixin({},this.constraints,{min:null,max:null})},_isInvalidDate:function(b){return!b||isNaN(b)||"object"!=typeof b||b.toString()==this._invalidDate},_setValueAttr:function(b,c,d){void 0!==b&&("string"==typeof b&&(b=k.fromISOString(b)),this._isInvalidDate(b)&&(b=null),b instanceof Date&&!(this.dateClassObj instanceof Date)&&(b=new this.dateClassObj(b)));
this.inherited(arguments,[b,c,d]);this.value instanceof Date&&(this.filterString="");this.dropDown&&this.dropDown.set("value",b,!1)},_set:function(b,c){if("value"==b){c instanceof Date&&!(this.dateClassObj instanceof Date)&&(c=new this.dateClassObj(c));var d=this._get("value");if(d instanceof this.dateClassObj&&0==this.compare(c,d))return}this.inherited(arguments)},_setDropDownDefaultValueAttr:function(b){this._isInvalidDate(b)&&(b=new this.dateClassObj);this._set("dropDownDefaultValue",b)},openDropDown:function(b){this.dropDown&&
this.dropDown.destroy();var d=c.isString(this.popupClass)?c.getObject(this.popupClass,!1):this.popupClass,f=this,l=this.get("value");this.dropDown=new d({onChange:function(b){f.set("value",b,!0)},id:this.id+"_popup",dir:f.dir,lang:f.lang,value:l,textDir:f.textDir,currentFocus:!this._isInvalidDate(l)?l:this.dropDownDefaultValue,constraints:f.constraints,filterString:f.filterString,datePackage:f.datePackage,isDisabledDate:function(b){return!f.rangeCheck(b,f.constraints)}});this.inherited(arguments)},
_getDisplayedValueAttr:function(){return this.textbox.value},_setDisplayedValueAttr:function(b,c){this._setValueAttr(this.parse(b,this.constraints),c,b)}})})},"esri/tasks/GenerateRendererTask":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/number dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../request ../deferredUtils ../urlUtils ../renderers/jsonUtils ./StatisticDefinition ./Task ./QueryTask ./query require require require require require require require".split(" "),
function(m,d,k,f,c,b,u,w,h,q,v,l,x,p,t,B,g){return d(t,{declaredClass:"esri.tasks.GenerateRendererTask",_eventMap:{complete:["renderer"]},constructor:function(b,c){k.isObject(b)&&("esri.layers.FeatureLayer"===b.declaredClass||"esri.layers.CSVLayer"===b.declaredClass)?b.url&&k.isString(b.url)&&"esri.layers.CSVLayer"!==b.declaredClass?(this.url=b.url,this._url=l.urlToObject(this.url),this._url.path+="/generateRenderer"):this._features=b.graphics:(this.url=b,this._url.path+="/generateRenderer");this._handler=
k.hitch(this,this._handler);this.source=c&&c.source;this.gdbVersion=c&&c.gdbVersion;this.checkValueRange=c&&c.checkValueRange;this.registerConnectEvents()},_handler:function(b,c,d,h,f){try{var a;"esri.renderer.ClassBreaksRenderer"===b.declaredClass||"esri.renderer.UniqueValueRenderer"===b.declaredClass?a=b:(a=x.fromJson(b),"classBreaks"===b.type&&a.setMaxInclusive(!0));if(this.checkValueRange){var l=new B(this.url),e=new g,m=new p;m.statisticType="min";m.onStatisticField=this._field;var q=new p;q.statisticType=
"max";q.onStatisticField=this._field;e.outStatistics=[m,q];l.execute(e).then(k.hitch(this,function(b){b=b.features[0].attributes;for(var c in b)if(0===c.toLowerCase().indexOf("min"))var e=b[c];else var g=b[c];a=this._processRenderer(a,this._prefix,this._unitLabel,this._formatLabel,this._precision,e,g);this._successHandler([a],"onComplete",d,f)}))}else a=this._processRenderer(a,this._prefix,this._unitLabel,this._formatLabel,this._precision),this._successHandler([a],"onComplete",d,f)}catch(u){this._errorHandler(u,
h,f)}},_processRenderer:function(b,d,g,h,l,a,k){"esri.renderer.ClassBreaksRenderer"===b.declaredClass?f.forEach(b.infos,function(e,f){0===f&&(void 0!==a&&null!==a)&&(e.minValue=a);f===b.infos.length-1&&(void 0!==k&&null!==k)&&(e.classMaxValue=e.maxValue=k);l&&(e.classMaxValue=e.maxValue=Math.round(e.maxValue/l)*l,e.minValue=Math.round(e.minValue/l)*l);h&&(e.label=c.format(e.minValue)+" - "+c.format(e.maxValue));d&&(e.label=d+" "+e.label);g&&(e.label=e.label+" "+g)}):f.forEach(b.infos,function(e,f){0===
f&&(void 0!==a&&null!==a)&&(e.value=a);f===b.infos.length-1&&(void 0!==k&&null!==k)&&(e.value=k);h&&(e.label=c.format(e.value));d&&(e.label=d+" "+e.label);g&&(e.label=e.label+" "+g)});return b},execute:function(c,d,g){var f,h=this._handler,a=this._errorHandler;this._precision=c.precision;this._prefix=c.prefix;this._unitLabel=c.unitLabel;this._formatLabel=c.formatLabel;if(this._features=c.features||this._features){f=new u;var l=this._features;m(["./generateRenderer"],function(b){var e;"esri.tasks.ClassBreaksDefinition"===
c.classificationDefinition.declaredClass?e=b.createClassBreaksRenderer({features:l,definition:c.classificationDefinition}):"esri.tasks.UniqueValueDefinition"===c.classificationDefinition.declaredClass&&(e=b.createUniqueValueRenderer({features:l,definition:c.classificationDefinition}));e?h(e,null,d,g,f):a(null,g,f)})}else{var e=k.mixin(c.toJson(),{f:"json"});this._field="esri.tasks.ClassBreaksDefinition"===c.classificationDefinition.declaredClass?c.classificationDefinition.classificationField:c.classificationDefinition.attributeField;
if(this.source){var p={source:this.source.toJson()};e.layer=b.toJson(p)}this.gdbVersion&&(e.gdbVersion=this.gdbVersion);f=new u(v._dfdCanceller);f._pendingDfd=q({url:this._url.path,content:e,callbackParamName:"callback",load:function(a,b){h(a,b,d,g,f)},error:function(b){a(b,g,f)}})}return f},onComplete:function(){}})})},"esri/tasks/UniqueValueDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./ClassificationDefinition"],function(m,d,k,f,c){return m(c,{declaredClass:"esri.tasks.UniqueValueDefinition",
type:"uniqueValueDef",attributeField:null,attributeField2:null,attributeField3:null,fieldDelimiter:null,toJson:function(){var b=this.inherited(arguments);this.uniqueValueFields=[];this.attributeField&&this.uniqueValueFields.push(this.attributeField);this.attributeField2&&this.uniqueValueFields.push(this.attributeField2);this.attributeField3&&this.uniqueValueFields.push(this.attributeField3);d.mixin(b,{type:this.type,uniqueValueFields:this.uniqueValueFields});this.fieldDelimiter&&d.mixin(b,{fieldDelimiter:this.fieldDelimiter});
return b}})})},"esri/tasks/ClassificationDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(m,d,k,f){return m(null,{declaredClass:"esri.tasks.ClassificationDefinition",type:null,baseSymbol:null,colorRamp:null,toJson:function(){var c={};this.baseSymbol&&d.mixin(c,{baseSymbol:this.baseSymbol.toJson()});this.colorRamp&&!d.isString(this.colorRamp)&&d.mixin(c,{colorRamp:this.colorRamp.toJson()});return c}})})},"esri/tasks/GenerateRendererParameters":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(m,d,k,f,c){return m(null,{declaredClass:"esri.tasks.GenerateRendererParameters",classificationDefinition:null,where:null,precision:null,prefix:null,unitLabel:null,formatLabel:null,toJson:function(){return{classificationDef:k.toJson(this.classificationDefinition.toJson()),where:this.where}}})})},"esri/layers/GeoRSSLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../config ../request ./ServiceGeneratedFeatureCollection".split(" "),
function(m,d,k,f,c,b,u,w){return m([w],{declaredClass:"esri.layers.GeoRSSLayer",serviceUrl:location.protocol+"//utility.arcgis.com/sharing/rss",constructor:function(c,d){b.defaults.geoRSSService&&(this.serviceUrl=b.defaults.geoRSSService);this._createLayer()},parse:function(){return this._io=u({url:this.serviceUrl,content:{url:this.url,refresh:this.loaded?!0:void 0,outSR:this._outSR?k.toJson(this._outSR.toJson()):void 0},callbackParamName:"callback"})},_initLayer:function(b){this.inherited(arguments);
this.loaded||(this.loaded=!0,this.onLoad(this))}})})},"esri/layers/ServiceGeneratedFeatureCollection":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-style dojo/has ../kernel ../SpatialReference ../geometry/Extent ../geometry/webMercatorUtils ../renderers/SimpleRenderer ./layer ./FeatureLayer ../dijit/PopupTemplate".split(" "),function(m,d,k,f,c,b,u,w,h,q,v,l,x,p,t){return m([x],{declaredClass:"esri.layers._ServiceGeneratedFeatureCollection",
constructor:function(b,c){this.pointSymbol=c&&c.pointSymbol;this.polylineSymbol=c&&c.polylineSymbol;this.polygonSymbol=c&&c.polygonSymbol;this._outSR=c&&(c.outSpatialReference||c.outSR)||new h({wkid:4326});this._options=k.mixin({},c)},parse:function(){console.error("parse function has not been implemented")},getFeatureLayers:function(){var b=[];this._fLayers&&(b=b.concat(this._fLayers));return b},onRefresh:function(){},onOpacityChange:function(){},refresh:function(){this.loaded&&(this._map&&!this._io&&
this.visible)&&this._createLayer()},_createLayer:function(b){var c=this;this._fireUpdateStart();b=this.parse(b);b.addCallback(function(b){c._io=null;c._initLayer(b)});b.addErrback(function(b){c._io=null;b=k.mixin(Error(),b);b.message="Unable to load resource: "+c.url+" "+(b.message||"");c._fireUpdateEnd(b);c.onError(b)})},_initLayer:function(b){this.loaded&&this._removeInternalLayers();this.name=b.name;this.description=b.description;this.snippet=b.snippet;this.defaultVisibility=void 0!==b.visibility?
this.visible=!!b.visibility:this.visible=!0;this.featureInfos=b.featureInfos;this.fullExtent=this.initialExtent=new q(b.lookAtExtent);this.copyright=b.author||b.copyright;var c;if((b=k.getObject("featureCollection.layers",!1,b))&&0<b.length)this._fLayers=[],f.forEach(b,function(b,d){var f=k.getObject("featureSet.features",!1,b);f&&0<f.length&&(c=k.mixin({outFields:["*"],infoTemplate:b.popupInfo?new t(b.popupInfo):null,editable:!1},this._options),c.id&&(c.id=c.id+"_"+d),b.layerDefinition.capabilities=
"Query,Data",f=new p(b,c),f.geometryType&&(this["_"+f.geometryType]=f),this._fLayers.push(f))},this),0===this._fLayers.length&&delete this._fLayers;this.items=[];this._esriGeometryPoint&&(this.items=this.items.concat(this._esriGeometryPoint.graphics),this.pointSymbol&&(b=new l(this.pointSymbol),this._esriGeometryPoint.setRenderer(b)));this._esriGeometryPolyline&&(this.items=this.items.concat(this._esriGeometryPolyline.graphics),this.polylineSymbol&&(b=new l(this.polylineSymbol),this._esriGeometryPolyline.setRenderer(b)));
this._esriGeometryPolygon&&(this.items=this.items.concat(this._esriGeometryPolygon.graphics),this.polygonSymbol&&(b=new l(this.polygonSymbol),this._esriGeometryPolygon.setRenderer(b)));this._fireUpdateEnd();this.loaded&&(this._addInternalLayers(),this.onRefresh())},_addInternalLayers:function(){var b=this._map;this._fireUpdateStart();var c=b.spatialReference,d=this._outSR,h;if(c.wkid)h=c._isWebMercator()&&d._isWebMercator()||c.wkid===d.wkid;else if(c.wkt)h=c.wkt===d.wkt;else{console.log("_setMap - map has invalid spatial reference");
return}if(!h)if(c._isWebMercator()&&4326===d.wkid)this._converter=v.geographicToWebMercator;else if(d._isWebMercator()&&4326===c.wkid)this._converter=v.webMercatorToGeographic;else{console.log("_setMap - unsupported workflow. Spatial reference of the map and layer do not match, and the conversion cannot be done on the client.");return}(c=this._fLayers)&&0<c.length&&f.forEach(c,function(c){if(this._converter){var d=c.graphics,f,a,h=d?d.length:0;for(f=0;f<h;f++)(a=d[f].geometry)&&d[f].setGeometry(this._converter(a))}b.addLayer(c)},
this);this.setVisibility(this.visible);this._fireUpdateEnd()},_removeInternalLayers:function(){var b=this._map;b&&f.forEach(this.getFeatureLayers(),b.removeLayer,b)},setScaleRange:function(b,c){this.inherited(arguments);f.forEach(this.getFeatureLayers(),function(d){d.setScaleRange(b,c)});this._options.minScale=this.minScale;this._options.maxScale=this.maxScale},setOpacity:function(b){this.opacity!=b&&(f.forEach(this.getFeatureLayers(),function(c){c.setOpacity(b)}),this.opacity=this._options.opacity=
b,this.onOpacityChange(b))},onVisibilityChange:function(b){this._fireUpdateStart();f.forEach(this.getFeatureLayers(),function(c){c.setVisibility(b)});this._fireUpdateEnd()},_setMap:function(d,f){this.inherited(arguments);this._map=d;var h=this._div=c.create("div",null,f);b.set(h,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return h},_unsetMap:function(b,f){this._io&&this._io.cancel();d.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();
var h=this._div;h&&(f.removeChild(h),c.destroy(h));this._div=null;this.inherited(arguments)}})})},"widgets/Analysis/layerUtil":function(){define(["dojo/_base/array","dojo/promise/all","jimu/LayerInfos/LayerInfos"],function(m,d,k){return{getLayerObjects:function(f){return k.getInstance(f,f.itemInfo).then(function(c){var b=[];c.traversal(function(c){b.push(c)});var f=m.map(b,function(b){return b.getLayerObject()});return d(f).then(function(d){var f=[];m.forEach(d,function(c,d){c.id=c.id||b[d].id;c&&
"esri.layers.FeatureLayer"===c.declaredClass&&f.push(c)});return{layerInfosObject:c,layerInfos:b,layerObjects:f}})})}}})},"widgets/Analysis/toolValidate":function(){define(["dojo/_base/lang","dojo/_base/array"],function(m,d){function k(f,c,b){var k=null;d.some(f,m.hitch(this,function(d){if(d&&b!==d.id)if(1===c.length){if("*"===c[0]||c[0]===d.geometryType)return k=d.id,!0}else if(-1<c.indexOf(d.geometryType))return k=d.id,!0}));return k}return{isValid:function(d,c,b){var k=!1,k=d.layerObjects;-1!==
c.dijitID.indexOf("MergeLayers")?k=this.mergeAvailable(k):-1!==c.dijitID.indexOf("ExtractData")?k=this.extractAvailable(d,b):(d=null,"requiredParam"in c&&(d=c.requiredParam),k=this.paramAvailable(k,c.analysisLayer,d));return k},mergeAvailable:function(f){return d.some(f,function(c){return d.some(f,function(b){return b!==c&&b.geometryType===c.geometryType})})},extractAvailable:function(f,c){var b=c.getUser(),k=f.layerInfos,m=f.layerInfosObject.getMapNotesLayerInfoArray(),h=!1;d.forEach(k,function(f){var k=
this._isMapNotes(m,f),l="esri.layers.GeoRSSLayer"===f.layerObject.declaredClass,u="esri.layers.CSVLayer"===f.layerObject.declaredClass,p="FeatureCollection"===f.layerObject.type,t=p&&!k;p||l||u||k?l||u?h=this._addExtractCapability(f):k||t?(f=f.getSubLayers())&&0<f.length&&d.forEach(f,function(b){h=this._addExtractCapability(b)},this):h=this._addExtractCapability(f):c.isAdmin()&&(f.layerObject.url&&-1<f.layerObject.url.indexOf("/"+b.accountId+"/"))&&(h=this._addExtractCapability(f))},this);return h},
_isMapNotes:function(f,c){return d.some(f,function(b){return b.id===c.id})},_addExtractCapability:function(d){d.layerObject.capabilities?-1===d.layerObject.capabilities.indexOf("Extract")&&(d.layerObject.capabilities+=",Extract"):d.layerObject.capabilities="Extract";return!0},paramAvailable:function(d,c,b){var m;m=c.geomTypes;c=k(d,m);return null===c?!1:null!==b?(m=b.geomTypes,null!==k(d,m,c)):!0}}})},"widgets/Analysis/PrivilegeUtil":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred jimu/portalUtils jimu/portalUrlUtils jimu/Role esri/kernel ./PortalAnalysis".split(" "),
function(m,d,k,f,c,b,u,w){return m([],{userRole:null,userPortalUrl:null,portalAnalysis:null,portalSelf:null,portalUrl:null,constructor:function(b){this.portalUrl=b},_clearLoadedInfo:function(){this.portalUrl=this.portalSelf=this.portalAnalysis=this.userPortalUrl=this.userRole=null},loadPrivileges:function(b){b&&this.portalUrl!==b&&(this._clearLoadedInfo(),this.portalUrl=b);if(this._privilegeLoaded())return b=new k,b.resolve(!0),b;b=f.getPortal(b);return b.haveSignIn()?this._loadUserInfo(b):this._signIn(b)},
_signIn:function(b){return b.loadSelfInfo().then(d.hitch(this,function(b){var c=f.getPortal(b.portalHostname);return null===c?!1:c.signIn().then(d.hitch(this,function(b){return this._loadUserInfo(c,b)}))}))},_registerOrgCredential:function(b,f){f=c.getStandardPortalUrl(f);var k=d.clone(b.toJson()),l=f+"/sharing/rest";k.server=l;k.resources=[l];u.id.registerToken(k)},_loadUserInfo:function(c,f){return c.loadSelfInfo().then(d.hitch(this,function(c){this.userPortalUrl=c.urlKey?c.urlKey+"."+c.customBaseUrl:
this.portalUrl;return c&&c.user?(this.userRole=new b({id:c.user.roleId?c.user.roleId:c.user.role,role:c.user.role}),c.user.privileges&&this.userRole.setPrivileges(c.user.privileges),this.portalSelf=c,f&&this._registerOrgCredential(f,this.userProfile.portalUrl),this.portalAnalysis=new w(this.userRole,this.portalSelf),!0):!1}))},_privilegeLoaded:function(){return null!==this.portalSelf},getUser:function(){return this._privilegeLoaded()?this.portalSelf.user:null},isAdmin:function(){return this._privilegeLoaded()?
this.userRole.isAdmin():null},getUserPortal:function(){return this._privilegeLoaded()?this.userPortalUrl:null},isPortal:function(){return null!==this.portalSelf&&!0===this.portalSelf.isPortal},canPerformAnalysis:function(){return this.portalAnalysis.canPerformAnalysis()},hasPrivileges:function(b){return this.portalAnalysis.hasPrivileges(b)}})})},"jimu/Role":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/json","esri/lang"],function(m,d,k,f,c){return m(null,{id:null,
baseRole:null,name:null,description:null,privileges:[],privilegeObj:null,constructor:function(b){b=b||{};this.id=b.id;this.baseRole=b.role;this.name=b.name;this.description=b.description},_initPrivilegesObject:function(){this.privilegeObj={portal:{admin:{inviteUsers:!1,disableUsers:!1,viewUsers:!1,updateUsers:!1,deleteUsers:!1,changeUserRoles:!1,viewGroups:!1,updateGroups:!1,deleteGroups:!1,reassignGroups:!1,assignToGroups:!1,manageEnterpriseGroups:!1,viewItems:!1,updateItems:!1,deleteItems:!1,reassignItems:!1,
manageLicenses:!1},publisher:{publishFeatures:!1,publishTiles:!1,publishScenes:!1},user:{createGroup:!1,joinGroup:!1,joinNonOrgGroup:!1,createItem:!1,shareToGroup:!1,shareToOrg:!1,shareToPublic:!1,shareGroupToOrg:!1,shareGroupToPublic:!1}},features:{user:{edit:!1,fullEdit:!1}},opendata:{user:{openDataAdmin:!1,designateGroup:!1}},premium:{user:{geocode:!1,networkanalysis:!1,spatialanalysis:!1,geoenrichment:!1,demographics:!1,elevation:!1}},marketplace:{admin:{manage:!1,purchase:!1,startTrial:!1}}}},
_readPrivileges:function(b){c.isDefined(b)&&b instanceof Array&&k.forEach(b,d.hitch(this,function(b){this._readPrivilege(b)}))},_readPrivilege:function(b){this._applyEffectToAction(!0,b)},_applyEffectToAction:function(b,c){switch(c){case "portal:admin:inviteUsers":this.privilegeObj.portal.admin.inviteUsers=b;break;case "portal:admin:disableUsers":this.privilegeObj.portal.admin.disableUsers=b;break;case "portal:admin:viewUsers":this.privilegeObj.portal.admin.viewUsers=b;break;case "portal:admin:updateUsers":this.privilegeObj.portal.admin.updateUsers=
b;break;case "portal:admin:deleteUsers":this.privilegeObj.portal.admin.deleteUsers=b;break;case "portal:admin:changeUserRoles":this.privilegeObj.portal.admin.changeUserRoles=b;break;case "portal:admin:viewGroups":this.privilegeObj.portal.admin.viewGroups=b;break;case "portal:admin:updateGroups":this.privilegeObj.portal.admin.updateGroups=b;break;case "portal:admin:deleteGroups":this.privilegeObj.portal.admin.deleteGroups=b;break;case "portal:admin:reassignGroups":this.privilegeObj.portal.admin.reassignGroups=
b;break;case "portal:admin:assignToGroups":this.privilegeObj.portal.admin.assignToGroups=b;break;case "portal:admin:manageEnterpriseGroups":this.privilegeObj.portal.admin.manageEnterpriseGroups=b;break;case "portal:admin:viewItems":this.privilegeObj.portal.admin.viewItems=b;break;case "portal:admin:updateItems":this.privilegeObj.portal.admin.updateItems=b;break;case "portal:admin:deleteItems":this.privilegeObj.portal.admin.deleteItems=b;break;case "portal:admin:reassignItems":this.privilegeObj.portal.admin.reassignItems=
b;break;case "portal:admin:manageLicenses":this.privilegeObj.portal.admin.manageLicenses=b;break;case "portal:publisher:publishFeatures":this.privilegeObj.portal.publisher.publishFeatures=b;break;case "portal:publisher:publishTiles":this.privilegeObj.portal.publisher.publishTiles=b;break;case "portal:publisher:publishScenes":this.privilegeObj.portal.publisher.publishScenes=b;break;case "portal:user:createGroup":this.privilegeObj.portal.user.createGroup=b;break;case "portal:user:joinGroup":this.privilegeObj.portal.user.joinGroup=
b;break;case "portal:user:joinNonOrgGroup":this.privilegeObj.portal.user.joinNonOrgGroup=b;break;case "portal:user:createItem":this.privilegeObj.portal.user.createItem=b;break;case "portal:user:shareToGroup":this.privilegeObj.portal.user.shareToGroup=b;break;case "portal:user:shareToOrg":this.privilegeObj.portal.user.shareToOrg=b;break;case "portal:user:shareToPublic":this.privilegeObj.portal.user.shareToPublic=b;break;case "portal:user:shareGroupToOrg":this.privilegeObj.portal.user.shareGroupToOrg=
b;break;case "portal:user:shareGroupToPublic":this.privilegeObj.portal.user.shareGroupToPublic=b;break;case "features:user:edit":this.privilegeObj.features.user.edit=b;break;case "features:user:fullEdit":this.privilegeObj.features.user.fullEdit=b;break;case "opendata:user:openDataAdmin":this.privilegeObj.opendata.user.openDataAdmin=b;break;case "opendata:user:designateGroup":this.privilegeObj.opendata.user.designateGroup=b;break;case "premium:user:geocode":this.privilegeObj.premium.user.geocode=b;
break;case "premium:user:networkanalysis":this.privilegeObj.premium.user.networkanalysis=b;break;case "premium:user:spatialanalysis":this.privilegeObj.premium.user.spatialanalysis=b;break;case "premium:user:geoenrichment":this.privilegeObj.premium.user.geoenrichment=b;break;case "premium:user:demographics":this.privilegeObj.premium.user.demographics=b;break;case "premium:user:elevation":this.privilegeObj.premium.user.elevation=b;break;case "marketplace:admin:purchase":this.privilegeObj.marketplace.admin.purchase=
b;break;case "marketplace:admin:manage":this.privilegeObj.marketplace.admin.manage=b;break;case "marketplace:admin:startTrial":this.privilegeObj.marketplace.admin.startTrial=b}},_applyToAll:function(b){this.privilegeObj.portal.admin.inviteUsers=b;this.privilegeObj.portal.admin.disableUsers=b;this.privilegeObj.portal.admin.viewUsers=b;this.privilegeObj.portal.admin.updateUsers=b;this.privilegeObj.portal.admin.deleteUsers=b;this.privilegeObj.portal.admin.changeUserRoles=b;this.privilegeObj.portal.admin.viewGroups=
b;this.privilegeObj.portal.admin.updateGroups=b;this.privilegeObj.portal.admin.deleteGroups=b;this.privilegeObj.portal.admin.reassignGroups=b;this.privilegeObj.portal.admin.assignToGroups=b;this.privilegeObj.portal.admin.manageEnterpriseGroups=b;this.privilegeObj.portal.admin.viewItems=b;this.privilegeObj.portal.admin.updateItems=b;this.privilegeObj.portal.admin.deleteItems=b;this.privilegeObj.portal.admin.reassignItems=b;this.privilegeObj.portal.admin.manageLicenses=b;this.privilegeObj.portal.publisher.publishFeatures=
b;this.privilegeObj.portal.publisher.publishTiles=b;this.privilegeObj.portal.publisher.publishScenes=b;this.privilegeObj.portal.user.createGroup=b;this.privilegeObj.portal.user.joinGroup=b;this.privilegeObj.portal.user.joinNonOrgGroup=b;this.privilegeObj.portal.user.createItem=b;this.privilegeObj.portal.user.shareToGroup=b;this.privilegeObj.portal.user.shareToOrg=b;this.privilegeObj.portal.user.shareToPublic=b;this.privilegeObj.portal.user.shareGroupToOrg=b;this.privilegeObj.portal.user.shareGroupToPublic=
b;this.privilegeObj.features.user.edit=b;this.privilegeObj.opendata.user.openDataAdmin=b;this.privilegeObj.opendata.user.designateGroup=b;this.privilegeObj.premium.user.geocode=b;this.privilegeObj.premium.user.networkanalysis=b;this.privilegeObj.premium.user.spatialanalysis=b;this.privilegeObj.premium.user.geoenrichment=b;this.privilegeObj.premium.user.demographics=b;this.privilegeObj.premium.user.elevation=b;this.privilegeObj.marketplace.admin.purchase=b;this.privilegeObj.marketplace.admin.manage=
b;this.privilegeObj.marketplace.admin.startTrial=b},_buildPrivilegesArray:function(){var b=[];!0===this.privilegeObj.portal.admin.inviteUsers&&b.push("portal:admin:inviteUsers");!0===this.privilegeObj.portal.admin.disableUsers&&b.push("portal:admin:disableUsers");!0===this.privilegeObj.portal.admin.viewUsers&&b.push("portal:admin:viewUsers");!0===this.privilegeObj.portal.admin.updateUsers&&b.push("portal:admin:updateUsers");!0===this.privilegeObj.portal.admin.deleteUsers&&b.push("portal:admin:deleteUsers");
!0===this.privilegeObj.portal.admin.changeUserRoles&&b.push("portal:admin:changeUserRoles");!0===this.privilegeObj.portal.admin.viewGroups&&b.push("portal:admin:viewGroups");!0===this.privilegeObj.portal.admin.updateGroups&&b.push("portal:admin:updateGroups");!0===this.privilegeObj.portal.admin.deleteGroups&&b.push("portal:admin:deleteGroups");!0===this.privilegeObj.portal.admin.reassignGroups&&b.push("portal:admin:reassignGroups");!0===this.privilegeObj.portal.admin.assignToGroups&&b.push("portal:admin:assignToGroups");
!0===this.privilegeObj.portal.admin.manageEnterpriseGroups&&b.push("portal:admin:manageEnterpriseGroups");!0===this.privilegeObj.portal.admin.viewItems&&b.push("portal:admin:viewItems");!0===this.privilegeObj.portal.admin.updateItems&&b.push("portal:admin:updateItems");!0===this.privilegeObj.portal.admin.deleteItems&&b.push("portal:admin:deleteItems");!0===this.privilegeObj.portal.admin.reassignItems&&b.push("portal:admin:reassignItems");!0===this.privilegeObj.portal.admin.manageLicenses&&b.push("portal:admin:manageLicenses");
!0===this.privilegeObj.portal.publisher.publishFeatures&&b.push("portal:publisher:publishFeatures");!0===this.privilegeObj.portal.publisher.publishTiles&&b.push("portal:publisher:publishTiles");!0===this.privilegeObj.portal.publisher.publishScenes&&b.push("portal:publisher:publishScenes");!0===this.privilegeObj.portal.user.createGroup&&b.push("portal:user:createGroup");!0===this.privilegeObj.portal.user.joinGroup&&b.push("portal:user:joinGroup");!0===this.privilegeObj.portal.user.joinNonOrgGroup&&
b.push("portal:user:joinNonOrgGroup");!0===this.privilegeObj.portal.user.createItem&&b.push("portal:user:createItem");!0===this.privilegeObj.portal.user.shareToGroup&&b.push("portal:user:shareToGroup");!0===this.privilegeObj.portal.user.shareToOrg&&b.push("portal:user:shareToOrg");!0===this.privilegeObj.portal.user.shareToPublic&&b.push("portal:user:shareToPublic");!0===this.privilegeObj.portal.user.shareGroupToOrg&&b.push("portal:user:shareGroupToOrg");!0===this.privilegeObj.portal.user.shareGroupToPublic&&
b.push("portal:user:shareGroupToPublic");!0===this.privilegeObj.features.user.edit&&b.push("features:user:edit");!0===this.privilegeObj.features.user.fullEdit&&b.push("features:user:fullEdit");!0===this.privilegeObj.opendata.user.openDataAdmin&&b.push("opendata:user:openDataAdmin");!0===this.privilegeObj.opendata.user.designateGroup&&b.push("opendata:user:designateGroup");!0===this.privilegeObj.premium.user.geocode&&b.push("premium:user:geocode");!0===this.privilegeObj.premium.user.networkanalysis&&
b.push("premium:user:networkanalysis");!0===this.privilegeObj.premium.user.spatialanalysis&&b.push("premium:user:spatialanalysis");!0===this.privilegeObj.premium.user.geoenrichment&&b.push("premium:user:geoenrichment");!0===this.privilegeObj.premium.user.demographics&&b.push("premium:user:demographics");!0===this.privilegeObj.premium.user.elevation&&b.push("premium:user:elevation");!0===this.privilegeObj.marketplace.admin.purchase&&b.push("marketplace:admin:purchase");!0===this.privilegeObj.marketplace.admin.manage&&
b.push("marketplace:admin:manage");!0===this.privilegeObj.marketplace.admin.startTrial&&b.push("marketplace:admin:startTrial");return b},isUser:function(){return c.isDefined(this.id)&&("org_user"===this.id||"account_user"===this.id)},isPublisher:function(){return c.isDefined(this.id)&&("org_publisher"===this.id||"account_publisher"===this.id)},isAdmin:function(){return c.isDefined(this.id)&&("org_admin"===this.id||"account_admin"===this.id)},isBasedOnUser:function(){return this.isUser()||c.isDefined(this.baseRole)&&
("org_user"===this.baseRole||"account_user"===this.baseRole)},isBasedOnPublisher:function(){return this.isPublisher()||c.isDefined(this.baseRole)&&("org_publisher"===this.baseRole||"account_publisher"===this.baseRole)},isBasedOnAdmin:function(){return this.isAdmin()||c.isDefined(this.baseRole)&&("org_admin"===this.baseRole||"account_admin"===this.baseRole)},isCustom:function(){return!this.isUser()&&!this.isPublisher()&&!this.isAdmin()&&c.isDefined(this.id)&&0<this.id.length},canInviteUsers:function(){return this.privilegeObj&&
this.privilegeObj.portal.admin.inviteUsers},canDisableUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.disableUsers},canViewUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewUsers},canUpdateUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateUsers},canDeleteUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteUsers},canChangeUserRoles:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.changeUserRoles},
canViewOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewGroups},canUpdateOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateGroups},canDeleteOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteGroups},canReassignOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.reassignGroups},canAssignUsersToOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.assignToGroups},
canManageEnterpriseGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageEnterpriseGroups},canViewOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewItems},canUpdateOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateItems},canDeleteOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteItems},canReassignOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.reassignItems},
canManageLicenses:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageLicenses},canCreateGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createGroup},canJoinOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinGroup},canJoinNonOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinNonOrgGroup},canPublishFeatures:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishFeatures},
canPublishTiles:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishTiles},canPublishScenes:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishScenes},canCreateItem:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createItem},canShareItemToGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToGroup},canShareItemToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToOrg},canShareItemToPublic:function(){return this.privilegeObj&&
this.privilegeObj.portal.user.shareToPublic},canShareGroupToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToOrg},canShareGroupToPublic:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToPublic},canEditFeatures:function(){return this.privilegeObj&&this.privilegeObj.features.user.edit},canEditFeaturesFullControl:function(){return this.privilegeObj&&this.privilegeObj.features.user.fullEdit},canManageOpenData:function(){return this.privilegeObj&&
this.privilegeObj.opendata.user.openDataAdmin},canDesignateOpenDataGroups:function(){return this.privilegeObj&&this.privilegeObj.opendata.user.designateGroup},canUseGeocode:function(){return this.privilegeObj&&this.privilegeObj.premium.user.geocode},canUseNetworkAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.networkanalysis},canUseSpatialAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.spatialanalysis},canUseGeoenrichment:function(){return this.privilegeObj&&
this.privilegeObj.premium.user.geoenrichment},canUseDemographics:function(){return this.privilegeObj&&this.privilegeObj.premium.user.demographics},canUseElevation:function(){return this.privilegeObj&&this.privilegeObj.premium.user.elevation},canPurchaseMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.purchase},canManageMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.manage},canTrialMarketplace:function(){return this.privilegeObj&&
this.privilegeObj.marketplace.admin.startTrial},setPrivileges:function(b){this.privileges=b;this._initPrivilegesObject();c.isDefined(b)&&this._readPrivileges(b)},stringify:function(){return f.stringify({id:this.id,name:this.name,description:this.description,privileges:this._buildPrivilegesArray()})},stringifyRole:function(){return f.stringify({id:this.id,name:this.name,description:this.description})},stringifyPrivileges:function(){return f.stringify({privileges:this._buildPrivilegesArray()})},stringifyPretty:function(){return f.stringify({id:this.id,
name:this.name,description:this.description,privileges:this._buildPrivilegesArray()},null,"  ")}})})},"widgets/Analysis/PortalAnalysis":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","esri/lang"],function(m,d,k,f){return m([],{userRole:null,portalSelf:null,constructor:function(c,b){this.userRole=c;this.portalSelf=b},canPerformAnalysis:function(){var c=!1;this.userRole&&(this.userRole.isAdmin()||this.userRole.isPublisher())?c=!0:this.userRole&&this.userRole.isCustom()&&
(c=this.userRole.canCreateItem()&&this.userRole.canPublishFeatures()&&this.userRole.canUseSpatialAnalysis());this.portalSelf&&this.portalSelf.isPortal&&(c=c&&f.isDefined(this.portalSelf.helperServices.analysis)&&f.isDefined(this.portalSelf.helperServices.analysis.url));return c},hasPrivileges:function(c){return d.isArray(c)?k.every(c,function(b){return"networkanalysis"===b?this._canPerformNetworkAnalysis():"geoenrichment"===b?this._canPerformGeoEnrichment():"elevation"===b?this._canPerformElevationAnalysis():
"drivetimearea"===b?this._canPerformDriveAnalysis():"planroutes"===b?this._canPerformPlanRoutesAnalysis():"od"===b?this._canPerformODAnalysis():!1},this):!0},_canPerformNetworkAnalysis:function(){var c=f.isDefined(this.portalSelf.helperServices.asyncClosestFacility)&&f.isDefined(this.portalSelf.helperServices.asyncServiceArea)&&f.isDefined(this.portalSelf.helperServices.asyncVRP);return this.canPerformAnalysis()&&c&&this.userRole.canUseNetworkAnalysis()},_canPerformGeoEnrichment:function(){var c=
f.isDefined(this.portalSelf.helperServices.geoenrichment);return this.canPerformAnalysis()&&c&&this.userRole.canUseGeoenrichment()},_canPerformElevationAnalysis:function(){var c=f.isDefined(this.portalSelf.helperServices.elevation);return this.canPerformAnalysis()&&c&&this.userRole.canUseElevation()},_canPerformPlanRoutesAnalysis:function(){var c=f.isDefined(this.portalSelf.helperServices.routingUtilities)&&f.isDefined(this.portalSelf.helperServices.asyncVRP);return this.canPerformAnalysis()&&c&&
this.userRole.canUseNetworkAnalysis()},_canPerformODAnalysis:function(){var c=f.isDefined(this.portalSelf.helperServices.routingUtilities)&&f.isDefined(this.portalSelf.helperServices.asyncRoute);return this.canPerformAnalysis()&&c&&this.userRole.canUseNetworkAnalysis()},_canPerformDriveAnalysis:function(){var c=f.isDefined(this.portalSelf.helperServices.routingUtilities)&&f.isDefined(this.portalSelf.helperServices.asyncServiceArea);return this.canPerformAnalysis()&&c&&this.userRole.canUseNetworkAnalysis()},
_canPerformNearestAnalysis:function(){var c=f.isDefined(this.portalSelf.helperServices.routingUtilities)&&f.isDefined(this.portalSelf.helperServices.asyncClosestFacility);return this.canPerformAnalysis()&&c&&this.userRole.canUseNetworkAnalysis()}})})},"widgets/Analysis/toolSettings":function(){define(["dojo/_base/lang","dojo/_base/array"],function(m,d){var k={},f="AggregatePoints CalculateDensity ConnectOriginsToDestinations CreateBuffers CreateDriveTimeAreas CreateViewshed CreateWatersheds DeriveNewLocations DissolveBoundaries EnrichLayer ExtractData FindExistingLocations FindHotSpots FindNearest FindSimilarLocations InterpolatePoints MergeLayers OverlayLayers PlanRoutes SummarizeNearby SummarizeWithin TraceDownstream".split(" "),
c=[{id:0,dijitID:"esri/dijit/analysis/AggregatePoints",title:"aggregateTool",imgDisplay:"images/aggregate-points.png",usage:"aggregatePointsUsage",analysisLayer:{name:"pointLayer",geomTypes:["esriGeometryPoint","esriGeometryMultipoint"]},requiredParam:{name:"polygonLayers",isArray:!0,geomTypes:["esriGeometryPolygon"]},icon:"images/AggregatePoints32.png"},{id:1,dijitID:"esri/dijit/analysis/CalculateDensity",title:"calculateDensity",imgDisplay:"images/calculate-density.png",usage:"calculateDensityUsage",
analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline"]},optionalParams:[{name:"boundingPolygonLayers",isArray:!0,geomTypes:["esriGeometryPolygon"]}],icon:"images/CreateDensitySurface32.png"},{id:2,dijitID:"esri/dijit/analysis/ConnectOriginsToDestinations",title:"connectOriginsToDestinations",imgDisplay:"images/connect-origins-to-destinations.png",usage:"connectOriginsToDestinationsUsage",analysisLayer:{name:"originsLayer",geomTypes:["esriGeometryPoint"]},
requiredParam:{name:"featureLayers",isArray:!0,geomTypes:["esriGeometryPoint"]},icon:"images/ConnectOriginstoDestinations32.png",privileges:["od"]},{id:3,dijitID:"esri/dijit/analysis/CreateBuffers",title:"createBuffers",imgDisplay:"images/create-buffers.png",usage:"createBuffersUsage",analysisLayer:{name:"inputLayer",geomTypes:["*"]},icon:"images/CreateBuffers32.png"},{id:4,dijitID:"esri/dijit/analysis/CreateDriveTimeAreas",title:"createDriveTimeAreas",imgDisplay:"images/create-drivetime.png",usage:"createDriveTimeAreasUsage",
analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPoint"]},icon:"images/CreateDriveTimeAreas32.png",cannotCancel:!0,privileges:["drivetimearea"]},{id:5,dijitID:"esri/dijit/analysis/CreateViewshed",title:"createViewshed",imgDisplay:"images/create-viewshed.png",usage:"createViewshedUsage",analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPoint"]},icon:"images/Viewshed32.png",privileges:["elevation"]},{id:6,dijitID:"esri/dijit/analysis/CreateWatersheds",title:"createWatershed",imgDisplay:"images/create-watersheds.png",
usage:"createWatershedsUsage",analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPoint"]},icon:"images/Watershed32.png",privileges:["elevation"]},{id:7,dijitID:"esri/dijit/analysis/DeriveNewLocations",title:"deriveNewLocations",imgDisplay:"images/derive-new-locations.png",usage:"deriveNewLocationsUsage",analysisLayer:{name:"analysisLayer",geomTypes:["*"]},optionalParams:[{name:"inputLayers",isArray:!0,geomTypes:["*"]}],icon:"images/FindNewLocations32.png"},{id:8,dijitID:"esri/dijit/analysis/DissolveBoundaries",
title:"dissolveBoundaries",imgDisplay:"images/dissolve-boundaries.png",usage:"dissolveBoundariesUsage",analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPolygon"]},icon:"images/DissolveBoundaries32.png"},{id:9,dijitID:"esri/dijit/analysis/EnrichLayer",title:"enrichLayer",imgDisplay:"images/enrich-layer.png",usage:"enrichLayerUsage",analysisLayer:{name:"inputLayer",geomTypes:["*"]},icon:"images/GeoenrichFeatures32.png",privileges:["geoenrichment"]},{id:10,dijitID:"esri/dijit/analysis/ExtractData",
title:"extractData",imgDisplay:"images/extract-data.png",usage:"extractDataDesc",optionalParams:[{name:"featureLayers",isArray:!0,geomTypes:["*"]}],icon:"images/ClipAndShip32.png"},{id:11,dijitID:"esri/dijit/analysis/FindExistingLocations",title:"findExistingLocations",imgDisplay:"images/find-existing-locations.png",usage:"findExistingLocationsUsage",analysisLayer:{name:"analysisLayer",geomTypes:["*"]},optionalParams:[{name:"inputLayers",isArray:!0,geomTypes:["*"]}],icon:"images/FindExistingLocations32.png"},
{id:12,dijitID:"esri/dijit/analysis/FindHotSpots",title:"findHotSpots",imgDisplay:"images/find-hot-spots.png",usage:"findHotSpotsUsage",analysisLayer:{name:"analysisLayer",geomTypes:["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolygon"]},optionalParams:[{name:"aggregationPolygonLayers",isArray:!0,geomTypes:["esriGeometryPolygon"]},{name:"boundingPolygonLayers",isArray:!0,geomTypes:["esriGeometryPolygon"]}],icon:"images/FindHotSpots32.png"},{id:13,dijitID:"esri/dijit/analysis/FindNearest",
title:"findNearest",imgDisplay:"images/find-nearest.png",usage:"findNearestUsage",analysisLayer:{name:"analysisLayer",geomTypes:["*"]},requiredParam:{name:"nearLayers",isArray:!0,geomTypes:["*"]},icon:"images/FindNearest32.png",cannotCancel:!0},{id:14,dijitID:"esri/dijit/analysis/FindSimilarLocations",title:"findSimilarLocations",imgDisplay:"images/find-similar-locations.png",usage:"findSimilarLocationsUsage",analysisLayer:{name:"inputLayer",geomTypes:["*"]},optionalParams:[{name:"searchLayers",isArray:!0,
geomTypes:["*"]}],icon:"images/FindSimilarLocations32.png"},{id:15,dijitID:"esri/dijit/analysis/InterpolatePoints",title:"interpolatePoints",imgDisplay:"images/interpolate-points.png",usage:"interpolatePointsUsage",analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPoint","esriGeometryMultipoint"]},optionalParams:[{name:"boundingPolygonLayers",isArray:!0,geomTypes:["esriGeometryPolygon"]},{name:"predictAtPointLayers",isArray:!0,geomTypes:["esriGeometryPoint"]}],icon:"images/CreateInterpolatedSurface32.png"},
{id:16,dijitID:"esri/dijit/analysis/MergeLayers",title:"mergeLayers",imgDisplay:"images/merge-layers.png",usage:"mergeLayersUsage",analysisLayer:{name:"inputLayer",geomTypes:["*"]},requiredParam:{name:"mergeLayers",isArray:!0,geomTypes:["*"]},icon:"images/MergeLayers32.png"},{id:17,dijitID:"esri/dijit/analysis/OverlayLayers",title:"overlayLayers",imgDisplay:"images/overlay-layers.png",usage:"overlayLayersUsage",analysisLayer:{name:"inputLayer",geomTypes:["*"]},requiredParam:{name:"overlayLayer",isArray:!0,
geomTypes:["*"]},icon:"images/OverlayLayers32.png"},{id:18,dijitID:"esri/dijit/analysis/PlanRoutes",title:"planRoutes",imgDisplay:"images/plan-routes.png",usage:"planRoutesUsage",analysisLayer:{name:"stopsLayer",geomTypes:["esriGeometryPoint"]},optionalParams:[{name:"featureLayers",isArray:!0,geomTypes:["esriGeometryPoint"]}],icon:"images/PlanRoutes32.png",cannotCancel:!0,privileges:["planroutes"]},{id:19,dijitID:"esri/dijit/analysis/SummarizeNearby",title:"summarizeNearby",imgDisplay:"images/summarize-nearby.png",
usage:"summarizeNearbyUsage",analysisLayer:{name:"sumNearbyLayer",geomTypes:["*"]},requiredParam:{name:"summaryLayers",isArray:!0,geomTypes:["*"]},icon:"images/SummarizeNearby32.png"},{id:20,dijitID:"esri/dijit/analysis/SummarizeWithin",title:"summarizeWithin",imgDisplay:"images/summarize-within.png",usage:"summarizeWithinUsage",analysisLayer:{name:"sumWithinLayer",geomTypes:["esriGeometryPolygon"]},requiredParam:{name:"summaryLayers",isArray:!0,geomTypes:["*"]},icon:"images/SummarizeWithin32.png"},
{id:21,dijitID:"esri/dijit/analysis/TraceDownstream",title:"traceDownstream",imgDisplay:"images/trace-downstream.png",usage:"traceDownstreamUsage",analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPoint"]},optionalParams:[{name:"boundingPolygonLayers",isArray:!0,geomTypes:["esriGeometryPolygon"]}],icon:"images/TraceDownstream32.png",privileges:["elevation"]}];k.findToolSetting=function(b){b=d.indexOf(f,b);return-1!==b?m.clone(c[b]):null};k.getToolName=function(b){return"id"in b&&0<=b.id&&b.id<
f.length?f[b.id]:null};k.getAllSettings=function(){return m.clone(c)};return k})},"widgets/Analysis/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings","dojo/text!./config.json"],function(){})},"url:dijit/templates/Calendar.html":'\x3ctable cellspacing\x3d"0" cellpadding\x3d"0" class\x3d"dijitCalendarContainer" role\x3d"grid" aria-labelledby\x3d"${id}_mddb ${id}_year" data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\x3cthead\x3e\r\n\t\t\x3ctr class\x3d"dijitReset dijitCalendarMonthContainer" valign\x3d"top"\x3e\r\n\t\t\t\x3cth class\x3d\'dijitReset dijitCalendarArrow\' data-dojo-attach-point\x3d"decrementMonth" scope\x3d"col"\x3e\r\n\t\t\t\t\x3cspan class\x3d"dijitInline dijitCalendarIncrementControl dijitCalendarDecrease" role\x3d"presentation"\x3e\x3c/span\x3e\r\n\t\t\t\t\x3cspan data-dojo-attach-point\x3d"decreaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e-\x3c/span\x3e\r\n\t\t\t\x3c/th\x3e\r\n\t\t\t\x3cth class\x3d\'dijitReset\' colspan\x3d"5" scope\x3d"col"\x3e\r\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"monthNode"\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/th\x3e\r\n\t\t\t\x3cth class\x3d\'dijitReset dijitCalendarArrow\' scope\x3d"col" data-dojo-attach-point\x3d"incrementMonth"\x3e\r\n\t\t\t\t\x3cspan class\x3d"dijitInline dijitCalendarIncrementControl dijitCalendarIncrease" role\x3d"presentation"\x3e\x3c/span\x3e\r\n\t\t\t\t\x3cspan data-dojo-attach-point\x3d"increaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e+\x3c/span\x3e\r\n\t\t\t\x3c/th\x3e\r\n\t\t\x3c/tr\x3e\r\n\t\t\x3ctr role\x3d"row"\x3e\r\n\t\t\t${!dayCellsHtml}\r\n\t\t\x3c/tr\x3e\r\n\t\x3c/thead\x3e\r\n\t\x3ctbody data-dojo-attach-point\x3d"dateRowsNode" data-dojo-attach-event\x3d"ondijitclick: _onDayClick" class\x3d"dijitReset dijitCalendarBodyContainer"\x3e\r\n\t\t\t${!dateRowsHtml}\r\n\t\x3c/tbody\x3e\r\n\t\x3ctfoot class\x3d"dijitReset dijitCalendarYearContainer"\x3e\r\n\t\t\x3ctr\x3e\r\n\t\t\t\x3ctd class\x3d\'dijitReset\' valign\x3d"top" colspan\x3d"7" role\x3d"presentation"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"dijitCalendarYearLabel"\x3e\r\n\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"previousYearLabelNode" class\x3d"dijitInline dijitCalendarPreviousYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"currentYearLabelNode" class\x3d"dijitInline dijitCalendarSelectedYear" role\x3d"button" id\x3d"${id}_year"\x3e\x3c/span\x3e\r\n\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"nextYearLabelNode" class\x3d"dijitInline dijitCalendarNextYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/td\x3e\r\n\t\t\x3c/tr\x3e\r\n\t\x3c/tfoot\x3e\r\n\x3c/table\x3e\r\n',
"url:esri/dijit/templates/SingleFilter.html":'\x3cdiv class\x3d"esriSingleFilterForm singleFilter" id\x3d"${id}.singleFilter"\x3e\r\n  \x3cdiv\x3e\r\n    \x3ctable id\x3d"${id}.exprTable" class\x3d"rowTable" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column1"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column2"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column3"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column4"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column5"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column6"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column7"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3ca id\x3d"${id}.deleteExpression" href\x3d"JavaScript:void(0);" style\x3d"margin:0 5px;display:none;" class\x3d"esriAGOFilterRemoveIcon" title\x3d"${i18n.deleteExpression}"\x3e\x3c/a\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"_interactiveFilterRow"\x3e\r\n          \x3ctd colspan\x3d"8"\x3e\r\n            \x3ctable cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"interactiveFilter"\x3e\r\n              \x3ctbody\x3e\r\n                \x3ctr\x3e\r\n                  \x3ctd nowrap\x3d"nowrap"\x3e\r\n                    \x3ctable cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n                      \x3ctbody\x3e\r\n                        \x3ctr\x3e\r\n                          \x3ctd nowrap\x3d"nowrap"\x3e\r\n                            \x3cinput dojoAttachPoint\x3d"interactiveCheck" type\x3d"checkbox" class\x3d"promptCheckBox" title\x3d"${i18n.promptMsg}"/\x3e\r\n                          \x3c/td\x3e\r\n                          \x3ctd nowrap\x3d"nowrap"\x3e\r\n                            \x3clabel class\x3d"labels" for\x3d"promptCheckBox"\x3e\r\n                              \x26nbsp;\x26nbsp;${i18n.askForValues}\r\n                            \x3c/label\x3e\r\n                          \x3c/td\x3e\r\n                          \x3ctd\x3e\r\n                            \x3cspan dojoAttachPoint\x3d"interactiveArrow" style\x3d"color:#cbcbcb;cursor:pointer;" class\x3d"showHidePromptDiv"\x3e\x26nbsp;\x26#9660;\x3c/span\x3e\r\n                          \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                      \x3c/tbody\x3e\r\n                    \x3c/table\x3e\r\n                  \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n                \x3ctr dojoAttachPoint\x3d"interactiveSpace" style\x3d"display:none"\x3e\r\n                  \x3ctd nowrap\x3d"nowrap"\x3e\r\n                    \x3ctable cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n                      \x3ctbody\x3e\r\n                        \x3ctr\x3e\r\n                          \x3ctd nowrap\x3d"nowrap"\x3e\r\n                            ${i18n.prompt}\r\n                          \x3c/td\x3e\r\n                          \x3ctd width\x3d"10"\x3e\r\n                            \x26nbsp;\r\n                          \x3c/td\x3e\r\n                          \x3ctd\x3e\r\n                            \x3cdiv dojoAttachPoint\x3d"promptText" dojotype\x3d"dijit.form.TextBox" intermediateChanges\x3d"true" style\x3d"width:250px;"\x3e\r\n                            \x3c/div\x3e\r\n                          \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                        \x3ctr\x3e\r\n                          \x3ctd nowrap\x3d"nowrap"\x3e\r\n                            ${i18n.hint}\r\n                          \x3c/td\x3e\r\n                          \x3ctd width\x3d"10"\x3e\r\n                            \x26nbsp;\r\n                          \x3c/td\x3e\r\n                          \x3ctd\x3e\r\n                            \x3cdiv dojoAttachPoint\x3d"hintText" dojotype\x3d"dijit.form.TextBox" intermediateChanges\x3d"true" style\x3d"width:250px;"\x3e\r\n                            \x3c/div\x3e\r\n                          \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                      \x3c/tbody\x3e\r\n                    \x3c/table\x3e\r\n                  \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n              \x3c/tbody\x3e\r\n            \x3c/table\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"promptDiv" style\x3d"display:none;padding:10px 0px;"\x3e\r\n    \x3clabel class\x3d"labels promptLabels" for\x3d"txtPrompt"\x3e\r\n      ${i18n.prompt}\r\n    \x3c/label\x3e\r\n    \x3cinput class\x3d"promptFields txtPrompt" type\x3d"text"/\x3e\r\n    \x3cbr/\x3e\r\n    \x3clabel class\x3d"labels promptLabels" for\x3d"txtHint"\x3e\r\n      ${i18n.hint}\r\n    \x3c/label\x3e\r\n    \x3cinput class\x3d"promptFields txtHint" type\x3d"text" /\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/Analysis/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"widgetContent" class\x3d"analysis-widget-content"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"toolListPanel" class\x3d"tool-list"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"toolsSection" class\x3d"toolsSection"\x3e\r\n        \x3cdiv class\x3d"execute-tip"\x3e\r\n          ${nls.executeAnalysisTip}\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"tools-table-container"\x3e\r\n          \x3ctable cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"tools-table" onselectstart\x3d"return false;"\x3e\r\n            \x3ctbody data-dojo-attach-point\x3d"toolsTbody"\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"noQueryTipSection" class\x3d"jimu-widget"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv data-dojo-attach-point\x3d"toolPanel" class\x3d"tool-panel"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"toolCtr" style\x3d"width:100%;height:90%"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"toolLoadErrorNode" class\x3d"analysis-error-tip" style\x3d"display:none"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv data-dojo-attach-point\x3d"messagePanel" class\x3d"message-panel"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"inputHeader" class\x3d"input-header esriAnalysis"\x3e\r\n        \x3cimg data-dojo-attach-point\x3d"smallIcon" class\x3d"small-icon"/\x3e\r\n        \x3cspan data-dojo-attach-point\x3d"toolTitle" class\x3d"tool-title"\x3e\x3c/span\x3e\r\n      \x3c/div\x3e\r\n      \x3chr\x3e\r\n      \x3cdiv class\x3d"message-title"\x3e${nls.messages}\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"messageSection" class\x3d\'message-section\'\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"resultSection" style\x3d"display:none" \x3e\r\n        \x3cdiv class\x3d"message-title outputs"\x3e${nls.outputs}\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"outputSection" class\x3d\'result-section\'\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"job-message outputtip" data-dojo-attach-point\x3d"outputtip"\x3e${nls.outputtip}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"resultLoading" class\x3d"result-loading" style\x3d"display:none"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"buttonSection" style\x3d"display:none" class\x3d"buttonNode"\x3e\r\n        \x3cdiv class\x3d"jimu-btn"\r\n            data-dojo-attach-event\x3d"onclick: _switchToPrevious"\x3e${nls.back}\x3c/div\x3e\r\n        \x3cdiv class\x3d"jimu-btn" data-dojo-attach-point\x3d"homeBtn"\r\n            data-dojo-attach-event\x3d"onclick: _switchToHome"\x3e${nls.home}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/Analysis/css/style.css":".esriAnalysis .dijitComboBox{height: 30px !important;}.jimu-widget-analysis{position: relative; width: 100%; height: 100%; min-width: 300px; min-height: 237px; overflow-x: hidden; -ms-overflow-x: hidden; overflow-y: auto; -ms-overflow-y: auto;}.jimu-widget-analysis .execute-tip{font-size: 14px; color: #66699c; font-weight: bold;}.jimu-widget-analysis .tools-table-container{width: 100%;}.jimu-widget-analysis .tools-table{margin: 0 auto; padding-top: 10px; width: 100%; border-collapse: collapse;}.jimu-widget-analysis .tool-name{font-size: 14px; margin-left: 10px; margin-top: 10px; color: #686868;}.jimu-rtl .jimu-widget-analysis .tool-name{margin-left: auto; margin-right: 10px;}.jimu-widget-analysis .tools-table-tr{height:107px; display: block; cursor: pointer;}.jimu-widget-analysis .tools-table-tr.even{background-color: #ffffff;}.jimu-widget-analysis .tools-table-tr.odd{background-color: #f0f0f0;}.jimu-widget-analysis .tools-table-tr.disabled{background-color: #979797; cursor: default; border-bottom: 1px solid #ffffff;}.jimu-widget-analysis .tools-table-tr .icon-div{margin: 10px;}.jimu-widget-analysis .tools-table-tr .icon-div .tool-icon{height: 60px; width: auto;}.jimu-widget-analysis .tools-table-tr .tooltip-td{margin: 10px;}.jimu-widget-analysis .tooltip-icon{width: 16px; height: 16px; cursor: pointer; margin-left: 30px;}.jimu-rtl .jimu-widget-analysis .tooltip-icon{margin-left: auto; margin-right: 30px;}.jimu-widget-analysis .tools-table-tr:hover{background: #d9dde0;}.jimu-widget-analysis .tools-table-tr.disabled:hover{background-color: #979797;}.jimu-widget-analysis .tool-params{width: 100%; height: 100%;}.jimu-widget-analysis .input-header{position: relative; width: 100%;}.jimu-widget-analysis .input-header .small-icon{margin-left: 15px;}.jimu-rtl .jimu-widget-analysis .input-header .small-icon{margin-left: auto; margin-right: 15px;}.jimu-widget-analysis .input-header .tool-title{margin-left: 15px; margin-bottom: 15px; font-size: 16px;}.jimu-rtl .jimu-widget-analysis .input-header .tool-title{margin-left: auto; margin-right: 15px;}.jimu-widget-analysis .input-header .help-icon{margin-top: 15px; cursor: pointer;}.jimu-widget-analysis .input-tip{width: 100%; height: auto; margin-top: 20px; font-size: 14px;}.jimu-widget-analysis .layerNode{position: relative; width:100%; margin: 0 auto; margin-top: 10px;}.jimu-widget-analysis .layerNode .param-name{margin-top: 15px; margin-bottom: 10px;}.jimu-widget-analysis .layer-name {height: 30px; line-height: 30px; width: 100%; border: solid 1px rgba(0,0,0,0.1); cursor: pointer;}.jimu-widget-analysis .tool-params .buttonNode{width: 100%; height: auto; margin-top: 20px; text-align: center;}.jimu-widget-analysis .switch-button{margin-left: 20px;}.jimu-rtl .jimu-widget-analysis .switch-button{margin-left: auto; margin-right: 20px;}.jimu-widget-analysis .tool-panel{width: 100%; height: auto; position: relative; top:-20px;}.jimu-widget-analysis .tool-panel .esriAnalysisCloseIcon{display:none !important;}.jimu-widget-analysis .jimu-btn{margin-left: 10px; margin-right: 10px;}.jimu-widget-analysis .toolpanel-button{text-align: center;}.jimu-widget-analysis .analysis-error-tip{width: 100%; min-height: 150px; margin-top: 30px; margin-left: 15px; margin-right: 15px; color:#ff0000; font-size: 14px;}.jimu-widget-analysis .message-panel{width: 100%; margin-bottom: 15px; position: relative;}.jimu-widget-analysis .message-panel .message-title{margin-top: 20px; font-size: 14px; color: #66696c; font-weight: bold;}.jimu-widget-analysis .message-panel .message-title.outputs{margin-top: 30px;}.jimu-widget-analysis .message-panel .job-message{margin-top: 10px; font-size: 12px; color: #686868;}.jimu-widget-analysis .message-panel .job-message.outputtip{margin-top: 30px;}.jimu-widget-analysis .message-panel .job-message.success{color: #00B050;}.jimu-widget-analysis .message-panel .job-message.failed{color:#E84B4B;}.jimu-widget-analysis .message-panel .job-message.cancelled{color: #51B1FE;}.jimu-widget-analysis .message-panel .job-running-icon{width: 16px; height: 16px; margin-left: 10px;}.jimu-rtl .jimu-widget-analysis .message-panel .job-running-icon{margin-left: auto; margin-right: 10px;}.jimu-widget-analysis .message-panel .job-cancel-icon{width: 16px; height: 16px; cursor: pointer; margin-left: 10px;}.jimu-rtl .jimu-widget-analysis .message-panel .job-cancel-icon{margin-left: auto; margin-right: 10px;}.jimu-widget-analysis .message-panel .output-item{margin-top: 10px; color: #51B1FE; font-size: 12px;}.jimu-widget-analysis .message-panel .output-item\x3ea{color: #51B1FE;}.jimu-widget-analysis .message-panel .button-section{width: 100%; margin-top: 20px;}.jimu-widget-analysis .message-panel .buttonNode{width: 100%; height: auto; margin-top: 20px; text-align: center;}.jimu-widget-analysis .result-section{width: 100%; margin-top: 15px; margin-bottom: 15px; font-size: 14px; color: #66699c;}.jimu-widget-analysis .result-loading{width: 100%; height: 40px; margin-top: 15px; margin-bottom: 15px; background-image: url(images/loading.gif); background-repeat: no-repeat; background-position: center;}.jimu-widget-analysis .hidden{display: none;}.jimu-widget-analysis .esriAnalysis .esriAnalysisSubmitButton{margin-left: 0px;}.jimu-rtl .jimu-widget-analysis .esriAnalysis .esriAnalysisSubmitButton{margin-right: 0px; margin-left: auto;}.jimu-widget-analysis .esriAnalysis .esriAnalysisSubmitButton.dijitButton\x3espan.dijitButtonNode{cursor:pointer; min-width: 70px; display:inline-block; padding:6px; font-size:15px; text-align:center; background:#485566; vertical-align:middle; color:#ffffff; -webkit-border-radius:5px; -moz-border-radius:5px; -o-border-radius:5px; -ms-border-radius:5px; border-radius: 5px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}.jimu-widget-analysis .esriAnalysis .esriAnalysisSubmitButton.dijitButtonHover\x3espan.dijitButtonNode{background-color: #15a4fa;}.dijitDialog .esriAnalysis{overflow: hidden;}.dijitDialog .esriAnalysis .esriAnalysisSubmitButton{margin-left: 10px;}.jimu-rtl .dijitDialog .esriAnalysis .esriAnalysisSubmitButton{margin-left: auto; margin-right: 10px;}.dijitDialog .esriAnalysis .esriAnalysisCloseIcon{display: none !important;}",
"url:widgets/Analysis/config.json":'{\r\n  "analysisTools": []\r\n}\r\n',"*now":function(m){m(['dojo/i18n!*preload*widgets/Analysis/nls/Widget*["ar","cs","da","de","en","el","es","et","fi","fr","he","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/_base/array dojo/dom-style dojo/dom-attr dojo/dom-class dojo/Deferred dojo/on dojo/query dojo/promise/all dojo/dom-construct dojo/i18n!esri/nls/jsapi dojo/json dijit/_WidgetsInTemplateMixin esri/request esri/tasks/JobInfo esri/layers/FeatureLayer esri/dijit/PopupTemplate esri/dijit/analysis/utils esri/geometry/Extent jimu/BaseWidget jimu/dijit/ViewStack jimu/dijit/Message jimu/utils jimu/portalUtils jimu/portalUrlUtils jimu/LayerInfos/LayerInfos ./layerUtil ./toolValidate ./PrivilegeUtil ./toolSettings dojo/i18n!./setting/nls/strings dijit/form/Button".split(" "),function(m,
d,k,f,c,b,u,w,h,q,v,l,x,p,t,B,g,r,A,D,E,G,a,n,e,z,y,C,H,O,J,I,K){return m([G,t],{baseClass:"jimu-widget-analysis esriAnalysis",_hasContent:null,privilegeUtil:null,currentStack:0,toolCountInList:0,postMixInProperties:function(){this.inherited(arguments);d.mixin(this.nls,x.analysisTools);this.nls.toolNotAvailable=K.toolNotAvailable},postCreate:function(){this.inherited(arguments);this.privilegeUtil=new J;this.viewStack=new a({viewType:"dom",views:[this.toolListPanel,this.toolPanel,this.messagePanel]});
k.place(this.viewStack.domNode,this.widgetContent);0===this.config.analysisTools.length&&this._noPrivilegeHandler(this.nls.noToolTip);this._switchView(0)},_closeHelpDialog:function(){D._helpDialog&&"function"===typeof D._helpDialog.close&&D._helpDialog.close()},onClose:function(){this._closeHelpDialog();this._deactiveDrawTool()},onDeActive:function(){this._deactiveDrawTool()},_checkValidation:function(){l.empty(this.toolsTbody);0!==this.config.analysisTools.length&&(this.shelter.show(),this.privilegeUtil.loadPrivileges(this._getPortalUrl()).then(d.hitch(this,
function(a){!a||!this.privilegeUtil.canPerformAnalysis()?this._noPrivilegeHandler(this.nls.privilegeError):(c.set(this.toolsSection,"display","block"),c.set(this.noQueryTipSection,"display","none"),1===this.config.analysisTools.length?this._initSingleTool().then(d.hitch(this,function(){this.shelter.hide()})):this._initToolList().then(d.hitch(this,function(){this.shelter.hide()})))}),d.hitch(this,function(){this._noPrivilegeHandler(this.nls.privilegeError);this.shelter.hide()})))},_clearContent:function(){l.empty(this.toolsTbody);
this.currentAnalysisDijit&&(this.currentAnalysisDijit=null,l.empty(this.toolCtr));this.currentToolSetting=null},_noPrivilegeHandler:function(a){this.shelter.hide();c.set(this.toolsSection,"display","none");b.set(this.noQueryTipSection,"innerHTML",e.stripHTML(a));c.set(this.noQueryTipSection,"display","block")},_initSingleTool:function(){c.set(this.homeBtn,"display","none");this.currentToolSetting=I.findToolSetting(this.config.analysisTools[0].name);if(null===this.currentToolSetting)this._noPrivilegeHandler(this.nls.noToolTip);
else{this.currentToolSetting=d.mixin(this.currentToolSetting,this.config.analysisTools[0]);this.currentToolSetting.toolLabel||(this.currentToolSetting.toolLabel=this.nls[this.currentToolSetting.title]);if(this.privilegeUtil.hasPrivileges(this.currentToolSetting.privileges))return H.getLayerObjects(this.map).then(d.hitch(this,function(){this._setIconAndLink(this.currentToolSetting);this.toolCountInList=1;this._switchToAnalysisTool()}));this._noPrivilegeHandler(this.nls.privilegeError)}},_initToolList:function(){c.set(this.homeBtn,
"display","");this.toolCountInList=0;var a=null;return H.getLayerObjects(this.map).then(d.hitch(this,function(b){f.forEach(this.config.analysisTools,d.hitch(this,function(c,e){var f=I.findToolSetting(c.name);if(null!==f&&(f=d.mixin(f,this.config.analysisTools[e]),f.toolLabel||(f.toolLabel=this.nls[f.title]),this.privilegeUtil.hasPrivileges(f.privileges))){var h=O.isValid(b,f,this.privilegeUtil);this._addTool(f,e,h);this.toolCountInList+=1;a=f}}));0===this.toolCountInList?this._noPrivilegeHandler(this.nls.privilegeError):
1===this.toolCountInList&&(this._setIconAndLink(a),this._switchToAnalysisTool())}),d.hitch(this,function(){console.error("layerUtil: getLayerObjects error")}))},destroy:function(){this._clearContent();this.inherited(arguments)},_addTool:function(a,c,f){var g=l.create("tr",{"class":"tools-table-tr"},this.toolsTbody);0===c%2?u.add(g,"even"):u.add(g,"odd");g.rowData=a;c=l.create("td",{"class":"icon-td"},g);l.create("div",{"class":"tool-name",innerHTML:e.stripHTML(a.toolLabel)},c);c=l.create("div",{"class":"icon-div"},
c);l.create("img",{src:this.folderUrl+a.imgDisplay,"class":"tool-icon"},c);c=l.create("td",{"class":"tooltip-td esriAnalysis"},g);if(a.showHelp){c=l.create("a",{href:"#",esriHelpTopic:"toolDescription"},c);l.create("img",{src:this.folderUrl+"images/helpIcon.png",title:a.toolLabel,"class":"tooltip-icon"},c);c=a.dijitID.lastIndexOf("/");c=a.dijitID.substring(c+1);var k=!y.isOnline(this._getPortalUrl());D.initHelpLinks(g,!0,{helpFileName:c,isSingleTenant:k})}!0===f?(b.set(g,"title",""),this.own(h(g,
"click",d.hitch(this,function(){this._setIconAndLink(a);this.currentToolSetting=a;this._switchToAnalysisTool()})))):(b.set(g,"title",this.nls.toolNotAvailable),u.remove(g,"even"),u.remove(g,"odd"),u.add(g,"disabled"))},_setIconAndLink:function(a){b.set(this.smallIcon,"src",this.folderUrl+a.icon);b.set(this.toolTitle,"innerHTML",e.stripHTML(a.toolLabel));var c=a.dijitID.lastIndexOf("/"),c=a.dijitID.substring(c+1);this.helpLink&&(l.destroy(this.helpLink),this.helpLink=null);a.showHelp&&(this.helpLink=
l.create("a",{href:"#",esriHelpTopic:"toolDescription"},this.inputHeader),l.create("img",{height:16,width:16,"class":"help-icon jimu-float-trailing",src:this.folderUrl+"images/helpIcon.png"},this.helpLink),D.initHelpLinks(this.inputHeader,!0,{helpFileName:c}))},_switchToAnalysisTool:function(){c.set(this.toolLoadErrorNode,"display","none");this.shelter.show();require([this.currentToolSetting.dijitID],d.hitch(this,function(a){this.currentAnalysisDijit&&(this.currentAnalysisDijit=null,l.empty(this.toolCtr));
var f=!y.isOnline(this._getPortalUrl()),g={map:this.map,showSelectFolder:!0,portalUrl:this._getPortalUrl(this.privilegeUtil.getUserPortal()),showCredits:this.currentToolSetting.showCredits,showHelp:this.currentToolSetting.showHelp,showChooseExtent:this.currentToolSetting.showChooseExtent,returnFeatureCollection:this.currentToolSetting.returnFeatureCollection,showReadyToUseLayers:this.currentToolSetting.showReadyToUseLayers,isSingleTenant:f};f&&(g.showReadyToUseLayers=!1);if("findNearest"===this.currentToolSetting.title||
"summarizeNearby"===this.currentToolSetting.title||"enrichLayer"===this.currentToolSetting.title)g.enableTravelModes=this.privilegeUtil.hasPrivileges(["networkanalysis"]);"returnFeatureCollection"in this.currentToolSetting&&(g.showSelectFolder=!this.currentToolSetting.returnFeatureCollection);this._getLayerObjects().then(d.hitch(this,function(f){this.currentToolSetting.analysisLayer&&(g.showSelectAnalysisLayer=!0,g[this.currentToolSetting.analysisLayer.name+"s"]=this._prepareLayers(f,this.currentToolSetting.analysisLayer.geomTypes));
f=this._prepareLayerParams(f);d.mixin(g,f);try{if(-1!==this.currentToolSetting.dijitID.indexOf("DeriveNewLocations")||-1!==this.currentToolSetting.dijitID.indexOf("FindExistingLocations")||-1!==this.currentToolSetting.dijitID.indexOf("FindSimilarLocations"))g.primaryActionButttonClass="esriAnalysisSubmitButton";this.currentAnalysisDijit=new a(g,l.create("div",{style:{width:"100%"}},this.toolCtr));this.currentAnalysisDijit._setTitleAttr(this.currentToolSetting.toolLabel);this._bindAnalysisEvents(this.currentAnalysisDijit);
this.currentDijitID=this.currentToolSetting.dijitID;var k;if(1<this.toolCountInList&&(k=q(".esriAnalysis .esriAnalysisSubmitButton",this.toolPanel)[0],"undefined"!==typeof k)){u.add(k,"multiTool");var m=l.create("div",{"class":"toolpanel-button"}),n=l.create("div",{"class":"jimu-btn",innerHTML:this.nls.back},m);l.place(m,k,"before");l.place(k,m);this.currentAnalysisDijit.own(h(n,"click",d.hitch(this,this._switchToPrevious)))}}catch(p){console.error(p.message||p),b.set(this.toolLoadErrorNode,"innerHTML",
e.stripHTML(p.message||p)),c.set(this.toolLoadErrorNode,"display","")}this.shelter.hide()}))}),d.hitch(this,function(a){b.set(this.toolLoadErrorNode,"innerHTML",e.stripHTML(a));c.set(this.toolLoadErrorNode,"display","");this.shelter.hide()}));this._switchView(1)},_prepareLayerParams:function(a){var b={};if("optionalParams"in this.currentToolSetting||"requiredParam"in this.currentToolSetting){var c;"requiredParam"in this.currentToolSetting&&(c=this._prepareLayers(a,this.currentToolSetting.requiredParam.geomTypes),
b[this.currentToolSetting.requiredParam.name]=this.currentToolSetting.requiredParam.isArray?c:0<c.length?c[0]:null);"optionalParams"in this.currentToolSetting&&f.forEach(this.currentToolSetting.optionalParams,function(d){c=this._prepareLayers(a,d.geomTypes);b[d.name]=d.isArray?c:0<c.length?c[0]:null},this)}return b},_prepareLayers:function(a,b){var c,d=["point","polyline","polygon"],g=[];"*"!==b[0]&&(d=f.map(b,function(a){return e.getTypeByGeometryType(a)}));f.forEach(a,function(a){"esri.layers.FeatureLayer"===
a.declaredClass&&(c=e.getTypeByGeometryType(a.geometryType),0<=d.indexOf(c)&&(a.url||0<a.graphics.length)&&g.push(a))},this);return g},_getLayerObjects:function(){var a=new w;C.getInstance(this.map,this.map.itemInfo).then(d.hitch(this,function(b){var c=[];b.traversal(function(a){c.push(a)});b=f.map(c,function(a){return a.getLayerObject()});v(b).then(d.hitch(this,function(b){var c=[];f.forEach(b,function(a){a&&c.push(a)});a.resolve(c)}),function(b){a.resolve([])})}));return a},_deactiveDrawTool:function(){if(this.currentAnalysisDijit)if("findHotSpots"===
this.currentToolSetting.title||"calculateDensity"===this.currentToolSetting.title||"traceDownstream"===this.currentToolSetting.title||"interpolatePoints"===this.currentToolSetting.title||"findSimilarLocations"===this.currentToolSetting.title||"createViewshed"===this.currentToolSetting.title||"createWatershed"===this.currentToolSetting.title)this.currentAnalysisDijit.clear();else if("planRoutes"===this.currentToolSetting.title||"extractData"===this.currentToolSetting.title)this.currentAnalysisDijit.clear(),
this.map.setInfoWindowOnClick(!0)},_bindAnalysisEvents:function(a){this.own(h(a,"start",d.hitch(this,this._onJobStart)));this.own(h(a,"job-submit",d.hitch(this,this._onJobSubmitted)));this.own(h(a,"job-cancel",d.hitch(this,this._onJobCancelled)));this.own(h(a,"job-fail",d.hitch(this,this._onJobFailed)));this.own(h(a,"job-success",d.hitch(this,this._onJobSucceed)));this.own(h(a,"job-status",d.hitch(this,this._onJobStatusChange)));this.own(h(a,"job-result",d.hitch(this,this._onJobResultData)));this.own(h(a,
"drawtool-activate",d.hitch(this,function(){this.map.setInfoWindowOnClick(!1)})));this.own(h(a,"drawtool-deactivate",d.hitch(this,function(){this.map.setInfoWindowOnClick(!0)})))},_onJobStart:function(){this._clearMessageLogs();this.shelter.show();this._switchView(2)},_onJobSubmitted:function(a){this.shelter.hide();this.outputProperties=null;a.OutputName&&(this.outputProperties=p.parse(a.OutputName,!0));this._appendMessage(this.nls[this.currentToolSetting.title]+" "+this.nls.jobSubmitted);a=l.create("div",
{"class":"job-message waiting"},this.messageSection);l.create("img",{"class":"job-running-icon",src:this.folderUrl+"images/loading.gif"},a)},_onJobCancelled:function(a){a.jobStatus?this._appendMessage(this.nls.jobCancelled+": "+a.jobStatus,"cancelled"):this._appendMessage(this.nls.jobCancelled,"cancelled");this._onJobDone();c.set(this.buttonSection,"display","")},_onJobFailed:function(a){this.shelter.hide();"warning"===a.type?(this.currentAnalysisDijit.set("disableRunAnalysis",!1),this._switchView(1),
new n({message:a.message})):(2!==this.currentStack&&(this._clearMessageLogs(),this._switchView(2)),this._appendMessage(this.nls.jobFailed+": "+(a.analysisReport||a.message),"failed"),this._onJobDone(),c.set(this.buttonSection,"display",""))},_onJobSucceed:function(a){this._appendMessage(this.nls.jobSuccess,"success");this._onJobDone();0<=this.currentToolSetting.dijitID.indexOf("ExtractData")&&(c.set(this.resultSection,"display",""),b.set(this.outputtip,"innerHTML",e.stripHTML(this.nls.outputSaveInPortal)));
c.set(this.buttonSection,"display","");c.set(this.resultLoading,"display","")},_onJobDone:function(){q("img.job-executing",this.messagePanel).forEach(function(a){l.destroy(a)})},_onJobStatusChange:function(a){this.shelter.hide();a.jobId&&a.jobId!==this.currentToolJobId&&(this.currentToolJobId=a.jobId);if(a.jobStatus===g.STATUS_EXECUTING)this._appendExecutingMessage();else switch(a.jobStatus){case g.STATUS_FAILED:case g.STATUS_CANCELLED:case g.STATUS_DELETED:case g.STATUS_TIMED_OUT:this.shelter.hide();
"string"===typeof a.message&&this._appendMessage(a.message,"failed");this._onJobDone();c.set(this.buttonSection,"display","");break;case g.STATUS_SUCCEEDED:"string"===typeof a.message&&this._appendMessage(a.message),this._onJobDone(),c.set(this.buttonSection,"display","")}},_onJobResultData:function(a){c.set(this.resultLoading,"display","none");b.set(this.outputtip,"innerHTML",e.stripHTML(this.nls.outputtip));c.set(this.resultSection,"display","");c.set(this.buttonSection,"display","");var d=this._appendResultMessage(a);
console.debug("outputLayerName: "+d);if(0>this.currentToolSetting.dijitID.indexOf("ExtractData")){var g;if(a.value.itemId)g=null,"layerInfo"in a.value&&(g=a.value.layerInfo.popupInfo),this._fetchResultByItemId(d,a.value.itemId,g);else if("layerDefinition"in a.value){var h={title:d?d:"output",fieldInfos:[]};f.forEach(a.value.layerDefinition.fields,function(b){b.name!==a.value.layerDefinition.objectIdField&&h.fieldInfos.push({fieldName:b.name,visible:!0,label:b.alias,isEditable:!1})});g=new A(h);g=
new r(a.value,{infoTemplate:g});g.title=d?d:"output";this.map.addLayer(g)}}},_fetchResultByItemId:function(a,b,c){z.getPortal(this._getPortalUrl(this.privilegeUtil.getUserPortal())).getItemById(b).then(d.hitch(this,function(e){var g=e.url;B({url:g,content:{f:"json"},handleAs:"json"}).then(d.hitch(this,function(e){var h=e.tables||[],k=e.layers||[];h.reverse();k.reverse();f.forEach(h,function(b){var c=g+"/"+b.id;C.getInstance(this.map,this.map.itemInfo).then(function(d){d.addTable({url:c,title:a+" - "+
b.name,options:{outFields:["*"]}})})},this);f.forEach(k,function(a){var e=g+"/"+a.id,f=null;1===k.length&&(f=c);this._buildFeatureLayer(a.name,e,f,b).then(d.hitch(this,function(a){this.map.addLayer(a)}))},this);e.initialExtent&&this.map.setExtent(new E(e.initialExtent))}))}))},_buildFeatureLayer:function(a,b,c,e){if(null!==c){var g=new w;c.title=a;c=new r(b,{mode:r.MODE_SNAPSHOT,infoTemplate:new A(c),outFields:["*"]});c._itemId=e;g.resolve(c);return g}return B({url:b,content:{f:"json"},handleAs:"json"}).then(d.hitch(this,
function(c){var d={title:a,fieldInfos:[]};f.forEach(c.fields,function(a){a.name!==c.objectIdField&&d.fieldInfos.push({fieldName:a.name,visible:!0,label:a.alias,isEditable:!1})});var g=new r(b,{mode:r.MODE_SNAPSHOT,infoTemplate:new A(d),outFields:["*"]});g._itemId=e;return g}),d.hitch(this,function(){var a=new r(b);a._itemId=e;return a}))},_clearMessageLogs:function(){l.empty(this.messageSection);l.empty(this.outputSection);c.set(this.resultSection,"display","none");c.set(this.buttonSection,"display",
"none")},_appendMessage:function(a,b){l.create("div",{"class":"job-message "+(b?b:""),innerHTML:e.stripHTML(a)},this.messageSection)},_appendExecutingMessage:function(){q("div.waiting",this.messagePanel).forEach(function(a){l.destroy(a)});if(0===q("div.job-executing",this.messagePanel).length){var a=l.create("div",{"class":"job-message job-executing"},this.messageSection);l.create("span",{innerHTML:e.stripHTML(this.nls.executing)},a);l.create("img",{"class":"job-running-icon job-executing",src:this.folderUrl+
"images/loading.gif"},a);var b=!1;!0===this.currentToolSetting.cannotCancel?b=!0:0<=this.currentToolSetting.dijitID.indexOf("EnrichLayer")&&this.currentAnalysisDijit&&this.currentAnalysisDijit.enableTravelModes&&(b=!0);b||(a=l.create("img",{"class":"job-cancel-icon job-executing",src:this.folderUrl+"images/cancel.png",title:this.nls.cancelJob},a),this.own(h(a,"click",d.hitch(this,this._cancelTask))))}},_appendResultMessage:function(a){if(a.paramName){var c=a.paramName,d=l.create("div",{"class":"output-item"},
this.outputSection);if(a.value&&a.value.itemId){var f=y.getItemDetailsPageUrl(this._getPortalUrl(this.privilegeUtil.getUserPortal()),a.value.itemId);"object"===typeof this.outputProperties&&a.value.itemId===this.outputProperties.itemProperties.itemId&&(c=this.outputProperties.serviceProperties.name);l.create("a",{href:f,target:"_blank",innerHTML:e.stripHTML(c)},d)}else b.set(d,"innerHTML",a.paramName);return c}return null},_getPortalUrl:function(a){return a?y.getStandardPortalUrl(a):y.getStandardPortalUrl(this.appConfig.portalUrl)},
_cancelTask:function(){this.currentToolJobId&&this.currentAnalysisDijit&&this.currentAnalysisDijit.cancel({jobId:this.currentToolJobId})},_switchToPrevious:function(){2===this.currentStack?this._switchToAnalysisTool():(this._deactiveDrawTool(),this._switchView(0))},_switchToHome:function(){1<this.toolCountInList?this._switchView(0):this._switchToAnalysisTool()},_switchView:function(a){this._closeHelpDialog();0===a&&this._checkValidation();this.currentStack=a;this.viewStack.switchView(a)}})});